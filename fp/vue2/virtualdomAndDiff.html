<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.1 虚拟DOM | web全栈体系</title>
    <meta name="description" content="你好，朋友">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.5718d53e.css" as="style"><link rel="preload" href="/assets/js/app.0f616eb6.js" as="script"><link rel="preload" href="/assets/js/3.9750fba5.js" as="script"><link rel="preload" href="/assets/js/2.6aa46093.js" as="script"><link rel="preload" href="/assets/js/8.ffcc6d32.js" as="script"><link rel="prefetch" href="/assets/js/10.3b417cc7.js"><link rel="prefetch" href="/assets/js/100.450b51bc.js"><link rel="prefetch" href="/assets/js/101.02365136.js"><link rel="prefetch" href="/assets/js/102.23f6118f.js"><link rel="prefetch" href="/assets/js/103.4decf838.js"><link rel="prefetch" href="/assets/js/104.d39cfd73.js"><link rel="prefetch" href="/assets/js/105.88534338.js"><link rel="prefetch" href="/assets/js/106.366d0b59.js"><link rel="prefetch" href="/assets/js/107.cf3cfcba.js"><link rel="prefetch" href="/assets/js/108.21694919.js"><link rel="prefetch" href="/assets/js/109.4e4fd62e.js"><link rel="prefetch" href="/assets/js/11.9d20f01b.js"><link rel="prefetch" href="/assets/js/110.aeb394e4.js"><link rel="prefetch" href="/assets/js/111.d6595775.js"><link rel="prefetch" href="/assets/js/12.ac6dcc46.js"><link rel="prefetch" href="/assets/js/13.3990b71a.js"><link rel="prefetch" href="/assets/js/14.42418305.js"><link rel="prefetch" href="/assets/js/15.3e7fea41.js"><link rel="prefetch" href="/assets/js/16.e9242241.js"><link rel="prefetch" href="/assets/js/17.5cb2a82b.js"><link rel="prefetch" href="/assets/js/18.09a2ee08.js"><link rel="prefetch" href="/assets/js/19.5e018236.js"><link rel="prefetch" href="/assets/js/20.2f6aad81.js"><link rel="prefetch" href="/assets/js/21.56a0a87d.js"><link rel="prefetch" href="/assets/js/22.37a8fef4.js"><link rel="prefetch" href="/assets/js/23.75c65558.js"><link rel="prefetch" href="/assets/js/24.19255d9b.js"><link rel="prefetch" href="/assets/js/25.b96e970c.js"><link rel="prefetch" href="/assets/js/26.8043101d.js"><link rel="prefetch" href="/assets/js/27.c05d3044.js"><link rel="prefetch" href="/assets/js/28.c0aa90a2.js"><link rel="prefetch" href="/assets/js/29.06c0191d.js"><link rel="prefetch" href="/assets/js/30.975fb305.js"><link rel="prefetch" href="/assets/js/31.0cba5310.js"><link rel="prefetch" href="/assets/js/32.d8bc188f.js"><link rel="prefetch" href="/assets/js/33.384f6578.js"><link rel="prefetch" href="/assets/js/34.6baca6a7.js"><link rel="prefetch" href="/assets/js/35.96ec3f3e.js"><link rel="prefetch" href="/assets/js/36.bd945c36.js"><link rel="prefetch" href="/assets/js/37.be27655b.js"><link rel="prefetch" href="/assets/js/38.e8e93b37.js"><link rel="prefetch" href="/assets/js/39.ef88fac1.js"><link rel="prefetch" href="/assets/js/4.aa28cc69.js"><link rel="prefetch" href="/assets/js/40.b6dad60d.js"><link rel="prefetch" href="/assets/js/41.c762ef5a.js"><link rel="prefetch" href="/assets/js/42.151d8a58.js"><link rel="prefetch" href="/assets/js/43.632c642f.js"><link rel="prefetch" href="/assets/js/44.2e34b5d9.js"><link rel="prefetch" href="/assets/js/45.94f8db29.js"><link rel="prefetch" href="/assets/js/46.57527f8f.js"><link rel="prefetch" href="/assets/js/47.44a84132.js"><link rel="prefetch" href="/assets/js/48.66958018.js"><link rel="prefetch" href="/assets/js/49.21739b30.js"><link rel="prefetch" href="/assets/js/5.e06ff02e.js"><link rel="prefetch" href="/assets/js/50.000c5d7c.js"><link rel="prefetch" href="/assets/js/51.b59a6470.js"><link rel="prefetch" href="/assets/js/52.3a475ad4.js"><link rel="prefetch" href="/assets/js/53.9801890b.js"><link rel="prefetch" href="/assets/js/54.269a45cd.js"><link rel="prefetch" href="/assets/js/55.91e89997.js"><link rel="prefetch" href="/assets/js/56.493b7ae8.js"><link rel="prefetch" href="/assets/js/57.ec46c27c.js"><link rel="prefetch" href="/assets/js/58.56202f8d.js"><link rel="prefetch" href="/assets/js/59.4dac8d8a.js"><link rel="prefetch" href="/assets/js/6.45a79ebc.js"><link rel="prefetch" href="/assets/js/60.77f7cd1f.js"><link rel="prefetch" href="/assets/js/61.a48bae63.js"><link rel="prefetch" href="/assets/js/62.626e88b6.js"><link rel="prefetch" href="/assets/js/63.9d36ed5d.js"><link rel="prefetch" href="/assets/js/64.a6a4e5c6.js"><link rel="prefetch" href="/assets/js/65.e32c3a18.js"><link rel="prefetch" href="/assets/js/66.0de20cc0.js"><link rel="prefetch" href="/assets/js/67.b24d4adf.js"><link rel="prefetch" href="/assets/js/68.7269173e.js"><link rel="prefetch" href="/assets/js/69.9999d01e.js"><link rel="prefetch" href="/assets/js/7.1a1f32a2.js"><link rel="prefetch" href="/assets/js/70.a45e1785.js"><link rel="prefetch" href="/assets/js/71.d443735d.js"><link rel="prefetch" href="/assets/js/72.56bd9ca0.js"><link rel="prefetch" href="/assets/js/73.4a484020.js"><link rel="prefetch" href="/assets/js/74.d0f77ba8.js"><link rel="prefetch" href="/assets/js/75.8595de75.js"><link rel="prefetch" href="/assets/js/76.b89309e6.js"><link rel="prefetch" href="/assets/js/77.1a28c952.js"><link rel="prefetch" href="/assets/js/78.156340fe.js"><link rel="prefetch" href="/assets/js/79.bc68f887.js"><link rel="prefetch" href="/assets/js/80.00742412.js"><link rel="prefetch" href="/assets/js/81.d07bf30f.js"><link rel="prefetch" href="/assets/js/82.dd648b4e.js"><link rel="prefetch" href="/assets/js/83.50310bd1.js"><link rel="prefetch" href="/assets/js/84.8b446b87.js"><link rel="prefetch" href="/assets/js/85.1bbf1222.js"><link rel="prefetch" href="/assets/js/86.b1112682.js"><link rel="prefetch" href="/assets/js/87.5353ad37.js"><link rel="prefetch" href="/assets/js/88.3bc7938a.js"><link rel="prefetch" href="/assets/js/89.c9d6877e.js"><link rel="prefetch" href="/assets/js/9.bfaf9c10.js"><link rel="prefetch" href="/assets/js/90.f7c20556.js"><link rel="prefetch" href="/assets/js/91.72437dd2.js"><link rel="prefetch" href="/assets/js/92.2a17869e.js"><link rel="prefetch" href="/assets/js/93.cc33ea11.js"><link rel="prefetch" href="/assets/js/94.49e5d122.js"><link rel="prefetch" href="/assets/js/95.9c954379.js"><link rel="prefetch" href="/assets/js/96.638e1dee.js"><link rel="prefetch" href="/assets/js/97.c2372908.js"><link rel="prefetch" href="/assets/js/98.762254ac.js"><link rel="prefetch" href="/assets/js/99.29af3121.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5718d53e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-266a5a28><header class="navbar" data-v-266a5a28><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="web全栈体系" class="logo"> <span class="site-name can-hide">web全栈体系</span></a> <div class="carousel" data-v-1a4d21d9></div> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a href="https://github.com/hejialianghe" class="repo-star"><img src="https://img.shields.io/github/stars/hejialianghe/Senior-FrontEnd.svg?style=flat-square" alt></a> <div class="nav-item"><a href="/algorithm/complexity.html" class="nav-link">算法小册</a></div><div class="nav-item"><a href="/guide/" class="nav-link">web体系</a></div><div class="nav-item"><a href="/fp/react/build-react.html" class="nav-link">框架原理</a></div><div class="nav-item"><a href="https://github.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fp/vue2/virtualdomAndDiff.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en-US/fp/vue2/virtualdomAndDiff.html" class="nav-link">English</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-266a5a28></div> <aside class="sidebar" data-v-266a5a28><nav class="nav-links"><a href="https://github.com/hejialianghe" class="repo-star"><img src="https://img.shields.io/github/stars/hejialianghe/Senior-FrontEnd.svg?style=flat-square" alt></a> <div class="nav-item"><a href="/algorithm/complexity.html" class="nav-link">算法小册</a></div><div class="nav-item"><a href="/guide/" class="nav-link">web体系</a></div><div class="nav-item"><a href="/fp/react/build-react.html" class="nav-link">框架原理</a></div><div class="nav-item"><a href="https://github.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fp/vue2/virtualdomAndDiff.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en-US/fp/vue2/virtualdomAndDiff.html" class="nav-link">English</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fp/react/build-react.html" class="sidebar-link">[译]build-your-own-react</a></li><li><a href="/fp/react/react-hooks.html" class="sidebar-link">react-hooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fp/vue2/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/fp/vue2/dataResponse.html" class="sidebar-link">响应式</a></li><li><a href="/fp/vue2/virtualdomAndDiff.html" aria-current="page" class="active sidebar-link">virtualdom和DIff</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-1-虚拟dom" class="sidebar-link">3.1 虚拟DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-1-1-前言" class="sidebar-link">3.1.1 前言</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-1-2-vnode类" class="sidebar-link">3.1.2  VNode类</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-1-3-vnode类能描述的类型节点" class="sidebar-link">3.1.3 VNode类能描述的类型节点</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-1-4-vnode类的作用" class="sidebar-link">3.1.4  VNode类的作用</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-1-5-总结" class="sidebar-link">3.1.5  总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-diff算法" class="sidebar-link">3.2 diff算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-1-前言" class="sidebar-link">3.2.1 前言</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-2-patch" class="sidebar-link">3.2.2 patch</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-3-创建节点" class="sidebar-link">3.2.3 创建节点</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-4-删除节点" class="sidebar-link">3.2.4 删除节点</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-5-更新节点" class="sidebar-link">3.2.5 更新节点</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-6-diff的整个流程" class="sidebar-link">3.2.6 diff的整个流程</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-2-7-总结" class="sidebar-link">3.2.7 总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-3-传统的更新子节点" class="sidebar-link">3.3 传统的更新子节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-3-1-前言" class="sidebar-link">3.3.1 前言</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-3-2-如何更新子节点" class="sidebar-link">3.3.2 如何更新子节点</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-优化的更新子节点" class="sidebar-link">3.4 优化的更新子节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-1-前言" class="sidebar-link">3.4.1 前言</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-2-新前与旧前对比" class="sidebar-link">3.4.2 新前与旧前对比</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-3-新后与旧后对比" class="sidebar-link">3.4.3 新后与旧后对比</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-4-新后与旧前对比" class="sidebar-link">3.4.4 新后与旧前对比</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-5-新前与旧后对比" class="sidebar-link">3.4.5 新前与旧后对比</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-6-源码解析" class="sidebar-link">3.4.6 源码解析</a></li><li class="sidebar-sub-header"><a href="/fp/vue2/virtualdomAndDiff.html#_3-4-7-总结" class="sidebar-link">3.4.7 总结</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page" data-v-266a5a28> <div class="ads" data-v-a4c8d602><div class="item" data-v-a4c8d602><h6 class="title" style="display:;" data-v-a4c8d602>联系作者</h6> <div class="thumb" data-v-a4c8d602><a href="/weixin.jpeg" target="_blank" data-v-a4c8d602><img src="/weixin.jpeg" alt="联系作者" data-v-a4c8d602></a></div></div></div> <div class="theme-default-content content__default"><h2 id="_3-1-虚拟dom"><a href="#_3-1-虚拟dom" class="header-anchor">#</a> 3.1 虚拟DOM</h2> <h3 id="_3-1-1-前言"><a href="#_3-1-1-前言" class="header-anchor">#</a> 3.1.1 前言</h3> <h4 id="操作真实dom的代价"><a href="#操作真实dom的代价" class="header-anchor">#</a> 🍅  操作真实DOM的代价</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> div<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    str <span class="token operator">+=</span> key <span class="token operator">+</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/vortual1.aa4da643.png" alt=""></p> <p>从打印结果可以看出，一个dom会有很多属性；真实的dom节点入栈执行会占据很大的内存，当我们频繁的操作会产生性能问题</p> <p>我们用传统的开发模式，用原生的js和jq操作DOM时，浏览器会从构建DOM树到绘制从头到尾执行一遍，如果我们更新10个dom节点，浏览器收到第一个dom请求后并不知道后面还有9次更新操作，最终会执行10次。如果第一次计算完，紧接这下一个DOM更新请求更改了前一次的DOM；那么前一次的dom更新就是白白的性能浪费，虽然计算机硬件一直迭代更新，但是操作dom的代价仍然是昂贵的，频繁操作还会出现页面卡顿，影响用户体验。</p> <h4 id="为什么虚拟dom"><a href="#为什么虚拟dom" class="header-anchor">#</a> 🍅  为什么虚拟DOM？</h4> <p>虚拟dom就是为了解决浏览器性能问题而设计出来的，如果有10次dom更新的操作，虚拟dom不会立即去操作dom，而是将这去10次更新的diff内容保存到本地的一个js对象中，最终将这个js对象一次性patch到DOM树上，再进行后续的操作，避免大量无畏的计算量，所以用js对象模拟DOM节点的好处是页面的更新可以先全部反应到这个js对象上，操作js对象的速度显然更快，等待更新完成后，在将最终的js对象映射真实的DOM。</p> <h4 id="vue中虚拟dom的表现"><a href="#vue中虚拟dom的表现" class="header-anchor">#</a> 🍅  vue中虚拟DOM的表现</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 通过js对象描述的dom结构</span>
   <span class="token punctuation">{</span>
       tag<span class="token operator">:</span> <span class="token string">'div'</span>
       data<span class="token operator">:</span> <span class="token punctuation">{</span>
           id<span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
           <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'main'</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       children<span class="token operator">:</span> <span class="token punctuation">[</span>
           <span class="token punctuation">{</span>
               tag<span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
               text<span class="token operator">:</span> <span class="token string">'this is test'</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>

 <span class="token comment">//最后真实渲染的dom结构</span>
   <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;mian&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token keyword">this</span> is test<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-1-2-vnode类"><a href="#_3-1-2-vnode类" class="header-anchor">#</a> 3.1.2  VNode类</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码地址：src/core/vdom/vnode.js</span>
<span class="token comment">// 通过vNode类，实例化出不同的虚拟DOM节点</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>

 <span class="token function">constructor</span> <span class="token punctuation">(</span>
   tag<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token comment">// 当前节点标签名</span>
   data<span class="token operator">?</span><span class="token operator">:</span> VNodeData<span class="token punctuation">,</span> <span class="token comment">// // 当前节点的数据对象，也就是标签上的属性；包括attrs,style,hook等具体包含的字段可以参考/types/vnode.d.ts</span>
   children<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token comment">////数组类型，包含当前节点的子节点</span>
   text<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token comment">// 当前节点的文本</span>
   elm<span class="token operator">?</span><span class="token operator">:</span> Node<span class="token punctuation">,</span>
   context<span class="token operator">?</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
   componentOptions<span class="token operator">?</span><span class="token operator">:</span> VNodeComponentOptions<span class="token punctuation">,</span>
   asyncFactory<span class="token operator">?</span><span class="token operator">:</span> Function
 <span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag <span class="token comment">// 当前节点标签名</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data <span class="token comment">// 当前节点的数据对象，也就是标签上的属性；包括attrs,style,hook等具体包含的字段可以参考/types/vnode.d.ts</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> children <span class="token comment">//数组类型，包含当前节点的子节点</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text <span class="token comment">// 当前节点的文本</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>elm <span class="token operator">=</span> elm <span class="token comment">// 当前虚拟节点对应的真实的dom节点</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>ns <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// 节点的namespace（命名空间）</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context <span class="token comment">// 编译作用域，当前节点对应的vue实例</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>fnContext <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// 函数组件化的作用域，当前组件对应的vue实例</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>fnOptions <span class="token operator">=</span> <span class="token keyword">undefined</span>  <span class="token comment">// 函数式组件Option选项</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>fnScopeId <span class="token operator">=</span> <span class="token keyword">undefined</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>key <span class="token comment">// 节点的key属性，用作节点的标识，有利于patch优化</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>componentOptions <span class="token operator">=</span> componentOptions <span class="token comment">// 创建组件实例时会用到的选项信息</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">//当前组件节点对应的vue实例</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">//组件的占位节点</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 是否为原生HTML或只是普通文本，innerHTML的时候为true，textContent的时候为false</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isStatic <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">//静态节点标识</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isRootInsert <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 是否作为根节点插入被&lt;transition&gt;包裹的节点，该属性的值为false</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isComment <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">//当前节点是否是注释节点</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isCloned <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">//当前节点是否为克隆节点</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isOnce <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 当前节点是否有v-once指令</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>asyncFactory <span class="token operator">=</span> asyncFactory
   <span class="token keyword">this</span><span class="token punctuation">.</span>asyncMeta <span class="token operator">=</span> <span class="token keyword">undefined</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isAsyncPlaceholder <span class="token operator">=</span> <span class="token boolean">false</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// DEPRECATED:向后兼容组件的别名</span>
 <span class="token comment">/* istanbul ignore next */</span>
 <span class="token keyword">get</span> <span class="token function">child</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>componentInstance
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>VNode类中包含了描述一个真实dom节点所需要的一系列属性，通过 VNode类可以描述各种真实dom节点</p> <h3 id="_3-1-3-vnode类能描述的类型节点"><a href="#_3-1-3-vnode类能描述的类型节点" class="header-anchor">#</a> 3.1.3 VNode类能描述的类型节点</h3> <ul><li><p>EmptyVNode: 没有内容的注释节点</p></li> <li><p>TextVNode: 文本节点</p></li> <li><p>CloneVNode: 克隆节点，可以是以上任意类型的节点，唯一的区别在于isCloned属性为true</p></li> <li><p>ComponentVNode: 组件节点</p></li> <li><p>FunctionalComponent: 函数式组件节点</p></li> <li><p>ElementVNode: 普通元素节点</p></li></ul> <p>...</p> <ol><li>EmptyVNode（注释节点）</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码地址：src/core/vdom/vnode.js</span>
<span class="token comment">// 创建注释节点</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> createEmptyVNode <span class="token operator">=</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 node<span class="token punctuation">.</span>text <span class="token operator">=</span> text
 node<span class="token punctuation">.</span>isComment <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//isComment为true，说明是一个注释节点</span>
 <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>从上面可以看出注释节点只需2个属性，text表示是注释内容；isComment表示是否是个注释节点</p> <ol start="2"><li>TextVNode（文本节点）</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码地址：src/core/vdom/vnode.js</span>
<span class="token comment">// 创建文本节点</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createTextVNode</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> string <span class="token operator">|</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>文本节点只需传入文本值即可</p> <ol start="3"><li>CloneVNode（克隆节点）</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码地址：src/core/vdom/vnode.js</span>
<span class="token comment">// 创建克隆节点</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cloneVNode</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> VNode</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
 <span class="token keyword">const</span> cloned <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
   vnode<span class="token punctuation">.</span>tag<span class="token punctuation">,</span>
   vnode<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
   <span class="token comment">// #7975</span>
   <span class="token comment">// clone children array to avoid mutating original in case of cloning</span>
   <span class="token comment">// a child.</span>
   vnode<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   vnode<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
   vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
   vnode<span class="token punctuation">.</span>context<span class="token punctuation">,</span>
   vnode<span class="token punctuation">.</span>componentOptions<span class="token punctuation">,</span>
   vnode<span class="token punctuation">.</span>asyncFactory
 <span class="token punctuation">)</span>
 cloned<span class="token punctuation">.</span>ns <span class="token operator">=</span> vnode<span class="token punctuation">.</span>ns
 cloned<span class="token punctuation">.</span>isStatic <span class="token operator">=</span> vnode<span class="token punctuation">.</span>isStatic
 cloned<span class="token punctuation">.</span>key <span class="token operator">=</span> vnode<span class="token punctuation">.</span>key
 cloned<span class="token punctuation">.</span>isComment <span class="token operator">=</span> vnode<span class="token punctuation">.</span>isComment
 cloned<span class="token punctuation">.</span>fnContext <span class="token operator">=</span> vnode<span class="token punctuation">.</span>fnContext
 cloned<span class="token punctuation">.</span>fnOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>fnOptions
 cloned<span class="token punctuation">.</span>fnScopeId <span class="token operator">=</span> vnode<span class="token punctuation">.</span>fnScopeId
 cloned<span class="token punctuation">.</span>asyncMeta <span class="token operator">=</span> vnode<span class="token punctuation">.</span>asyncMeta
 cloned<span class="token punctuation">.</span>isCloned <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token keyword">return</span> cloned
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>克隆节点就是把传入的节点的属性全部赋值到新创建的节点上</p> <ol start="4"><li><p>ComponentVNode（组件节点）</p> <p>源码地址：src/core/vdom/create-component.js</p> <p>组件节点除了有普通元素节点的属性之外，还有2个私有的属性</p> <ul><li>componentOptions  创建组件实例时会用到的选项信息</li> <li>componentInstance 当前组件节点对应的vue实例</li></ul></li> <li><p>FunctionalComponent（函数式组件节点）</p> <p>源码地址：src/core/vdom/create-functional-component.js</p> <p>函数式组件2个私有的属性</p> <ul><li>fnContext  函数组件化的作用域，当前组件对应的vue实例</li> <li>fnOptions  函数式组件Option选项</li></ul></li> <li><p>ElementVNode（普通元素节点）</p> <p>源码地址：src/core/vdom/create-element.js</p></li></ol> <h3 id="_3-1-4-vnode类的作用"><a href="#_3-1-4-vnode类的作用" class="header-anchor">#</a> 3.1.4  VNode类的作用</h3> <p>VNode类用js对象形式描述真实的dom，在vue初始化阶段，我们把<code>template</code>模板用<code>vnode</code>类实例化成js对象并缓存下来，当数据发生变化重新渲染页面的时候，我们把数据发生变化后用<code>vnode</code>类实例化的js对象与前一次缓存下来描述dom节点的js对象进行对比，找出差异；然后根据有差异的节点创建出真实的节点插入视图当中</p> <h3 id="_3-1-5-总结"><a href="#_3-1-5-总结" class="header-anchor">#</a> 3.1.5  总结</h3> <p>虚拟dom就是用以对象的形式去描述真实的dom，用js计算的性能换取操作真实dom所消耗的性能</p> <h2 id="_3-2-diff算法"><a href="#_3-2-diff算法" class="header-anchor">#</a> 3.2 diff算法</h2> <h3 id="_3-2-1-前言"><a href="#_3-2-1-前言" class="header-anchor">#</a> 3.2.1 前言</h3> <p>上章我们学习了虚拟dom，知道了渲染真实dom的开销很大，如果我们修改了某个数据，如果直接渲染到真实的dom上会引起整个dom树的重绘和重排；
有没有可能我们只更新修改的那一块dom，diff算法能帮到我们，我们先根据真实的dom生成一个virtual DOM树，当virtual dom树的某个节点发生变化后生成一个新的vnode，然后Vnode和oldVnode进行对比，一边比较一边给真实DOM打补丁，找出差异的过程就是diff的过程。</p> <p><font color="black"><strong>vnode：数据变化后要渲染的虚拟的dom节点</strong></font></p> <p><font color="black"><strong>oldVnode：数据变化前视图对应的真实的dom节点</strong></font></p> <h3 id="_3-2-2-patch"><a href="#_3-2-2-patch" class="header-anchor">#</a> 3.2.2 patch</h3> <p><font color="blue"><strong>vue中把Diff过程叫做patch过程,patch的过程就是以新的Vnode为基准，去改造旧的oldNode，让其跟新的一样；有人会说了，直接把旧的替换成新的就行了吗，如果这样做的话就是更新整个视图，而我们现在想做的是哪里变化了更新哪里。</strong></font></p> <p><font color="red"><strong>举个例子：</strong></font>现在你手上有个纸板的文档，公司让你做成电子版的；你看了看内容发现好像以前做过，于是你翻了电脑，果不其然上周公司上你做过。你仔细对比一下内容，发现只有某一段的内容不一样，于是在你面前有2个办法：1.参考纸版去改老版的。2.在建个文档，把纸版的内容从新输入到电脑。这样一看那肯定是要选择方案1，而我们的vue中也是这样。</p> <h4 id="patch的过程就是做3件事情"><a href="#patch的过程就是做3件事情" class="header-anchor">#</a> 🍅  patch的过程就是做3件事情</h4> <ul><li>创建节点：Vnode里有的，oldNode没有，那么就在oldNode里创建节点</li> <li>删除节点：Vnode里没有，oldNode有，那么旧在oldNode删除节点</li> <li>更新节点：Vnode和oldNode都有，那么以Vnode基准去更新oldNode</li></ul> <h4 id="了解一下oldvnode有哪些属性"><a href="#了解一下oldvnode有哪些属性" class="header-anchor">#</a> 🍅  了解一下oldVnode有哪些属性</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;test&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;main&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 

<span class="token comment">// 上面节点对应的 oldVnode 就是</span>
<span class="token punctuation">{</span>
  elm<span class="token operator">:</span>  div  <span class="token comment">//对真实的节点的引用，本例中就是document.querySelector('v#test.main')</span>
  tag<span class="token operator">:</span> <span class="token string">'DIV'</span><span class="token punctuation">,</span>   <span class="token comment">//节点的标签</span>
  sel<span class="token operator">:</span> <span class="token string">'div#test.main'</span>  <span class="token comment">//节点的选择器</span>
  data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>       <span class="token comment">// 一个存储节点属性的对象，对应节点的el[prop]属性，例如onclick , style</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//存储子节点的数组，每个子节点也是vnode结构</span>
  text<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token comment">//如果是文本节点，对应文本节点，否则为null</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>需要注意的是，elm属性引用的是此virtual dom对应的真实dom，patch的vnode参数的elm最初是null，因为patch之前它还没有对应的真实dom</p> <h3 id="_3-2-3-创建节点"><a href="#_3-2-3-创建节点" class="header-anchor">#</a> 3.2.3 创建节点</h3> <p>从上章我们知道通过Vnode类可以创建6种描述的dom节点的实例，是实际只有3种会被创建，并插入dom当中，3种分别是：元素节点、注释节点、文本节点</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码位置: /src/core/vdom/patch.js</span>

<span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
    <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
    <span class="token keyword">const</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//判断是否有tag标签</span>
      vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>   <span class="token comment">// 创建元素节点</span>
      <span class="token function">createChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> children<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span> <span class="token comment">// 创建元素节点的子节点</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>       <span class="token comment">// 插入到DOM中</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//判断注释属性是否是true，true的话就是注释节点</span>
      vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment">// 创建注释节点</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>           <span class="token comment">// 插入到DOM中</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 如果不是元素节点和注释节点，那么就是文本节点</span>
      vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment">// 创建文本节点</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>           <span class="token comment">// 插入到DOM中</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isDef</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> v <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">!==</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>       
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3-2-4-删除节点"><a href="#_3-2-4-删除节点" class="header-anchor">#</a> 3.2.4 删除节点</h3> <p>删除节点比较简单，只需调用删除元素的父元素的removeChild方法</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码位置: /src/core/vdom/patch.js</span>
  <span class="token keyword">function</span> <span class="token function">removeVnodes</span> <span class="token punctuation">(</span><span class="token parameter">vnodes<span class="token punctuation">,</span> startIdx<span class="token punctuation">,</span> endIdx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> startIdx <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>startIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> ch <span class="token operator">=</span> vnodes<span class="token punctuation">[</span>startIdx<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 存在tag时，说明是元素节点</span>
          <span class="token function">removeAndInvokeRemoveHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token comment">// 移除挂载dom上的节点</span>
          <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token comment">//销毁的钩子</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// Text node</span>
          <span class="token comment">// 说明是文本节点</span>
          <span class="token function">removeNode</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isDef</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> v <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">!==</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-2-5-更新节点"><a href="#_3-2-5-更新节点" class="header-anchor">#</a> 3.2.5 更新节点</h3> <p>更新节点是vNode和oldVnode都存在时，我们需要细致的找出不同的地方</p> <h4 id="先了解一下静态节点"><a href="#先了解一下静态节点" class="header-anchor">#</a> 🍅  先了解一下静态节点</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>像上面的节点就是静态节点，就是不用变化的节点，没有绑定任何变量，第一次渲染后，以后就不会变化了</p> <h4 id="这个函数做了一下事情"><a href="#这个函数做了一下事情" class="header-anchor">#</a> 🍅  这个函数做了一下事情</h4> <ol><li>找到真实的dom节点，称之为elm</li> <li>判断vNode和oldnode如果是同一个对象，则直接return</li> <li>如果vNode和oldnode都是静态节点，则直接return</li> <li>如果vnode没有文本节点
<ul><li>2者都有子节点且不相同，则执行updateChildren比较子节点，比较子节点在下一章介绍。</li> <li>若只有vnode存在子节点，在判断oldVnode是否有文本，如果有就清除，然后将vnode的子节点替换到真实的dom中去</li> <li>若只有oldVnode存在子节点，则清空dom种子节点的存在</li> <li>若2者都没有子节点，则oldnode种有文本，则清空oldnode的文本</li></ul></li> <li>如果vnode和oldVnode都有文本节点且不相同：
则将elm的文本节点设置为vnode的文本节点(文本节点就是text对应的值)</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码位置: /src/core/vdom/patch.js</span>
  <span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span>
    <span class="token parameter">oldVnode<span class="token punctuation">,</span>
    vnode<span class="token punctuation">,</span>
    insertedVnodeQueue<span class="token punctuation">,</span>
    ownerArray<span class="token punctuation">,</span>
    index<span class="token punctuation">,</span>
    removeOnly</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// vnode和oldVnode是完全一样，说明引用一致，没有什么变化；如果是就退出程序</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// 让vnode.elm引用到现在的真实dom上，当elm修改时，vnode.elm会同步变化</span>
    <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm

    <span class="token comment">// 如果vnode和oldVnode都是静态节点就退出程序，静态节点，无论数据发生任何变化都与它无关</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isStatic<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      <span class="token function">isTrue</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>isStatic<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      vnode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVnode<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span>
      <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isCloned<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isOnce<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>componentInstance
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children
    <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
 
    <span class="token comment">// vnode如果没有text属性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果vnode的子节点和oldVnode的子节点都存在</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  若都存在且不相同，则更新子节点，这是diff的核心</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> 
      <span class="token comment">// 若只有vnode存在子节点</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
         <span class="token comment">// 判断oldVnode是否有文本，如果有则清空dom中的文本，再把vnode的子节点添加到真实的DOM中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
   
      <span class="token punctuation">}</span> 
      <span class="token comment">// 若只有oldVnode存在子节点</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 清空dom中的节点</span>
        <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
     
      <span class="token punctuation">}</span> 
      <span class="token comment">// 如果oldVnode和node都没有子节点，但oldVnode有text</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 那么清空oldVnode文本</span>
        nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

    <span class="token comment">// 如果vnode和oldVnode有text属性，但是oldVnode和vnode的text不相同</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 不相同则用vnode.text替换真实的dom文本</span>
      nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h4 id="更新节点流程"><a href="#更新节点流程" class="header-anchor">#</a> 🍅  更新节点流程</h4> <p><img src="/assets/img/patchnode.688c43e2.png" alt=""></p> <h3 id="_3-2-6-diff的整个流程"><a href="#_3-2-6-diff的整个流程" class="header-anchor">#</a> 3.2.6 diff的整个流程</h3> <h4 id="diff的比较方式"><a href="#diff的比较方式" class="header-anchor">#</a> 🍅  diff的比较方式</h4> <p>pach的过程只会进行同级比较，不会跨级，如果两个子节点一样，那么就深入检查他们的子节点，如果2个子节点不一样，就直接替换oldVnode，即使这2个子节点的子节点一样，如果第一层不一样就不会深入比较第二层</p> <p><img src="/assets/img/patch.b240a28e.png" alt=""></p> <h4 id="流程"><a href="#流程" class="header-anchor">#</a> 🍅  流程</h4> <p>从上面看下来,我们了解到了patch要做些什么,无非就是创建、删除、更新；下面我们来分析整个流程</p> <p>初始化时，通过render函数生成vNode，同时也进行了Watcher的绑定，当数据发生变化时，会执行_update方法，生成一个新的VNode对象，然后调用 __patch__方法，比较VNode和oldNode，最后将节点的差异更新到真实的DOM树上
vue在update的时候会调用以下函数</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码位置: /src/instance/lifecycle.js</span>
 <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">lifecycleMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">const</span> prevVnode <span class="token operator">=</span> vpatch__ is injected <span class="token keyword">in</span> entry points
      <span class="token comment">// based on the rendering backend used.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">// 初次渲染，会传入原生dom节点和虚拟dom节点</span>
        vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* removeOnly */</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 更新</span>
        vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

 <span class="token punctuation">}</span>
      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>vm._patch_才是进行vnode diff的核心，来看看patch是怎么打补丁的（代码只保留核心部分）</p> <p>patch的会有3种情况</p> <ol><li>如果vnode不存在，oldVnode存在；那么需要销毁真实的dom节点</li> <li>如果vnode存在，oldVnode不存在；那么需要创建节点</li> <li>2者都存在，进行比较</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// 源码位置: /src/core/vdom/patch.js</span>
 <span class="token comment">/**
   * oldVnode 旧的真实的DOM节点
   * vnode  节点变化后生成新的Vnode
   */</span>
 <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 如果vnode不存在，oldVnode存在，则调用销毁钩子销毁节点invokeDestroyHook(oldVnode)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> isInitialPatch <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">const</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token comment">// 如果oldVnode不存在，Vnode存在，那么创建新节点，则调用createElm()</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// empty mount (likely as component), create new root element</span>
      isInitialPatch <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
      <span class="token comment">// 当Vnode和oldVnode都存在时</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> isRealElement <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRealElement <span class="token operator">&amp;&amp;</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// patch 现有的根节点,对oldVnode和vnode进行diff，并对oldVnode打patch</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
        
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><code>sameVnode</code>函数是判断2个节点是否是同一个节点</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token comment">// 源码位置: /src/instance/lifecycle.js</span>
<span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// key值</span>
    a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>
        a<span class="token punctuation">.</span>tag <span class="token operator">===</span> b<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span> <span class="token comment">//标签名</span>
        a<span class="token punctuation">.</span>isComment <span class="token operator">===</span> b<span class="token punctuation">.</span>isComment <span class="token operator">&amp;&amp;</span> <span class="token comment">// 2个节点是否是注释节点</span>
        <span class="token comment">// 2个节点是否都定义了data，data中包含一些具体信息，例如：class，style</span>
        <span class="token function">isDef</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">isDef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">sameInputType</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment">// 当标签是input的时候，type必须相同</span>
      <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token function">isTrue</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>asyncFactory <span class="token operator">===</span> b<span class="token punctuation">.</span>asyncFactory <span class="token operator">&amp;&amp;</span>
        <span class="token function">isUndef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
        
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-2-7-总结"><a href="#_3-2-7-总结" class="header-anchor">#</a> 3.2.7 总结</h3> <p>上面我们学习了diff的基本流程,在diff的整个过程就是创建节点、删除节点、更新节点，对源码也进行了讲解；下面我们将对vnode和oldNode都包含子节点的情况进行分析，这是diff的核心。</p> <h2 id="_3-3-传统的更新子节点"><a href="#_3-3-传统的更新子节点" class="header-anchor">#</a> 3.3 传统的更新子节点</h2> <h3 id="_3-3-1-前言"><a href="#_3-3-1-前言" class="header-anchor">#</a> 3.3.1 前言</h3> <p>上一章我们学习了在patch过程中主要干3件事:创建节点、删除节点、更新节点，前2种都很简单，而更新节点较难些，本章我们要学习的是当vnode和oldVnode都有子节点，需要更新子节点的情况，这是dom-diff的核心，也是本章要学习的内容。</p> <h3 id="_3-3-2-如何更新子节点"><a href="#_3-3-2-如何更新子节点" class="header-anchor">#</a> 3.3.2 如何更新子节点</h3> <h4 id="传统的节点对比方式"><a href="#传统的节点对比方式" class="header-anchor">#</a> 🍅  传统的节点对比方式</h4> <p>当vnode和oldVnode都有子节点时，我们会比较虚拟dom对象中的children,这个数组包含了所有子节点。我们把包含vnode的所有子节点数组命名为newCh而oldVnode的所有子节点命名为oldCh，现在我们通过循环对比子节点。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>newCh<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">newChild</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  oldCh<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">oldChild</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token comment">// 处理逻辑省略</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/assets/img/patch1.89b5fa32.png" alt=""></p> <p>从上面代码和图可知，假如newCh和oldCh都包含的是<code>li</code>标签，我们通过循环进行比较新旧子节点，newCh每项节点会跟oldCh的每项节点进行对比。</p> <h4 id="理解未处理与已处理"><a href="#理解未处理与已处理" class="header-anchor">#</a> 🍅  理解未处理与已处理</h4> <p><img src="data:image/png;base64,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" alt=""></p> <p>从上图可知,我们假如newCh数组中的前2个子节点在dlCh数组中找到了对应的节点并给odlCh打了补丁,我们可以把已经对比过的称为已处理,没有对比的我们称未处理。</p> <h4 id="对比中会出现以下几种情况"><a href="#对比中会出现以下几种情况" class="header-anchor">#</a> 🍅  对比中会出现以下几种情况</h4> <ol><li><font><strong>创建子节点：</strong></font></li></ol> <p>newCh某个节点跟oldCh的每个节点进行对比，发现没有找到，那么需要创建节点插入到oldCh中</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>当newCh的第二节点在oldCh里面没找到时，我们需要创建节点，创建完节点那我们插入到什么位置？假设我们插入已处理的后面，看起来是对的，那么如果newCh第三个节点在oldCh里面再没找到时，还适用这种方式吗？</p> <p><img src="data:image/png;base64,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HuRWfU03cX1vBnred41xao8jVL3opytw0nAGshoJVGNLI8ADzQrSFgSfXxeCpQUpsazi1jonjGi3LfDY2z+yIY+UGJt70IuT/7agKTz2Qk4uiE/4BFSe+FhVwznD2VAjSfwy8Q18/JB9f+Vb2cSbSDgJQyJYaIEJfr/yLZHCkZZwvG9/4PYQp2JxvOztN83CzAKm0NOUeJEyBQLhWWniqWDimxi4U8pIxF3SwBrAbEqewdIyiB6HFI9N8xi+g39mivtqJ83iZiSfEqYukf+R03GMyLNLGJZM/metjj11Xkl6XaPT/yev4r7sXFCtrk+vccHIYmLBMdmql2QyLplXq1h8mxdJV63oROFLqQzWkDmXSBcNLUGGola9XsV0c55kzSimFTKQtP+OC3tgp01tmGZav66vmqZgaPjkkPmTS6YgqOaJo6YhCHULjzzokxSldOiwnlOwq7CPEsqNcwpiBxPuHyawzy6dIwDInh/IHkyB7B08yB4gez4hezAFsnfwIHuA7PmE7MEUyN7Bg+wBsucTsgdTIHsHD7IHyJ5PyB5MgewdPMgeIHs+IXswBbJ38CB7gOz9Y59ecRuGgjCMGtUPRU5YURYTmYY3sKjr6NIrFVvVbyW3skfn4zND5oSxp5XYO17sib0w9rQSe8eLPbEXxp5WYu94sSf2wtjTSuwdL/bEXhh7Wom948We2AtjTyuxd7zYE3th7BXtbWjY8r6xz3HrxDK0rHtJy7SnruNpH90vLZunf+i5B/m+9+163K4b2zpwe/QNu74GXz9PO+rrtJPGS8M+TlP75r57pvnc/dl+l/92nruG9cOe1lRr7Bo2rLDY2xH22Mtjjz32CsQee+zFscceewVijz324thjj70Csccee3Hsscdegdhjj7049thjr0DsscdeHHvssVcg9thjL4499tgrEHvssRfHHnvsFYg99tiLY4899grEHnvsxbHHHnsFYo899uLYY4+9ArHHHntx7LHHXoHYY4+9OPbYY69A7LHHXhx77LFXIPbYYy+OPfbYKxB77LEXxx577BWIPfbYi2OPPfYKxB577MWxxx57BWKPPfbi2GOPvQKxxx57ceyxx16B2GOPvTj22GOvQOyxx14ce+yxVyD22GMvjj322CsQe+yxF8cee+wViD322Itjjz32CsQee+zFscceewVijz324tj7Ya8MdRwG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" alt=""></p> <p>从上图可以看出newCh第三个节点在oldCh里面再没找到时，按照上面的逻辑插入已处理的后面，那么这次新增的节点将会插入oldCh第二位置，那么2个节点的位置就不对应了，应该newCh第三个节点要对应oldCh第三的位置才行，<font color="red"><strong>所以我们新增的节点应该插入未处理的前面就适应各种场景了</strong></font></p> <ol start="2"><li><font><strong>删除子节点：</strong></font></li></ol> <p>当newCh的第一个节点都循环完后，发现oldCh里面还有未处理的节点；这就说明在newCh没有这个节点；那么我们需要删除oldCh未处理的节点</p> <p><img src="data:image/png;base64,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" alt=""></p> <ol start="3"><li><font><strong>移动子节点：</strong></font></li></ol> <p>newCh的某个节点跟oldCh每一个节点对比中发现有相同的，但是位置不同，那么我们需要更新oldCh的该节点让其与newCh的相同，在以newCh位置为基准去移动oldCh这个节点的位置，可以参考下图中，newCh的第二个节点与oldCh的最后一个节点相同，但位置不同，那么我们需要移动oldCh最后一个节点的位置</p> <p><img src="data:image/png;base64,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" alt=""></p> <ol start="4"><li><font><strong>更新子节点：</strong></font></li></ol> <p>当newCh的某个节点和oldCh某个节点相同，位置也相同，那么我们需要更新oldCh的该节点让其与newCh的相同</p> <h2 id="_3-4-优化的更新子节点"><a href="#_3-4-优化的更新子节点" class="header-anchor">#</a> 3.4 优化的更新子节点</h2> <h3 id="_3-4-1-前言"><a href="#_3-4-1-前言" class="header-anchor">#</a> 3.4.1 前言</h3> <p>我们上章传统的做法是拿newCh的每个子节点跟oldCh的子节点逐一对比，根据找到或没找到；不同的情况去做不同的处理。这种做法虽然能解决问题，但是有不足的地方，当子节点过多，这种循环算法变得很复杂；从而影响页面加载，本章我们将介绍vue中是怎么做的。</p> <h4 id="传统做法的缺点"><a href="#传统做法的缺点" class="header-anchor">#</a> 🍅  传统做法的缺点</h4> <p>传统的做法拿newCh的每个子节点跟oldCh的子节点逐一对比，如果运气好的话newCh数组的第一个节点跟oldCh数组的第一个节点相同，那么
就可以结束newCh数组的第一个节点的循环对比，如果运气差的话要对比到oldCh数组的最后一个节点，如果oldCh数组里有20个节点就要循环20次。</p> <h4 id="vue中优化的做法"><a href="#vue中优化的做法" class="header-anchor">#</a> 🍅  vue中优化的做法</h4> <p><font color="red"><strong>概念介绍</strong></font></p> <ul><li>新前：newCh数组中第一个未处理的节点</li> <li>新后：newCh数组中最后一个未处理的节点</li> <li>旧前：oldCh数组中第一个未处理的节点</li> <li>旧后：oldCh数组中第一个未处理的节点</li></ul> <p>既然我们考虑到有极端的情况，那么我们不按顺序去循环对比2个数组，可以先比较数组中特殊的位置的节点，例如：</p> <ol><li><font><strong>新前旧前对比</strong></font>（第一种情况）</li></ol> <p>先拿newCh数组未处理的第一个节点和oldCh数组未处理的第一个节点进行对比，如果相同就更新节点，如果不同就进入第二种情况的对比</p> <ol start="2"><li><font><strong>新后旧后对比</strong></font>（第二种情况）</li></ol> <p>再拿newCh数组未处理的最后一个节点和oldCh数组未处理的最后一个节点进行对比，如果相同就更新节点，如果不同就进入第三种情况的对比</p> <ol start="3"><li><font><strong>新后旧前对比</strong></font>（第三种情况）</li></ol> <p>再拿newCh数组未处理的最后一个节点和oldCh数组未处理的第一个节点进行对比，如果相同就更新节点，如果不同就进入第四种情况的对比</p> <ol start="4"><li><font><strong>新前与旧后对比</strong></font>（第四种情况）</li></ol> <p>再拿newCh数组未处理的第一个节点和oldCh数组未处理的最后一个节点进行对比，如果相同就更新节点，如果不同就进入常规的对比，后面会介绍</p> <p>四种情况对比如图所式</p> <p><img src="/assets/img/patch7.846bc240.png" alt=""></p> <h3 id="_3-4-2-新前与旧前对比"><a href="#_3-4-2-新前与旧前对比" class="header-anchor">#</a> 3.4.2 新前与旧前对比</h3> <p>参考上一张图，这种情况对比，无需移动位置</p> <h3 id="_3-4-3-新后与旧后对比"><a href="#_3-4-3-新后与旧后对比" class="header-anchor">#</a> 3.4.3 新后与旧后对比</h3> <p>参考上一张图，这种情况对比，无需移动位置</p> <h3 id="_3-4-4-新后与旧前对比"><a href="#_3-4-4-新后与旧前对比" class="header-anchor">#</a> 3.4.4 新后与旧前对比</h3> <p>这种对比方式，如果newCh中未处理最后一个节点与oldCh中未处理的第一个节点对比发现相同，那么要参照newCh节点的位置去移动oldCh这个节点的位置。</p> <p><img src="/assets/img/patch8.2229fb94.png" alt=""></p> <h3 id="_3-4-5-新前与旧后对比"><a href="#_3-4-5-新前与旧后对比" class="header-anchor">#</a> 3.4.5 新前与旧后对比</h3> <p>这种对比方式，如果newCh中未处理第一个节点与oldCh中未处理的最后一个节点对比发现相同，那么要参照newCh节点的位置去移动oldCh这个节点的位置。</p> <p><img src="/assets/img/patch9.7d06d181.png" alt=""></p> <h3 id="_3-4-6-源码解析"><a href="#_3-4-6-源码解析" class="header-anchor">#</a> 3.4.6 源码解析</h3> <p>千呼万唤始出来，终于来到了我们的源码篇，根据上面的知识的铺垫，我们对vue中的diff做法有了一定了解，那么我们下面深入源码中看看是怎么做的</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 源码位置: /src/core/vdom/patch.js</span>
<span class="token comment">//循环更新子节点</span>
<span class="token keyword">function</span> <span class="token function">updateChildren</span> <span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//oldCh开始的索引</span>
  <span class="token keyword">let</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//newCh开始的索引</span>
  <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">//oldCh结束的索引</span>
  <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">//oldCh未处理的第一个节点</span>
  <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span> <span class="token comment">//oldCh未处理的最后一个节点</span>
  <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">//newCh结束的索引</span>
  <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// newCh中未处理节点中的第一个节点</span>
  <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span><span class="token comment">// newCh中未处理节点的最后一个节点</span>
  <span class="token keyword">let</span> oldKeyToIdx<span class="token punctuation">,</span> idxInOld<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">,</span> refElm

  <span class="token comment">// removeOnly is a special flag used only by &lt;transition-group&gt; removeOnly是仅由&lt;transition group&gt;使用的特殊标志</span>
  <span class="token comment">// to ensure removed elements stay in correct relative positions // 确保拆下的元件保持在正确的相对位置</span>
  <span class="token comment">// during leaving transitions</span>
  <span class="token keyword">const</span> canMove <span class="token operator">=</span> <span class="token operator">!</span>removeOnly


  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>newCh<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// oldCh第一个节点不存在，索引右移，进入下一个节点</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// oldCh最后一个节点不存在，索引左移，进入上一个节点</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 利用sameVnode函数,判断是否是同一个节点</span>
      <span class="token comment">// 如果oldStartVnode和newStartVnode是同一个节点，就进行patchVnode                                                 </span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span>
      <span class="token comment">// 索引右移，继续循环</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token comment">// 如果oldEndVnode和newEndVnode是同一个节点，就进行patchVnode       </span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span>
       <span class="token comment">// 索引左移，继续循环</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved right  </span>
      <span class="token comment">// 如果oldStartVnode和newEndVnode是同一个节点,然后把oldStartVnode移动到oldCh所有未处理的节点之后</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span>
      <span class="token comment">// 将oldStartVnode.elm移动到oldEndVnode.elm之后</span>
      canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span> <span class="token comment">// 索引右移，获取下个节点</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token comment">// // 索引左移，获取上个节点</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved left</span>
       <span class="token comment">// 如果oldEndVnode和newStartVnode是同一个节点,,然后把oldEndVnode移动到oldCh所有未处理的节点之前</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span>
      <span class="token comment">// 将oldEndVnode.elm移动到oldStartVnode.elm之前</span>
      canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>  <span class="token comment">// 索引左移，获取上个节点</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span> <span class="token comment">// 索引右移，获取下个节点</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
      <span class="token comment">// 上面几种都不符合的话,进行常规的循环对比patch</span>
      <span class="token comment">// createKeyToOldIdx建立key和index索引的对应关系,并返回一个对象</span>
      <span class="token comment">// 对应关系{key1:0,Key2:1,key3:2}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldKeyToIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span>

       <span class="token comment">// 尝试在oldCh里找到跟newStartVnode同一个节点，并拿到这个节点的index</span>
      idxInOld <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token comment">//判断newStartVnode有没有key值</span>
        <span class="token operator">?</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token comment">// newStartVnode有key值的话，拿到oldCh对应的index</span>
        <span class="token operator">:</span> <span class="token function">findIdxInOld</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span> 
        <span class="token comment">// newStartVnode没有key值的话，采用循环比较的方式，在oldCh中找到newStartVnode对应的节点并拿到index</span>

      <span class="token comment">// 在oldCh里找不到与newStartVnode对应的index，说明newStartVnode是一个新节点</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>idxInOld<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// New element</span>
        <span class="token comment">// 创建新的dom节点,插入到oldStartVnode.elm前面</span>
        <span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
        <span class="token comment">// 在oldCh里找不到与newStartVnode对应的index，叫vnodeToMove</span>
        vnodeToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token comment">// 用index拿到对应的子节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果是同一个节点就进行更新节点</span>
          <span class="token function">patchVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span>
          oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span>
          <span class="token comment">/**
           *  canMove为true表示需要移动节点,false则不移动
           */</span>
          canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// same key but different element. treat as new element</span>
          <span class="token comment">// 如果index相同,但节点不相同,被视为新元素;创建新的dom节点</span>
          <span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 右移</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 如果oldCh比newCh先遍历完,那么说明newCh里剩余的节点都是要新增的节点,
   * 把[ newStartIdx, newEndIdx]之间的所有的节点都插入dom中
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    refElm <span class="token operator">=</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>elm
    <span class="token comment">// 添加newVnode中剩余的节点到parentElm中</span>
    <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
   * 如果oldCh比newCh后遍历完,那么说明newCh里剩余的节点都是要删除的节点,
   * 把[ newStartIdx, newEndIdx]之间的所有的节点都删除
   */</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div><p>updateChildren中的<code>newStartIdx</code>、<code>oldStartIdx</code>、<code>newEndIdx</code>、<code>oldEndIdx</code>这几个变量，可能让我们疑惑，那么下面我们看一看是干什么用的？</p> <ul><li>newStartIdx:newCh开始的索引</li> <li>newEndIdx:newCh结束的索引</li> <li>oldStartIdx:oldCh开始的索引</li> <li>oldEndIdx:oldCh结束的索引</li></ul> <p>这些索引的作用是，在newCh和oldCh对比的时候，从2头往中间对比
<img src="data:image/png;base64,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" alt=""></p> <h4 id="key的作用"><a href="#key的作用" class="header-anchor">#</a> 🍅  key的作用</h4> <ul><li><p>设置key以后，除了头尾两端比较之外，还可以从key生成的oldKeyToIdx对象中查找对应的节点。</p></li> <li><p>不设置key以后，除了头尾两端比较之外，只能循环查找。</p></li></ul> <p>所以vue中key是vnode的唯一标记，通过key，我们的diff操作可以更加准确，更加快速。</p> <h4 id="尽量不要用index做key"><a href="#尽量不要用index做key" class="header-anchor">#</a> 🍅 尽量不要用index做key</h4> <p>如果我们用index做key值，当我们删除一个节点，在进行diff的时候，oldCh用key对应newCh里节点可能就不是同一个节点，例如你删除索引为2的节点，那么会生成新的vnode；然而以前索引为3的节点会变成现在索引为2的节点，在进行patch的时候我们就根本不知道删除的节点为2。当然index的弊端还有其它按情况。</p> <h3 id="_3-4-7-总结"><a href="#_3-4-7-总结" class="header-anchor">#</a> 3.4.7 总结</h3> <p>Vue 的 diff 过程可以概括为：oldCh 和 newCh 各有两个头尾的变量 oldStartIdx、oldEndIdx 和 newStartIdx、newEndIdx，它们会新节点和旧节点会进行两两对比，即一共有4种比较方式：newStartIdx对应节点和oldStartIdx对应节点 、newEndIdx对应节点 和 oldEndIdx对应节点 、newStartIdx对应节点 和 oldEndIndex对应节点、newEndIndex对应节点 和 oldStartIndex对应节点，如果以上 4 种比较都没匹配，如果设置了key，就会用 key 再进行比较，在比较的过程中，遍历会往中间靠，一旦 StartIdx &gt; EndIdx 表明 oldCh 和 newCh 至少有一个已经遍历完了，就会结束比较。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/13/2025, 7:45:34 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fp/vue2/dataResponse.html" class="prev">响应式</a></span> <!----></p></div> </main> <footer class="footer" data-v-266a5a28><div class="container" data-v-266a5a28><p class="text-center" data-v-266a5a28>© 2024 web全栈体系. All Rights Reserved.（所有文章未经授权禁止转载、摘编、复制或建立镜像，如有违反，追究法律责任。）</p> <p class="text-center" data-v-266a5a28><a href="https://beian.miit.gov.cn" target="_blank" data-v-266a5a28>豫ICP备19041317号-1</a></p></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0f616eb6.js" defer></script><script src="/assets/js/3.9750fba5.js" defer></script><script src="/assets/js/2.6aa46093.js" defer></script><script src="/assets/js/8.ffcc6d32.js" defer></script>
  </body>
</html>
