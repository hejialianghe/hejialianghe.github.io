<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5.1 构建简史 | web全栈体系</title>
    <meta name="description" content="你好，朋友">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.5718d53e.css" as="style"><link rel="preload" href="/assets/js/app.0f616eb6.js" as="script"><link rel="preload" href="/assets/js/3.9750fba5.js" as="script"><link rel="preload" href="/assets/js/2.6aa46093.js" as="script"><link rel="preload" href="/assets/js/15.3e7fea41.js" as="script"><link rel="prefetch" href="/assets/js/10.3b417cc7.js"><link rel="prefetch" href="/assets/js/100.450b51bc.js"><link rel="prefetch" href="/assets/js/101.02365136.js"><link rel="prefetch" href="/assets/js/102.23f6118f.js"><link rel="prefetch" href="/assets/js/103.4decf838.js"><link rel="prefetch" href="/assets/js/104.d39cfd73.js"><link rel="prefetch" href="/assets/js/105.88534338.js"><link rel="prefetch" href="/assets/js/106.366d0b59.js"><link rel="prefetch" href="/assets/js/107.cf3cfcba.js"><link rel="prefetch" href="/assets/js/108.21694919.js"><link rel="prefetch" href="/assets/js/109.4e4fd62e.js"><link rel="prefetch" href="/assets/js/11.9d20f01b.js"><link rel="prefetch" href="/assets/js/110.aeb394e4.js"><link rel="prefetch" href="/assets/js/111.d6595775.js"><link rel="prefetch" href="/assets/js/12.ac6dcc46.js"><link rel="prefetch" href="/assets/js/13.3990b71a.js"><link rel="prefetch" href="/assets/js/14.42418305.js"><link rel="prefetch" href="/assets/js/16.e9242241.js"><link rel="prefetch" href="/assets/js/17.5cb2a82b.js"><link rel="prefetch" href="/assets/js/18.09a2ee08.js"><link rel="prefetch" href="/assets/js/19.5e018236.js"><link rel="prefetch" href="/assets/js/20.2f6aad81.js"><link rel="prefetch" href="/assets/js/21.56a0a87d.js"><link rel="prefetch" href="/assets/js/22.37a8fef4.js"><link rel="prefetch" href="/assets/js/23.75c65558.js"><link rel="prefetch" href="/assets/js/24.19255d9b.js"><link rel="prefetch" href="/assets/js/25.b96e970c.js"><link rel="prefetch" href="/assets/js/26.8043101d.js"><link rel="prefetch" href="/assets/js/27.c05d3044.js"><link rel="prefetch" href="/assets/js/28.c0aa90a2.js"><link rel="prefetch" href="/assets/js/29.06c0191d.js"><link rel="prefetch" href="/assets/js/30.975fb305.js"><link rel="prefetch" href="/assets/js/31.0cba5310.js"><link rel="prefetch" href="/assets/js/32.d8bc188f.js"><link rel="prefetch" href="/assets/js/33.384f6578.js"><link rel="prefetch" href="/assets/js/34.6baca6a7.js"><link rel="prefetch" href="/assets/js/35.96ec3f3e.js"><link rel="prefetch" href="/assets/js/36.bd945c36.js"><link rel="prefetch" href="/assets/js/37.be27655b.js"><link rel="prefetch" href="/assets/js/38.e8e93b37.js"><link rel="prefetch" href="/assets/js/39.ef88fac1.js"><link rel="prefetch" href="/assets/js/4.aa28cc69.js"><link rel="prefetch" href="/assets/js/40.b6dad60d.js"><link rel="prefetch" href="/assets/js/41.c762ef5a.js"><link rel="prefetch" href="/assets/js/42.151d8a58.js"><link rel="prefetch" href="/assets/js/43.632c642f.js"><link rel="prefetch" href="/assets/js/44.2e34b5d9.js"><link rel="prefetch" href="/assets/js/45.94f8db29.js"><link rel="prefetch" href="/assets/js/46.57527f8f.js"><link rel="prefetch" href="/assets/js/47.44a84132.js"><link rel="prefetch" href="/assets/js/48.66958018.js"><link rel="prefetch" href="/assets/js/49.21739b30.js"><link rel="prefetch" href="/assets/js/5.e06ff02e.js"><link rel="prefetch" href="/assets/js/50.000c5d7c.js"><link rel="prefetch" href="/assets/js/51.b59a6470.js"><link rel="prefetch" href="/assets/js/52.3a475ad4.js"><link rel="prefetch" href="/assets/js/53.9801890b.js"><link rel="prefetch" href="/assets/js/54.269a45cd.js"><link rel="prefetch" href="/assets/js/55.91e89997.js"><link rel="prefetch" href="/assets/js/56.493b7ae8.js"><link rel="prefetch" href="/assets/js/57.ec46c27c.js"><link rel="prefetch" href="/assets/js/58.56202f8d.js"><link rel="prefetch" href="/assets/js/59.4dac8d8a.js"><link rel="prefetch" href="/assets/js/6.45a79ebc.js"><link rel="prefetch" href="/assets/js/60.77f7cd1f.js"><link rel="prefetch" href="/assets/js/61.a48bae63.js"><link rel="prefetch" href="/assets/js/62.626e88b6.js"><link rel="prefetch" href="/assets/js/63.9d36ed5d.js"><link rel="prefetch" href="/assets/js/64.a6a4e5c6.js"><link rel="prefetch" href="/assets/js/65.e32c3a18.js"><link rel="prefetch" href="/assets/js/66.0de20cc0.js"><link rel="prefetch" href="/assets/js/67.b24d4adf.js"><link rel="prefetch" href="/assets/js/68.7269173e.js"><link rel="prefetch" href="/assets/js/69.9999d01e.js"><link rel="prefetch" href="/assets/js/7.1a1f32a2.js"><link rel="prefetch" href="/assets/js/70.a45e1785.js"><link rel="prefetch" href="/assets/js/71.d443735d.js"><link rel="prefetch" href="/assets/js/72.56bd9ca0.js"><link rel="prefetch" href="/assets/js/73.4a484020.js"><link rel="prefetch" href="/assets/js/74.d0f77ba8.js"><link rel="prefetch" href="/assets/js/75.8595de75.js"><link rel="prefetch" href="/assets/js/76.b89309e6.js"><link rel="prefetch" href="/assets/js/77.1a28c952.js"><link rel="prefetch" href="/assets/js/78.156340fe.js"><link rel="prefetch" href="/assets/js/79.bc68f887.js"><link rel="prefetch" href="/assets/js/8.ffcc6d32.js"><link rel="prefetch" href="/assets/js/80.00742412.js"><link rel="prefetch" href="/assets/js/81.d07bf30f.js"><link rel="prefetch" href="/assets/js/82.dd648b4e.js"><link rel="prefetch" href="/assets/js/83.50310bd1.js"><link rel="prefetch" href="/assets/js/84.8b446b87.js"><link rel="prefetch" href="/assets/js/85.1bbf1222.js"><link rel="prefetch" href="/assets/js/86.b1112682.js"><link rel="prefetch" href="/assets/js/87.5353ad37.js"><link rel="prefetch" href="/assets/js/88.3bc7938a.js"><link rel="prefetch" href="/assets/js/89.c9d6877e.js"><link rel="prefetch" href="/assets/js/9.bfaf9c10.js"><link rel="prefetch" href="/assets/js/90.f7c20556.js"><link rel="prefetch" href="/assets/js/91.72437dd2.js"><link rel="prefetch" href="/assets/js/92.2a17869e.js"><link rel="prefetch" href="/assets/js/93.cc33ea11.js"><link rel="prefetch" href="/assets/js/94.49e5d122.js"><link rel="prefetch" href="/assets/js/95.9c954379.js"><link rel="prefetch" href="/assets/js/96.638e1dee.js"><link rel="prefetch" href="/assets/js/97.c2372908.js"><link rel="prefetch" href="/assets/js/98.762254ac.js"><link rel="prefetch" href="/assets/js/99.29af3121.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5718d53e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-266a5a28><header class="navbar" data-v-266a5a28><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="web全栈体系" class="logo"> <span class="site-name can-hide">web全栈体系</span></a> <div class="carousel" data-v-1a4d21d9></div> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a href="https://github.com/hejialianghe" class="repo-star"><img src="https://img.shields.io/github/stars/hejialianghe/Senior-FrontEnd.svg?style=flat-square" alt></a> <div class="nav-item"><a href="/algorithm/complexity.html" class="nav-link">算法小册</a></div><div class="nav-item"><a href="/guide/" class="nav-link">web体系</a></div><div class="nav-item"><a href="/fp/react/build-react.html" class="nav-link">框架原理</a></div><div class="nav-item"><a href="https://github.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/engineering/ctg-art.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en-US/engineering/ctg-art.html" class="nav-link">English</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-266a5a28></div> <aside class="sidebar" data-v-266a5a28><nav class="nav-links"><a href="https://github.com/hejialianghe" class="repo-star"><img src="https://img.shields.io/github/stars/hejialianghe/Senior-FrontEnd.svg?style=flat-square" alt></a> <div class="nav-item"><a href="/algorithm/complexity.html" class="nav-link">算法小册</a></div><div class="nav-item"><a href="/guide/" class="nav-link">web体系</a></div><div class="nav-item"><a href="/fp/react/build-react.html" class="nav-link">框架原理</a></div><div class="nav-item"><a href="https://github.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/engineering/ctg-art.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en-US/engineering/ctg-art.html" class="nav-link">English</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jsadvanced/" class="sidebar-link">前言</a></li><li><a href="/jsadvanced/function.html" class="sidebar-link">函数</a></li><li><a href="/jsadvanced/asyncpro.html" class="sidebar-link">异步编程</a></li><li><a href="/jsadvanced/designpattern.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>计算机网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/computerNetwork/protocal.html" class="sidebar-link">网络协议</a></li><li><a href="/computerNetwork/network-actual.html" class="sidebar-link">网络请求实战</a></li><li><a href="/computerNetwork/security.html" class="sidebar-link">网络安全与攻防</a></li><li><a href="/computerNetwork/browser-status.html" class="sidebar-link">浏览器状态同步和路由</a></li><li><a href="/computerNetwork/tools.html" class="sidebar-link">工具链和其他</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/" class="sidebar-link">前言</a></li><li><a href="/vue/vueBase.html" class="sidebar-link">vue基础</a></li><li><a href="/vue/vueComponents.html" class="sidebar-link">探索vue的组件世界</a></li><li><a href="/vue/sourceCode.html" class="sidebar-link">部分源码解析</a></li><li><a href="/vue/serverSideRender.html" class="sidebar-link">服务端渲染</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>react</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/" class="sidebar-link">入门介绍</a></li><li><a href="/react/react-base.html" class="sidebar-link">步入react</a></li><li><a href="/react/react-positive.html" class="sidebar-link">react正篇</a></li><li><a href="/react/react-ecology.html" class="sidebar-link">react生态</a></li><li><a href="/react/react-principle.html" class="sidebar-link">react原理</a></li><li><a href="/react/react-state-mana.html" class="sidebar-link">react状态管理</a></li><li><a href="/react/react-actualCombat.html" class="sidebar-link">react高级实战</a></li><li><a href="/react/react-hooks.html" class="sidebar-link">react-hooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/" class="sidebar-link">Node.js基础</a></li><li><a href="/node/koa.html" class="sidebar-link">koa</a></li><li><a href="/node/egg.html" class="sidebar-link">企业级框架egg</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/script.html" class="sidebar-link">脚本世界</a></li><li><a href="/engineering/coding-standards.html" class="sidebar-link">规范先行</a></li><li><a href="/engineering/quality-code.html" class="sidebar-link">质量代码</a></li><li><a href="/engineering/design.html" class="sidebar-link">工程设计</a></li><li><a href="/engineering/ctg-art.html" aria-current="page" class="active sidebar-link">构建艺术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-1-构建简史" class="sidebar-link">5.1 构建简史</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-1-1-前端进化史" class="sidebar-link">5.1.1 前端进化史</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-1-2-现代化的前端构建" class="sidebar-link">5.1.2 现代化的前端构建</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-2-不得不提的babel-token-ast" class="sidebar-link">5.2 不得不提的babel：token-ast</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-2-1-回顾ast" class="sidebar-link">5.2.1 回顾AST</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-2-2-编译理论" class="sidebar-link">5.2.2 编译理论</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-2-3-如何实现简单编译器" class="sidebar-link">5.2.3 如何实现简单编译器</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-2-4-扩展资料" class="sidebar-link">5.2.4 扩展资料</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-3-不得不提的babel-基本概念" class="sidebar-link">5.3 不得不提的babel:基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-3-1-babel的作用" class="sidebar-link">5.3.1 Babel的作用</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-3-2-syntax-feature" class="sidebar-link">5.3.2 Syntax &amp; Feature</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-3-3-plugin-preset-env" class="sidebar-link">5.3.3 plugin / preset / env</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-3-4-扩展资料" class="sidebar-link">5.3.4 扩展资料</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-4-不得不提的babel-使用" class="sidebar-link">5.4 不得不提的babel：使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-4-1-babel的使用方式" class="sidebar-link">5.4.1 Babel的使用方式</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-4-2-babel-的配置" class="sidebar-link">5.4.2 Babel 的配置</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-4-3-polyfill" class="sidebar-link">5.4.3 polyfill</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-5-不得不提的babel-插件开发" class="sidebar-link">5.5 不得不提的babel：插件开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-5-1-babel的插件的本质" class="sidebar-link">5.5.1 Babel的插件的本质</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-5-2-babel的插件开发工具" class="sidebar-link">5.5.2 Babel的插件开发工具</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-5-3-babel的插件实战" class="sidebar-link">5.5.3 Babel的插件实战</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-6-深入webpack-设计思想" class="sidebar-link">5.6 深入webpack：设计思想</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-6-1-tapable" class="sidebar-link">5.6.1 Tapable</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-6-2-webpack工作流程" class="sidebar-link">5.6.2 Webpack工作流程</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-6-3-webpack的主要概念" class="sidebar-link">5.6.3 Webpack的主要概念</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-7-深入webpack-高级使用" class="sidebar-link">5.7 深入webpack：高级使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-7-1-基本配置" class="sidebar-link">5.7.1 基本配置</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-7-2-高级使用" class="sidebar-link">5.7.2 高级使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-8-深入webpack-loader和plugin详解" class="sidebar-link">5.8 深入webpack：Loader和Plugin详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-8-1-loader的编写" class="sidebar-link">5.8.1 loader的编写</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-8-1-plugin的编写" class="sidebar-link">5.8.1 plugin的编写</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#扩展学习" class="sidebar-link">扩展学习</a></li></ul></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-9-webpack性能优化" class="sidebar-link">5.9 webpack性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-9-1-webpack数据分析" class="sidebar-link">5.9.1 webpack数据分析</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-9-2-编译时间优化" class="sidebar-link">5.9.2 编译时间优化</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-9-3-编译体积优化" class="sidebar-link">5.9.3 编译体积优化</a></li><li class="sidebar-sub-header"><a href="/engineering/ctg-art.html#_5-9-4-运行速度优化" class="sidebar-link">5.9.4 运行速度优化</a></li></ul></li></ul></li><li><a href="/engineering/auto-deploy.html" class="sidebar-link">持续集成与部署</a></li><li><a href="/engineering/git.html" class="sidebar-link">Git操作</a></li><li><a href="/engineering/tool.html" class="sidebar-link">效率工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/applets/performance.html" class="sidebar-link">小程序进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/projectPractice/isomorphism.html" class="sidebar-link">认识同构及原理</a></li><li><a href="/projectPractice/demo.html" class="sidebar-link">实现一个同构的demo</a></li><li><a href="/projectPractice/nextjs.html" class="sidebar-link">Nextjs</a></li></ul></section></li></ul> </aside> <main class="page" data-v-266a5a28> <div class="ads" data-v-a4c8d602><div class="item" data-v-a4c8d602><h6 class="title" style="display:;" data-v-a4c8d602>联系作者</h6> <div class="thumb" data-v-a4c8d602><a href="/weixin.jpeg" target="_blank" data-v-a4c8d602><img src="/weixin.jpeg" alt="联系作者" data-v-a4c8d602></a></div></div></div> <div class="theme-default-content content__default"><h2 id="_5-1-构建简史"><a href="#_5-1-构建简史" class="header-anchor">#</a> 5.1 构建简史</h2> <h3 id="_5-1-1-前端进化史"><a href="#_5-1-1-前端进化史" class="header-anchor">#</a> 5.1.1 前端进化史</h3> <h4 id="洪荒时代"><a href="#洪荒时代" class="header-anchor">#</a> 洪荒时代</h4> <ul><li>Vanilla javascript/HTML/CSS</li></ul> <p>1993年-HTML（超文本标记语言）-&gt; 1994-css（层叠样式表）-&gt; javaScript</p> <ul><li>最火热的话题</li></ul> <p>DOM、BOM、样式放在哪、浏览器的兼容性.....</p> <ul><li>jQuery</li></ul> <ol><li>简化DOM操作</li> <li>制作底层API（如xhr）</li> <li>制作炫酷动画</li> <li>解决浏览器兼容性问题</li></ol> <ul><li>Bootstrap</li></ul> <ol><li>用class决定元素的功能和样式</li> <li>“组件”开始出现</li> <li>工程化的问题开始显现</li></ol> <h4 id="曙光初现"><a href="#曙光初现" class="header-anchor">#</a> 曙光初现</h4> <ul><li>Nodejs出现</li></ul> <ol><li>NodeJS v0.0.1-2009年</li> <li>利用v8和libuv，让JS代码运行于浏览器之外</li> <li>Node出现之前，构建脚本往往需要使用Makefile、Shell编写</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">var</span> sass<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-sass'</span><span class="token punctuation">)</span>
 sass<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
     <span class="token punctuation">{</span>file<span class="token operator">:</span>scss_filename<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">,</span>option<span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span>
 <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="百家争鸣"><a href="#百家争鸣" class="header-anchor">#</a> 百家争鸣</h4> <ul><li>Grunt/Gulp</li></ul> <ol><li>构建工具流开始初步形成</li> <li>编写简单、生态丰富</li></ol> <h4 id="语言的进化"><a href="#语言的进化" class="header-anchor">#</a> 语言的进化</h4> <ol><li><p>ECMAScript 6的出现</p></li> <li><p>即ES2015，诞生于2015年6月</p></li> <li><p>现代的语法极大的提高了开发效率</p></li></ol> <ul><li>箭头函数</li> <li>Clas语法</li> <li>Promise/Gennerator</li> <li>ES Module
......</li></ul> <h4 id="mv-框架"><a href="#mv-框架" class="header-anchor">#</a> MV*框架</h4> <ul><li>现代mv*框架的出现</li></ul> <ol><li>Angular、React、Vue</li> <li>单文件组件、JSX</li> <li>大量利用了ES6新特性</li></ol> <h4 id="mv-框架-2"><a href="#mv-框架-2" class="header-anchor">#</a> MV*框架</h4> <ul><li>AMD/CMD</li></ul> <ol><li><p>纯前端模块化方案</p></li> <li><p>AMD:require.js</p></li> <li><p>CMD:sea.js</p></li></ol> <ul><li>CommonJS</li></ul> <ol><li>NodeJS模块化方案</li> <li>同步引用依赖、符合人类视觉</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> a<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>ES Module</li></ul> <ol><li><p>ES6规带来的语言级模块化方案</p></li> <li><p>支持Node/Browser等运行时</p></li> <li><p>利于静态分析</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'a'</span> <span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-1-2-现代化的前端构建"><a href="#_5-1-2-现代化的前端构建" class="header-anchor">#</a> 5.1.2 现代化的前端构建</h3> <ul><li>我们需要怎样的前端构建</li></ul> <ol><li><p>性能：图片优化、合并资源、减少Polyfill体积</p></li> <li><p>模块化：Commonjs/ES Module-&gt; script</p></li> <li><p>强力的语法转换：ES6、7、8...</p></li> <li><p>统一打包过程、整体分析优化：Vue单文件组件</p></li></ol> <ul><li>Babel、webpack</li></ul> <h2 id="_5-2-不得不提的babel-token-ast"><a href="#_5-2-不得不提的babel-token-ast" class="header-anchor">#</a> 5.2 不得不提的babel：token-ast</h2> <h3 id="_5-2-1-回顾ast"><a href="#_5-2-1-回顾ast" class="header-anchor">#</a> 5.2.1 回顾AST</h3> <h4 id="《代码规范》中的介绍"><a href="#《代码规范》中的介绍" class="header-anchor">#</a> 《代码规范》中的介绍</h4> <p>AST是一种可遍历的、描述代码的树状结构，利用AST可以方便的分析代码的结构和内容。</p> <p><a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">AST Explore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_5-2-2-编译理论"><a href="#_5-2-2-编译理论" class="header-anchor">#</a> 5.2.2 编译理论</h3> <p><img src="/assets/img/cpn-process.24c11465.png" alt=""></p> <h4 id="babel中的编译"><a href="#babel中的编译" class="header-anchor">#</a> Babel中的编译</h4> <ul><li><p>Babel也是编译器</p> <p>输入的是高版本的ES代码，输出的是符合我们要求的低版本的ES代码，例如：ES7-&gt;ES5</p></li> <li><p>Babel的工作步骤</p></li></ul> <p>根据Babel文档，其工作步骤其实主要分为三步</p> <ol><li><p>解析（Parsing）：解析代码，生成AST（抽象语法树）</p></li> <li><p>变换（Transformation）：操作AST（抽象语法树），修改其内容</p></li> <li><p>生成（Code Generation）：根据AST（抽象语法树）生成新的代码</p></li></ol> <h3 id="_5-2-3-如何实现简单编译器"><a href="#_5-2-3-如何实现简单编译器" class="header-anchor">#</a> 5.2.3 如何实现简单编译器</h3> <h4 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h4> <ul><li>LISP-&gt;C</li></ul> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">LISP</th> <th style="text-align:center;">C</th></tr></thead> <tbody><tr><td style="text-align:center;">2+2</td> <td style="text-align:center;">(add 2 2 )</td> <td style="text-align:center;">add(2,2)</td></tr> <tr><td style="text-align:center;">4-2</td> <td style="text-align:center;">(subtract 2 2 )</td> <td style="text-align:center;">subtract(4,2)</td></tr></tbody></table> <h4 id="parsing"><a href="#parsing" class="header-anchor">#</a> parsing</h4> <ul><li>Tokenizing</li></ul> <p><img src="/assets/img/tokenizing.24c5f246.png" alt=""></p> <ul><li>Tokenizer函数</li></ul> <p><img src="/assets/img/tokenizer.b04318d4.png" alt=""></p> <p><img src="/assets/img/tokenizer2.b5480dde.png" alt=""></p> <p>将代码转换成token</p> <ul><li>Parser函数</li></ul> <p><img src="/assets/img/Parser.681f1feb.png" alt=""></p> <p>将token转换为AST</p> <h4 id="transformation"><a href="#transformation" class="header-anchor">#</a> transformation</h4> <ul><li>Traverser函数</li></ul> <p>深度优先地遍历AST树</p> <ul><li>TransFormer函数</li></ul> <p>在遍历每一个节点时调用将旧AST转成一颗新树，就是转换为目标语言的树</p> <h4 id="code-generator"><a href="#code-generator" class="header-anchor">#</a> Code Generator</h4> <ul><li>Code Generator</li></ul> <p>深度优先地遍历新的AST树，将每个节点依次组合新代码</p> <ul><li>最终的Compiler</li></ul> <ol><li>input -&gt; tokenizer -&gt; tokens</li> <li>Tokens -&gt; parser -&gt; ast</li> <li>ast -&gt; transformer -&gt; newAst</li> <li>newAst -&gt; generator -&gt; output</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">function</span> <span class="token function">compiler</span> <span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> tokens<span class="token operator">=</span> <span class="token function">tokenizer</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
        <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parser</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>
        <span class="token keyword">let</span> newAst<span class="token operator">=</span><span class="token function">transformer</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
        <span class="token keyword">let</span> output<span class="token operator">=</span> <span class="token function">codeGennerator</span><span class="token punctuation">(</span>newAst<span class="token punctuation">)</span>
        <span class="token keyword">return</span> output
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-2-4-扩展资料"><a href="#_5-2-4-扩展资料" class="header-anchor">#</a> 5.2.4 扩展资料</h3> <p><a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener noreferrer">the-super-tiny-compiler项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://www.icourse163.org/course/HIT-1002123007" target="_blank" rel="noopener noreferrer">国大学慕课：编译原理 哈尔滨工业大学：<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_5-3-不得不提的babel-基本概念"><a href="#_5-3-不得不提的babel-基本概念" class="header-anchor">#</a> 5.3 不得不提的babel:基本概念</h2> <h3 id="_5-3-1-babel的作用"><a href="#_5-3-1-babel的作用" class="header-anchor">#</a> 5.3.1 Babel的作用</h3> <h4 id="babel是啥"><a href="#babel是啥" class="header-anchor">#</a> Babel是啥？</h4> <ul><li><p>Babel 是啥？</p></li> <li><p>Babel is javaScript compiler</p></li> <li><p>主要将ECMAScript 2015+的代码，转换成让我们能够在更古老的浏览其和其他环境运行的、兼容性更好的、老版本javascript代码</p></li> <li><p>Babel 能干嘛？</p></li></ul> <p>作用1: 语法转换</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>n<span class="token operator">+</span><span class="token number">1</span></span><span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                   <span class="token keyword">return</span> n<span class="token operator">+</span><span class="token number">1</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>作用2: Polyfill</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>让 老环境支持新的api</p> <p>作用2: 源码修改</p> <p>去除Flow/TypeScript代码中的类型标识</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">function</span> square （n<span class="token operator">:</span>number<span class="token punctuation">)</span><span class="token operator">:</span>number <span class="token punctuation">{</span>
      <span class="token keyword">return</span> n<span class="token operator">+</span>n
  <span class="token punctuation">}</span>
  <span class="token comment">// ------transformation------</span>
  <span class="token keyword">function</span> square （n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> n<span class="token operator">+</span>n
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-3-2-syntax-feature"><a href="#_5-3-2-syntax-feature" class="header-anchor">#</a> 5.3.2 Syntax &amp; Feature</h3> <h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li>Syntax</li></ul> <p>语言级的某一种概念的写法，不可被语言中的其他概念实现</p> <p>举个例子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 箭头函数</span>
<span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>a<span class="token operator">+</span>b<span class="token operator">+</span>c
<span class="token comment">// 2. Class类</span>
 <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 3. ES模块</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ext from ‘fs<span class="token operator">-</span>ext’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="feature"><a href="#feature" class="header-anchor">#</a> feature</h4> <ul><li>Feature 就是指API</li></ul> <p>实例方法、静态方法、全局对象等</p> <p>举个例子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. promise</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//2. Object.keys</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3. [].inculdes</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_5-3-3-plugin-preset-env"><a href="#_5-3-3-plugin-preset-env" class="header-anchor">#</a> 5.3.3 plugin / preset / env</h3> <h4 id="plugin"><a href="#plugin" class="header-anchor">#</a> plugin</h4> <ul><li>插件</li></ul> <p>babel本身不会对代码做任何操作，所有功能都靠插件实现</p> <ul><li>有哪些插件？</li></ul> <ol><li><p>@bable/plugin-transform-arrow-functions</p></li> <li><p>@babel/plugin-transform-destructuring</p></li> <li><p>@bable/plugin-transform-classes</p></li> <li><p>......</p></li></ol> <h4 id="preset"><a href="#preset" class="header-anchor">#</a> preset</h4> <ul><li>preset是什么？</li></ul> <p>A set of plugins，一组插件的集合</p> <ul><li>官方preset</li></ul> <ol><li><p>@babel/preset-env</p></li> <li><p>@babel/preset-flow</p></li> <li><p>@babel/preset-react</p></li> <li><p>@babel/preset-typescript</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">&quot;pluginA&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;pluginB&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;pluginC&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="env"><a href="#env" class="header-anchor">#</a> env</h4> <ul><li>env的出现</li></ul> <p>@bable/preset-env是一种更加智能的preset，让我们指需要根据我们的目标环境，快速配置babel</p> <ul><li>env的配置例子</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;target&quot;</span><span class="token operator">:</span><span class="token string">&quot;&gt;0,25%,not dead&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    <span class="token string">&quot;target&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;chrome&quot;</span><span class="token operator">:</span><span class="token string">&quot;58&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ie&quot;</span><span class="token operator">:</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-3-4-扩展资料"><a href="#_5-3-4-扩展资料" class="header-anchor">#</a> 5.3.4 扩展资料</h3> <p><a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener noreferrer">browserlist项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/kangax/compat-table" target="_blank" rel="noopener noreferrer">compat-table项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_5-4-不得不提的babel-使用"><a href="#_5-4-不得不提的babel-使用" class="header-anchor">#</a> 5.4 不得不提的babel：使用</h2> <h3 id="_5-4-1-babel的使用方式"><a href="#_5-4-1-babel的使用方式" class="header-anchor">#</a> 5.4.1 Babel的使用方式</h3> <ul><li>直接require</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> bable<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span>
babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>options<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    result <span class="token comment">// =&gt;{code,map,ast}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>babel-cli</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>babel src <span class="token operator">--</span>out<span class="token operator">-</span>dir lib <span class="token operator">--</span>ignore <span class="token string">&quot;src/**/*.spec.js&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;src/**/* .test.js&quot;</span>

babel <span class="token operator">-</span>node <span class="token operator">--</span>inspect <span class="token operator">--</span>presets @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">--</span> script<span class="token punctuation">.</span>js <span class="token operator">--</span>inspect
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>Webpack / Rollup</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span>
            test<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules | bower_components)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span><span class="token punctuation">{</span>
                loader<span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    presets<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'@bable/preset-env'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_5-4-2-babel-的配置"><a href="#_5-4-2-babel-的配置" class="header-anchor">#</a> 5.4.2 Babel 的配置</h3> <h4 id="配置的位置"><a href="#配置的位置" class="header-anchor">#</a> 配置的位置</h4> <ul><li>项目根目录的.babelrc.json</li></ul> <p>对整个项目生效</p> <ul><li>工程根目录的babel.config.json</li></ul> <p>对整个工程生效（可跨项目）</p> <ul><li>package.json的babel字段</li></ul> <p>相当于.babel.json</p> <h4 id="plugin-2"><a href="#plugin-2" class="header-anchor">#</a> plugin</h4> <ul><li>plugin的使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">// &quot;@babel/preset-env&quot; ,下面配置的是简写，如果工程配置中找不到包，可能是被简写了</span>
    presets<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// same as &quot;@babel/plugins-transform-arrow-functions&quot;</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/transform-arrow-function&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>plugin的几种配置</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 以下三种配置方式等价</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  “plugins”<span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token string">&quot;pluginA&quot;</span><span class="token operator">:</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;pluginA&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;pluginA&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 如果plugin配置成数组，第一项是插件名称，第二项是配置</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>利用以下方式，我们可以将配置传入插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  “plugins”<span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">[</span>
          <span class="token string">&quot;transform-async-to-module-method&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
              <span class="token string">&quot;module&quot;</span><span class="token operator">:</span><span class="token string">&quot;bluebird&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;coroutine&quot;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>plugin的顺序</li></ul> <ol><li>Plugins在preset之前执行</li> <li>Plugin之间从前往后依次执行</li></ol> <p>babel为什么这么设计呢？</p> <p>因为preset配置的是比较成熟的语法，plugin主要配置一些更新特性，plugin在preset之前执行是保证这些新特性是最先被转换的，保证preset只关心比较稳定的语法</p> <h4 id="preset-2"><a href="#preset-2" class="header-anchor">#</a> preset</h4> <ul><li>preset的使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;preset&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">&quot;@bable/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token string">&quot;loose&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">&quot;modules&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>为什么preset也需要配置呢？</p> <p>因为preset本质就是一组plugin的集合,plugins可以配置，当然preset也可以配置，甚至preset可以依赖另一个preset</p> <ul><li>preset的本质</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        presets<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">&quot;@babel/preset-env&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>loose<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">&quot;@babel/plugin-proposal-object-rest-spread&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>preset的顺序</li></ul> <ol><li>preset在plugin之后执行</li> <li>preset之间从后往前依次执行</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 执行顺序 c-&gt;b-&gt;a，这个设计babel文档中说是历史原因造成的</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;preset&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="preset-env"><a href="#preset-env" class="header-anchor">#</a> preset-env</h4> <ul><li>preset-env的配置</li></ul> <p>preset-env是最常用的preset，大部分情况下你只需用这一个preset就可以了</p> <ol><li>主要就是useBuiltins和target两个配置</li> <li>useBuiltins用来配置polyfill</li> <li>target用来告诉preset-env选择哪个插件</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;useBuiltIns&quot;</span><span class="token operator">:</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;target&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token string">&quot;esmodules&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;chrome&quot;</span><span class="token operator">:</span><span class="token string">&quot;58&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ie&quot;</span><span class="token operator">:</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;node&quot;</span><span class="token operator">:</span><span class="token string">&quot;current&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>targets的配置</li></ul> <p>这个配置项是我们支持的平台是什么</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;targets&quot;</span> <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;chrome&quot;</span><span class="token operator">:</span><span class="token string">&quot;58&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ie&quot;</span><span class="token operator">:</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// or</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;targets&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&gt; .5%  and not last 2 versions&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li>可以是描述浏览器版本的对象，也可以是字符串（browserlist）</li> <li>browserlist完整语法</li> <li>也可以将browserlist写在.browserslistrc中</li></ol> <ul><li>usebuiltins的配置</li></ul> <p>三种取值：“usage”、“entry”、“false”，默认是false</p> <p>用于自动注入polyfill代码</p> <ol><li><p>false：什么也不做/不自动注入polyfill</p></li> <li><p>entry:根据环境配置自动注入polyfill</p></li> <li><p>usage:根据实际使用自动注入polyfill</p></li></ol> <h3 id="_5-4-3-polyfill"><a href="#_5-4-3-polyfill" class="header-anchor">#</a> 5.4.3 polyfill</h3> <h4 id="babel的polyfiill"><a href="#babel的polyfiill" class="header-anchor">#</a> Babel的Polyfiill</h4> <ul><li>Babel 7.4之前</li></ul> <p>统一使用@babel/polyfill</p> <ul><li>babel 7.4之后</li></ul> <p>新的形式更有利于babel做进一步的转换</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;core-js/stable&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;regenerator-runtime/runtime&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>core-js用于polyfill大部分的ES新feature</p> <p>regenerator-runtime/runtime用于转换generator函数</p> <p>由于polyfill会用于运行时，所以要以<code>dependencies</code>方式安装</p> <h4 id="polyfill的使用"><a href="#polyfill的使用" class="header-anchor">#</a> Polyfill的使用</h4> <ul><li>直接引入？</li></ul> <p>官方不建议直接引入，因为太大了，建议将preset-env的useBuiltins和corejs搭配使用。</p> <ul><li>useBuiltIns:“entry”</li></ul> <p>在target配置为chrome71的条件下使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'core-js/stable'</span>

<span class="token comment">// ------------------------</span>

<span class="token keyword">import</span> <span class="token string">&quot;core-js/modules/es.array.unscopables.flat&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;core-js/modules/es.array.unscopables.flat-map&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;core-js/modules/es.object.form-entries&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;core-js/modules/web.immediate&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>useBuiltins:false</li></ul> <p>Babel什么都不做，完全由你自己决定如何polyfill</p> <ul><li>useBuiltins: &quot;usage&quot;</li></ul> <p>根据使用情况自动加入poilfill</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">var</span> set <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 转换后</span>
<span class="token keyword">import</span> <span class="token string">'core-js/module/es.array.iterator'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/modules/es.object.to-string'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/modules/es.set'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> set <span class="token operator">=</span> net <span class="token function">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><font color="red"><strong>似乎完美了吗？</strong></font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//  ----------------------------</span>

<span class="token string">&quot;use strict&quot;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/modules/es6.object.define-property&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span>constructor</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//....}</span>
<span class="token keyword">function</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>props</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//....}</span>
<span class="token keyword">function</span> <span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token parameter">Constructor<span class="token punctuation">,</span>protoProps<span class="token punctuation">,</span>staticProps</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//....}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Polyfill函数被内联的写进文件里，如果工程中大量使用class语法，必然会出现大量的重复的polyfill</p> <p><font color="red"><strong>解决方法</strong></font></p> <p>yarn add -D @babel/plugins-transform-runtime</p> <p>yarn add @babel/runtime</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _classCallCheck2<span class="token operator">=</span><span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/runtime/helpers/classCallCheck'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
 <span class="token keyword">var</span> _classCallClass2<span class="token operator">=</span><span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/runtime/helpers/createClass'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>让所有polyfill函数从@babel/runtime引入</p> <p><font color="red"><strong>带来的好处</strong></font></p> <ol><li>减小包的体积</li> <li>不会影响到全局环境</li></ol> <p><font color="red"><strong>最终配置</strong></font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 presets<span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span>
     <span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span>
   <span class="token punctuation">[</span><span class="token string">'@babel/plugin-transform-runtime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_5-5-不得不提的babel-插件开发"><a href="#_5-5-不得不提的babel-插件开发" class="header-anchor">#</a> 5.5 不得不提的babel：插件开发</h2> <h3 id="_5-5-1-babel的插件的本质"><a href="#_5-5-1-babel的插件的本质" class="header-anchor">#</a> 5.5.1 Babel的插件的本质</h3> <h4 id="插件长什么样"><a href="#插件长什么样" class="header-anchor">#</a> 插件长什么样？</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        visitor<span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token function">Indentifier</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">const</span> name<span class="token operator">=</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
                path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name<span class="token operator">=</span>name
                 <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="从代码到ast"><a href="#从代码到ast" class="header-anchor">#</a> 从代码到AST</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">square</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n<span class="token operator">*</span>n
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Babel和ESlint一样，使用EStree规范生成AST结构，可以使用<a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">AST Explore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看</p> <h4 id="节点-node"><a href="#节点-node" class="header-anchor">#</a> 节点（Node）</h4> <ul><li>AST 每一层都拥有相同的结构，我们称之为节点（Node）</li> <li>一个AST可以由单一的节点或成百上千个节点构成</li> <li>它们组合在一起可以描述用于静态分析的程序语法</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    type<span class="token operator">:</span><span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">]</span>
    body<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    type<span class="token operator">:</span><span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span><span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    type<span class="token operator">:</span><span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
    operator<span class="token operator">:</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">,</span>
    left<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    right<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="遍历"><a href="#遍历" class="header-anchor">#</a> 遍历</h4> <p>babel编译经过3个步骤，解析-&gt;变换-&gt;生成；其中解析和生成我们都不用关注，我们只用关注变换，先要转换AST，我们
需要对其进行递归的树形遍历</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
      <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;square&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string">&quot;async&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BlockStatement&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
        <span class="token string">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ReturnStatement&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
            <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
            <span class="token string">&quot;argument&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BinaryExpression&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
              <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
              <span class="token string">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">,</span>
                <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;n&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">&quot;operator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
                <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
                <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;n&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><ol><li><p>从FunctionDeclaration 开始遍历</p></li> <li><p>id节点，它是一个identifier，没有任何子节点属性</p></li> <li><p>params数组，访问其中的任何一项，都是identifier</p></li> <li><p>body -&gt; BlockStatement -&gt; body</p></li> <li><p>ReturnStatement -&gt; argument -&gt; BinaryExpression</p></li> <li><p>......</p></li></ol> <h4 id="访问者模式"><a href="#访问者模式" class="header-anchor">#</a> 访问者模式</h4> <ul><li><p>遍历AST的过程，其实就是不断访问各个节点的过程</p></li> <li><p>Babel的插件，就是顺理成章地使用了访问者模式</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MyVisitor <span class="token operator">=</span><span class="token punctuation">{</span>
    Indentifier<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Entered&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;EXited&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>访问者的每个方法都能获取2个参数，<code>path</code>和<code>state</code></p> <ul><li>path</li></ul> <p>path是我们对节点的引用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token punctuation">{</span>
       type<span class="token operator">:</span><span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
       id<span class="token operator">:</span><span class="token punctuation">{</span>
           type<span class="token operator">:</span><span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
           name<span class="token operator">:</span><span class="token string">&quot;square&quot;</span>
       <span class="token punctuation">}</span>
       <span class="token operator">...</span><span class="token operator">...</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// path拿到父节点</span>
   <span class="token punctuation">{</span>
       <span class="token string">&quot;parent&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
           <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
           <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token string">&quot;node&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
           <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;square&quot;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol><li>path方法可以帮助我们访问父节点，帮助我们取得上下文信息。</li> <li>path方法上面有很多工具方法，帮助我们方便的操作AST。</li></ol> <ul><li>State</li></ul> <p>插件的“状态，比如：
当前plugin的信息、plugin传入的配置参数，甚至处理过程中的自定义状态</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">&quot;my-plugin&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token string">&quot;options&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">&quot;options&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// babel中通过state拿到配置参数</span>
<span class="token punctuation">{</span>
    visitor<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">FunctionDeclartion</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>opts<span class="token punctuation">)</span>
            <span class="token comment">// {option1:true,option2:false}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>完整面貌</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// babel的一些工具方法</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>type<span class="token operator">:</span>t<span class="token punctuation">,</span>template<span class="token punctuation">}</span><span class="token operator">=</span>babel
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">&quot;a-demo-plugin&quot;</span><span class="token punctuation">,</span>
        visitor<span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token function">Indentifier</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">ASTNodeTypeHere</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>一个babel对象为入参，以包含插件名和visitor的对象为返回值的函数</p> <h3 id="_5-5-2-babel的插件开发工具"><a href="#_5-5-2-babel的插件开发工具" class="header-anchor">#</a> 5.5.2 Babel的插件开发工具</h3> <table><thead><tr><th style="text-align:center;">工具</th> <th style="text-align:center;">作用</th></tr></thead> <tbody><tr><td style="text-align:center;">@babel/parser</td> <td style="text-align:center;">将源代码解析称AST</td></tr> <tr><td style="text-align:center;">@babel/generator</td> <td style="text-align:center;">将AST生成js代码</td></tr> <tr><td style="text-align:center;">@babel/code-frame</td> <td style="text-align:center;">生成错误信息</td></tr> <tr><td style="text-align:center;">@babel/helpers</td> <td style="text-align:center;">提供一些内置的帮助函数</td></tr> <tr><td style="text-align:center;">@babel/template</td> <td style="text-align:center;">为parser提供模版引擎</td></tr> <tr><td style="text-align:center;">@babel/types</td> <td style="text-align:center;">主要用于处理节点类型相关的问题（判断、创建）</td></tr> <tr><td style="text-align:center;">@babel/traverse</td> <td style="text-align:center;">工具类，用来遍历AST树</td></tr></tbody></table> <h3 id="_5-5-3-babel的插件实战"><a href="#_5-5-3-babel的插件实战" class="header-anchor">#</a> 5.5.3 Babel的插件实战</h3> <h4 id="实现一个optional-chaining"><a href="#实现一个optional-chaining" class="header-anchor">#</a> 实现一个Optional Chaining</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>foo<span class="token operator">?.</span>bar 
<span class="token comment">// --------------- 把上面的转换成下面的</span>
foo<span class="token operator">==</span><span class="token keyword">null</span><span class="token operator">?</span><span class="token keyword">void</span> <span class="token number">0</span><span class="token operator">:</span> foo<span class="token punctuation">.</span>bar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>开发babel插件，首先对比2段代码的AST结构，利用<a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">astexplorer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>工具分别拿到json格式的AST，拿到2段转换后的json后，在利用<a href="https://www.diffchecker.com/diff" target="_blank" rel="noopener noreferrer">diffchecker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>网站对比一下前后变换。</p> <p><img src="/assets/img/diffast.72041b6d.png" alt=""></p> <p>行数变化可以忽略，可以直接从结构上看见从哪里开始变化,可以看出是从<code>OptionaMembeExpression</code>变化成了<code>ConditionalExpression</code>;所以我们可以把
<code>OptionaMembeExpression</code>结构替换成<code>ConditionalExpression</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// foo?.bar</span>
<span class="token comment">// foo==null?void 0: foo.bar</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/template'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token function">OptionlChainingPlugin</span><span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'optional-chaining-plugin'</span><span class="token punctuation">,</span>
        visitor<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通过刚刚的对比，我们知道就是替换OptionaMembeExpression这个表达式</span>
            <span class="token function">OptionaMembeExpression</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                 <span class="token comment">// path.replaceWith() 替换为新的节点</span>
                 <span class="token comment">// path.remove() // 删除当前节点</span>
                 <span class="token comment">// path.skip() //跳过子节点`</span>
                path<span class="token punctuation">.</span><span class="token function">repalceWith</span><span class="token punctuation">(</span>
                 <span class="token comment">// 用 @babel/types这个包构造ConditionalExpression节点，但是这个包已经挂载到了bable上了，所以可以直接载babel访问</span>
                 <span class="token comment">// conditionalExpression具体参数可以访问babel官网查看，t.conditionalExpression(test, consequent, alternate)</span>
                 <span class="token comment">// 可以从对比图中看出，第一个参数test类型是BinaryExpression，是一个二元判断，也需要我们用babel.types构造</span>
                  babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">conditionalExpression</span><span class="token punctuation">(</span>
                  <span class="token comment">// 从babel文档中查看BinaryExpression所需要的的参数t.binaryExpression(operator, left, right)</span>
                  <span class="token comment">// operator就是 ==   left(左值)就是foo  right(右值)就是null</span>
                      babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">BinaryExpression</span><span class="token punctuation">(</span>
                          <span class="token string">'=='</span><span class="token punctuation">,</span>
                         babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>object<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">nulLiteral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    template<span class="token punctuation">.</span><span class="token function">expression</span><span class="token punctuation">(</span><span class="token string">'void 0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将字符串转换称号ast</span>
                    babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">memberExpression</span><span class="token punctuation">(</span>
                        babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>object<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 对象名称</span>
                        babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>property<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 属性名称</span>
                    <span class="token punctuation">)</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="_5-6-深入webpack-设计思想"><a href="#_5-6-深入webpack-设计思想" class="header-anchor">#</a> 5.6 深入webpack：设计思想</h2> <h3 id="_5-6-1-tapable"><a href="#_5-6-1-tapable" class="header-anchor">#</a> 5.6.1 Tapable</h3> <h4 id="tapable是啥"><a href="#tapable是啥" class="header-anchor">#</a> Tapable是啥？</h4> <p>Tapable是一个插件框架，也是Webpack的底层依赖，webpack几乎所有的功能都有插件提供，webpack本身创建了许多hook，各个插件注册在</p> <p>自己感兴趣的hook上，有webpack在相应的时机去调用它们，tapable正是提供了这样的hook体系。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
    SyncHook<span class="token punctuation">,</span> <span class="token comment">// 同步钩子</span>
    SyncBailHook<span class="token punctuation">,</span> <span class="token comment">// 同步熔断钩子</span>
    SyncWaterfallHook<span class="token punctuation">,</span> <span class="token comment">// 同步流水钩子</span>
    SyncLoopHook<span class="token punctuation">,</span>      <span class="token comment">// 同步循环钩子</span>
    AsyncParalleHook<span class="token punctuation">,</span> <span class="token comment">// 异步并发钩子</span>
    AsyncParallelBaillHook<span class="token punctuation">,</span>  <span class="token comment">// 异步并发熔断钩子</span>
    AsyncSeriesHook<span class="token punctuation">,</span>  <span class="token comment">// 异步串行钩子</span>
    AsyncSeriesBailHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行熔断钩子</span>
    AsyncSeriesWaterfallHook <span class="token comment">// 异步串行流水钩子</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="tapable的使用"><a href="#tapable的使用" class="header-anchor">#</a> Tapable的使用</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> syncHoook<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 注册事件</span>
syncHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
syncHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
syncHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">syncHook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Harry Potter&quot;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// output:</span>
<span class="token comment">// 1 Harry Potter 18</span>
<span class="token comment">// 2 Harry Potter 18</span>
<span class="token comment">// 3 Harry Potter 18</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_5-6-2-webpack工作流程"><a href="#_5-6-2-webpack工作流程" class="header-anchor">#</a> 5.6.2 Webpack工作流程</h3> <ol><li>初始化配置</li></ol> <p>初始化既包括配置的初始化，也包括<code>tapable</code>插件体系的初始化，主要就是实例<code>Compiler</code>这个对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 实例一系列tapable hook</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token operator">=</span><span class="token punctuation">{</span>
            shouldEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            done<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'stats'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            beforeRun<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            run<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'compiler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            emit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            afterEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>准备工作（初始化Plugins等）</li></ol> <p>初始化<code>plugin</code>的过程就是依次调用<code>plugin</code>apply的过程</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">class</span> <span class="token class-name">SourceMapDevToolPlugin</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在我们实例化的`Compiler`对象上注册每个钩子的回调函数</span>
        <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            compiler
              <span class="token punctuation">.</span>hooks
              <span class="token punctuation">.</span>compilation
              <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;SourceMapDevToolPlugin&quot;</span><span class="token punctuation">,</span><span class="token parameter">compilation</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                  compilation
                   <span class="token punctuation">.</span>hooks
                   <span class="token punctuation">.</span>afterOptimizeChunkAssets
                   <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>xxx<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>context<span class="token punctuation">,</span>chunks<span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li><p>resolve源文件，构建module</p></li> <li><p>生成thunk</p></li> <li><p>构建资源</p></li> <li><p>最终文件生成</p></li></ol> <p>事实上从第三步开始，都有plugin注册hook回调函数的方式在参与</p> <h3 id="_5-6-3-webpack的主要概念"><a href="#_5-6-3-webpack的主要概念" class="header-anchor">#</a> 5.6.3 Webpack的主要概念</h3> <ul><li>Entry
<ul><li>Entry是webpack开始分析依赖的入口</li> <li>Webpack从Entry开始，遍历整个项目的依赖</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token string">'./path/to/my/entry/files.js'</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token punctuation">{</span>
        app<span class="token operator">:</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
        adminApp<span class="token operator">:</span><span class="token string">'./src/adminApp.js'</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>enrty 可以有一个，也可以有多个</p> <ul><li>Output</li></ul> <p>Output用来指示Webpack将打包后的bundle文件放在什么位置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
        entry<span class="token operator">:</span><span class="token string">'./path/to/my/entry/files.js'</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span><span class="token punctuation">{</span>
            path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">,</span>
            fileName<span class="token operator">:</span><span class="token string">'my-fist-webpack-bundle.js'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>Loader</p></li> <li><p>Loader能够让Webpack处理非JS/JSON的文件</p></li> <li><p>处理：将一切格式转为JS模块，以便Webpack分析依赖关系和方便我们在浏览器中加载</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
       entry<span class="token operator">:</span><span class="token string">'./path/to/my/entry/files.js'</span><span class="token punctuation">,</span>
       output<span class="token operator">:</span><span class="token punctuation">{</span>
           path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">,</span>
           fileName<span class="token operator">:</span><span class="token string">'my-fist-webpack-bundle.js'</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       module<span class="token operator">:</span><span class="token punctuation">{</span>
           reules<span class="token operator">:</span><span class="token punctuation">[</span>
               <span class="token punctuation">{</span>
                   test<span class="token operator">:</span><span class="token string">'/\.txt$/'</span><span class="token punctuation">,</span>use<span class="token operator">:</span><span class="token string">'raw-loader'</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">]</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>Plugin</li></ul> <p>插件负责提供更高级的构建、打包功能</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">const</span> HtmlWebpackPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'Html-webpack-plugin'</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
        entry<span class="token operator">:</span><span class="token string">'./path/to/my/entry/files.js'</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span><span class="token punctuation">{</span>
            path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">,</span>
            fileName<span class="token operator">:</span><span class="token string">'my-fist-webpack-bundle.js'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        module<span class="token operator">:</span><span class="token punctuation">{</span>
            reules<span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    test<span class="token operator">:</span><span class="token string">'/\.txt$/'</span><span class="token punctuation">,</span>use<span class="token operator">:</span><span class="token string">'raw-loader'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token comment">// HtmlWebpackPlugin 为应用生成一个html文件，并且自动注入所有生成的js bundle，这是loader所做不到的</span>
            <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>template<span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>Mode （webpack4以后）</li></ul> <p>指明当前的构建任务所处的环境，让webpack针对特定环境启动一些优化项</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    mode<span class="token operator">:</span><span class="token string">'production'</span> <span class="token comment">// 'node' | 'development' 'production'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_5-7-深入webpack-高级使用"><a href="#_5-7-深入webpack-高级使用" class="header-anchor">#</a> 5.7 深入webpack：高级使用</h2> <h3 id="_5-7-1-基本配置"><a href="#_5-7-1-基本配置" class="header-anchor">#</a> 5.7.1 基本配置</h3> <h4 id="entry"><a href="#entry" class="header-anchor">#</a> entry</h4> <ul><li>单入口</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
        entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>多入口</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 要为每个入口命名</span>
    module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
        home<span class="token operator">:</span><span class="token string">'./home.js'</span><span class="token punctuation">,</span>
        about<span class="token operator">:</span><span class="token string">'./about.js'</span><span class="token punctuation">,</span>
        contact<span class="token operator">:</span><span class="token string">'./contact.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="output"><a href="#output" class="header-anchor">#</a> output</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
   <span class="token comment">// 输出bundle文件名，hash是wepack使用散列算法生成一段字符串，这样每次打包的文件名都不样</span>
    <span class="token comment">// 这样浏览器即使缓存，每次也能加载最新代码</span>
        filename<span class="token operator">:</span><span class="token string">'[name].[hash].bundle.js'</span>，
        <span class="token comment">// 输出的 chunk文件名，一般是非entry打包出的文件</span>
        chunkFilename：<span class="token string">'[id].js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="资源的加载"><a href="#资源的加载" class="header-anchor">#</a> 资源的加载</h4> <p>我们可以使用loader来加载非js的资源</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// css/rest.css</span>
    body <span class="token punctuation">{</span>
        margin<span class="token operator">:</span><span class="token number">0</span>px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// app.js</span>
    <span class="token keyword">import</span> <span class="token string">'./css/reset.css'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>对于加载非js的资源我们都应该使用<code>loader</code>，所有要加载css的资源我们可以选择<code>style-loader</code>、<code>css-loader</code></p> <p>css-loader使你可以在别的css中可以使用<code>@import</code>的语法引用别的css</p> <p>style-loader把js代码中<code>import</code>导入的样式文件代码，以一种特殊的方式打包到jsbundle的结果中，然后在js的运行时，将样式自动插入</p> <p>页面的style标签中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
      entry<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      output<span class="token operator">:</span><span class="token punctuation">{</span>
          filename<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist/'</span>
      <span class="token punctuation">}</span>
      mode<span class="token operator">:</span><span class="token string">&quot;develoment&quot;</span><span class="token punctuation">,</span>
      plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      module<span class="token operator">:</span><span class="token punctuation">{</span>
          reles<span class="token operator">:</span><span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  test<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>需要注意的是，loader的执行顺序是反的，从数组的最后往前执行，如果使用使用<code>sass</code>，需要配置最后面；这样等sass-loader执行完后的结果</p> <p>在交给css-loader，要不然依赖倒置就会出现错误。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
      entry<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      output<span class="token operator">:</span><span class="token punctuation">{</span>
          filename<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist/'</span>
      <span class="token punctuation">}</span>
      mode<span class="token operator">:</span><span class="token string">&quot;develoment&quot;</span><span class="token punctuation">,</span>
      plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      module<span class="token operator">:</span><span class="token punctuation">{</span>
          reles<span class="token operator">:</span><span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  test<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
                      loader<span class="token operator">:</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span>
                      loader<span class="token operator">:</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span>
                      loader<span class="token operator">:</span><span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
                      options<span class="token operator">:</span><span class="token punctuation">{</span>sourceMap<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  exclude<span class="token operator">:</span><span class="token string">'/node_modules/'</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="资源的处理"><a href="#资源的处理" class="header-anchor">#</a> 资源的处理</h4> <p>MiniCssExtractPlugin把css抽离出单独的文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// loader</span>
<span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'sass-loader'</span>
<span class="token punctuation">}</span>

<span class="token comment">// plugin</span>
<span class="token comment">// 抽取css代码</span>
<span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span><span class="token string">'[name].css?v=[contenthash]'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="html的处理"><a href="#html的处理" class="header-anchor">#</a> HTML的处理</h4> <ul><li>HtmlWebpackPlugin</li></ul> <p>任何js应用都需要由HTML去承载，我们使用HtmlWebpackPlugin去处理项目中的HTML文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 输出的文件名</span>
            filename<span class="token operator">:</span><span class="token string">'index.html'</span>
            <span class="token comment">// 模块文件的路径</span>
            template：path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 配置生成页面的标题</span>
            title<span class="token operator">:</span><span class="token string">'webpack-主页'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="静态资源处理"><a href="#静态资源处理" class="header-anchor">#</a> 静态资源处理</h4> <ul><li>开发中的静态资源</li></ul> <p>图片、字体、音视频等</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png | jpe?g | gif | svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        loader<span class="token operator">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token comment">// 小于8192字节的图片打包成base64图片</span>
            limit<span class="token operator">:</span><span class="token number">8192</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span><span class="token string">'images/[name].[hash:8].[ext]'</span><span class="token punctuation">,</span>
            publicPath<span class="token operator">:</span><span class="token string">''</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    test<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(woff | woff2 | svg | eot | ttf)$</span><span class="token regex-delimiter">/</span></span>
    use<span class="token operator">:</span><span class="token punctuation">[</span>
        loader<span class="token operator">:</span><span class="token string">'file-loader'</span><span class="token punctuation">,</span>
        options <span class="token operator">:</span><span class="token punctuation">{</span>
            limit<span class="token operator">:</span><span class="token number">8192</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span><span class="token string">'font/[name].[ext]?[hash:8]'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="js处理"><a href="#js处理" class="header-anchor">#</a> js处理</h4> <ul><li>babel-loader</li></ul> <p>不另行指定配置的话，会使用项目的.babelrc.json配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token operator">:</span><span class="token punctuation">{</span>
    reles<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js | jsx)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            include<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_5-7-2-高级使用"><a href="#_5-7-2-高级使用" class="header-anchor">#</a> 5.7.2 高级使用</h3> <h4 id="mode"><a href="#mode" class="header-anchor">#</a> mode</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span> <span class="token comment">// none  | production | development</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Mode 用来表示当前的webpack运行环境，本质是在不同的环境下，开启一些内置的优化项</p> <h4 id="devserver"><a href="#devserver" class="header-anchor">#</a> devServer</h4> <ul><li>开发调试</li></ul> <p>想要在代码发生变化后自动编译代码，有三种方式：</p> <ol><li><p>webpack watch mode</p></li> <li><p>webpack-dev-server</p></li> <li><p>webpack-dev-middleware</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    devServer<span class="token operator">:</span><span class="token punctuation">{</span>
        contentBase<span class="token operator">:</span>__dirname<span class="token operator">+</span><span class="token string">'dist'</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span><span class="token number">9000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="hmr-模块热替换"><a href="#hmr-模块热替换" class="header-anchor">#</a> HMR(模块热替换)</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
        devServer<span class="token operator">:</span><span class="token punctuation">{</span>
            contentBase<span class="token operator">:</span>__dirname<span class="token operator">+</span><span class="token string">'dist'</span><span class="token punctuation">,</span>
            compress<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
            port<span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">,</span>
            <span class="token comment">// 开启HMR</span>
            hot<span class="token operator">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>用于在无刷新的情况下，根据文件变动刷新页面的局部状态</p> <h4 id="代码分离"><a href="#代码分离" class="header-anchor">#</a> 代码分离</h4> <ul><li>为什么要代码分离？</li></ul> <p>为了将代码分成多个bundle，并灵活定制加载策略（按需加载、并行加载），从而大大提升应用的加载速度。</p> <ul><li>如何代码分离？</li></ul> <ol><li><p>入口起起点：使用entry配置手动地分离代码</p></li> <li><p>防止重复：使用SplitChunkPlugin去重和分离chunk</p></li> <li><p>动态导入：通过在代码中使用动态加载模块的语法来分离代码</p></li></ol> <ul><li>多入口构建</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span><span class="token punctuation">{</span>
        index<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
        another<span class="token operator">:</span><span class="token string">'./src/another-module.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">'[name].bundle.js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>最终结果：</p> <p>index.bundle.js
another.bundle.js</p> <p>问题：</p> <ol><li>资源可能被重复引入</li> <li>不够灵活</li></ol> <ul><li>splitChunks</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span><span class="token punctuation">{</span>
        index<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
        another<span class="token operator">:</span><span class="token string">'./src/another-module.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">'[name].bundle.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 在webpack4 中将splitChunks统一到了optimization中</span>
   optimization <span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token comment">//    查询相关用法，不是插询optimization，而是查询SplitChunksPlugin这个插件</span>
       splitChunks<span class="token operator">:</span><span class="token punctuation">{</span>
           chunks<span class="token operator">:</span><span class="token string">'all'</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>动态导入</li></ul> <ol><li>import()</li></ol> <p>es module提供语言级的方法</p> <ol start="2"><li>reuire.ensure</li></ol> <p>在没有import方法之前，webpack提供的方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 动态导入是异步的</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:loaash*/</span><span class="token punctuation">,</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span>_<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_5-8-深入webpack-loader和plugin详解"><a href="#_5-8-深入webpack-loader和plugin详解" class="header-anchor">#</a> 5.8 深入webpack：Loader和Plugin详解</h2> <h3 id="_5-8-1-loader的编写"><a href="#_5-8-1-loader的编写" class="header-anchor">#</a> 5.8.1 loader的编写</h3> <ul><li>Webpack Loader的基本结构</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 同步的Loader</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token parameter">input</span> <span class="token operator">=&gt;</span> input <span class="token operator">+</span> input
<span class="token comment">// 异步的Loader</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> callback<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>input<span class="token operator">+</span>input<span class="token punctuation">)</span> <span class="token comment">//返回值用callback传递出去</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>loader-utils</li></ul> <p>loader-utils是编写webpack loader的官方工具库</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">const</span> loaderUtils<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>
    module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取配置</span>
        <span class="token keyword">const</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> result<span class="token operator">=</span>source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'word'</span><span class="token punctuation">,</span>options<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>loader中的 “洋葱模型”</li></ul> <p>style-loader-&gt;css-loader-&gt;postcss-loader</p> <p>在loader执行的时候webpack从左到右依次调用<code>pitch</code>方法，然后在从右到左调用loader本身(execute的过程)。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> input <span class="token operator">+</span> input
<span class="token punctuation">}</span>
<span class="token comment">/*
 remainingReg 是loader链中排在当前这个loader后面所有的loader以及资源文件组成的一个链接，这个链接我们可以理解为一个路径
 在所有的loader处理完毕后，我们可以在webpack中使用一个特殊的require函数，去require这个路径，从而得到当前loader后所有的loader的处理结果。

 precedingReq 是loader链中排在当前这个loader前面所有的loader以及资源文件所组成的链接

 input 是一个对象，各个loader把共享的数据挂载这个对象上，如果pitch返回一个值；那么webpack就会跳过余下的loader pitch和execute的过程，
 也就是说pitch返回阻断了后续loader的执行

*/</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">pitch</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">remainingReg<span class="token punctuation">,</span>precedingReq<span class="token punctuation">,</span>input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        remainingReg request :</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remainingReg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        precedingReq request :</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>precedingReq<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        Input: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">&quot;pitched&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>调试loader</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">const</span> fs <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span><span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-runner'</span><span class="token punctuation">)</span> <span class="token comment">//可以创建一个简单loader调试环境</span>
    
    <span class="token function">runLoaders</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            resource <span class="token operator">:</span> <span class="token string">&quot;./demo.txt&quot;</span><span class="token punctuation">,</span>
            loaders<span class="token operator">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;./loaders/demo-loader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">(</span>err<span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">:</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_5-8-1-plugin的编写"><a href="#_5-8-1-plugin的编写" class="header-anchor">#</a> 5.8.1 plugin的编写</h3> <p>loader有<code>loader-runner</code>作为调试工具，webpack的plugin因为需要的上下文信息太多了，所以没有一个模拟的环境，如果我们要开发<code>plugin</code>需要
配置webpack，在真实的环境中开发。</p> <p><a href="https://www.webpackjs.com/contribute/writing-a-plugin/" target="_blank" rel="noopener noreferrer">webpack官方教你如何编写一个plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>编写pugins我们可以进入<a href="https://www.webpackjs.com/api/compiler-hooks/#emit" target="_blank" rel="noopener noreferrer">webpack网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看相关开发api和hooks。</p> <ol><li>搭建开发环境</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DemoPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./plugins/demo-plugin.js&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">PATHS</span><span class="token operator">=</span><span class="token punctuation">{</span>
    lib<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;shake.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    build<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;build&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry <span class="token operator">:</span> <span class="token punctuation">{</span>
        lib<span class="token operator">:</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>lib
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        path<span class="token operator">:</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>build<span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">&quot;[name].js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">DemoPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="2"><li>Compiler 和 Compilation</li></ol> <p>webpack plugin的本质就是由<code>apply</code>方法的类，通过<code>apply</code>的方法的类我们可以在运行时取得<code>compiler</code>和<code>Compilation</code>这2个实例；
Compiler是编译器的实例（即Webpack），Compilation是每一次编译的过程。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token keyword">class</span> <span class="token class-name">DemoPlugin</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token operator">=</span>options
    <span class="token punctuation">}</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;emit&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="案例实战"><a href="#案例实战" class="header-anchor">#</a> 案例实战</h4> <p>编写一个WebpackPlugin，统计Webpack打包结果中各个文件的大小，并以JSON形式输出统计结果。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpackRources <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-sources'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">WebpackSizePlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PLUGIN_NAME</span> <span class="token operator">=</span> <span class="token string">'WebpackSizePlugin'</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span> <span class="token punctuation">(</span><span class="token parameter">complier</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> outputOptions <span class="token operator">=</span> complier<span class="token punctuation">.</span>options<span class="token punctuation">.</span>output <span class="token comment">// 拿到output配置，拿到文件最终的输出路径是什么</span>
    <span class="token comment">// 我们插件的目的是统计出打包出来文件的大小，所以我们需要注册到打包结果后的hooks上，由于要输出json，所以要在输出硬盘之前   </span>
    complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PLUGIN_NAME</span><span class="token punctuation">,</span> <span class="token comment">// 插件的名称</span>
      <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 在这个函数中可以读取和操作本次编译的结果</span>
        <span class="token keyword">const</span> assets <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets <span class="token comment">// 所有的编译结果都可以通过compilation.assets拿到</span>
        <span class="token keyword">const</span> buildSize <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">const</span> files <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span>
        <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> size <span class="token operator">=</span> assets<span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 拿到字符数</span>
          buildSize<span class="token punctuation">[</span>file<span class="token punctuation">]</span> <span class="token operator">=</span> size
          total <span class="token operator">+=</span> size
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Build Size'</span><span class="token punctuation">,</span> buildSize<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Total Size'</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span>
        buildSize<span class="token punctuation">.</span>total <span class="token operator">=</span> total
        <span class="token comment">// 想要webpack生成一个文件，只需这个文件以键值对的形式加入到assets对象中，那么在打包执行完毕之后，webpack会自动帮我们生成</span>
        assets<span class="token punctuation">[</span>
          outputOptions<span class="token punctuation">.</span>publicPath <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>fileName <span class="token operator">:</span> <span class="token string">'build-size.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webpackRources<span class="token punctuation">.</span>RawSource</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>buildSize<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// assets对象中文件的内容，也就是说assets对象中每一项的值它是一个RawSource对象，而不是一个普通的字符串，上面要输出rawsource对象</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>webpack配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">WebpackSizePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fileName<span class="token operator">:</span> <span class="token string">'size.json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="扩展学习"><a href="#扩展学习" class="header-anchor">#</a> 扩展学习</h3> <p><a href="https://www.npmjs.com/package/loader-utils" target="_blank" rel="noopener noreferrer">loader-utils项目地址：<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_5-9-webpack性能优化"><a href="#_5-9-webpack性能优化" class="header-anchor">#</a> 5.9 webpack性能优化</h2> <h3 id="_5-9-1-webpack数据分析"><a href="#_5-9-1-webpack数据分析" class="header-anchor">#</a> 5.9.1 webpack数据分析</h3> <h4 id="webpack-bundle-analyzer-文件体积分析"><a href="#webpack-bundle-analyzer-文件体积分析" class="header-anchor">#</a> webpack-bundle-analyzer(文件体积分析)</h4> <p>它能分析打包出的文件有哪些，大小占比如何，模块包含关系，依赖项，文件是否重复，压缩后大小</p> <ol><li>webpack.config.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>BundleAnalyzerPlugin<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    analyzerMode<span class="token operator">:</span> <span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token comment">// 不启动展示打包报告的http服务器</span>
    generateStatsFile<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否生成stats.json文件 </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>package.json</li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack  --progress&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-bundle-analyzer --port 8888 ./dist/stats.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="speed-measure-webpack-plugin-分析打包速度"><a href="#speed-measure-webpack-plugin-分析打包速度" class="header-anchor">#</a> speed-measure-webpack-plugin（分析打包速度）</h4> <ol><li>webpack.config.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack5-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="friendly-errors-webpack-plugink-美化输出日志"><a href="#friendly-errors-webpack-plugink-美化输出日志" class="header-anchor">#</a> friendly-errors-webpack-pluginK(美化输出日志)</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> friendly-errors-webpack-plugin  node-notifier -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FriendlyErrorsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-notifier'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> 
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">onErrors</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">severity<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> error <span class="token operator">=</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    notifier<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&quot;Webpack编译失败&quot;</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> severity <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>name<span class="token punctuation">,</span> subtitle<span class="token operator">:</span> error<span class="token punctuation">.</span>file <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_5-9-2-编译时间优化"><a href="#_5-9-2-编译时间优化" class="header-anchor">#</a> 5.9.2 编译时间优化</h3> <h4 id="_1-extensions"><a href="#_1-extensions" class="header-anchor">#</a> 🍅 1. extensions</h4> <ul><li>添加extensions后我们在用<code>require</code>、<code>import</code>的时候不用添加文件扩展名</li> <li>编译的时候会依次添加扩展名进行匹配</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span>、<span class="token string">&quot;.jsx&quot;</span>、<span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-alias"><a href="#_2-alias" class="header-anchor">#</a> 🍅 2. alias</h4> <p>配置文件别名可以加快webpack查找模块的速度</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> elementUi <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'node_modules/element-ui/lib/theme-chalk/index.css'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
        resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span>、<span class="token string">&quot;.jsx&quot;</span>、<span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'element-ui'</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>当我们引入elementUi模块的时候，它会直接引入elementUi，不需要从node_modules文件中按模块规则查找</p> <h4 id="_3-modules"><a href="#_3-modules" class="header-anchor">#</a> 🍅 3. modules</h4> <p>指定项目的所有第三方模块都是在项目根目录下的node_modules</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> elementUi <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'node_modules/element-ui/lib/theme-chalk/index.css'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
        resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span>、<span class="token string">&quot;.jsx&quot;</span>、<span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_4-oneof"><a href="#_4-oneof" class="header-anchor">#</a> 🍅 4. oneOf</h4> <ul><li>每个文件对于rules中的所有规则都会遍历一遍，如果使用oneOf，只要能匹配一个就立即退出</li> <li>在oneOf中不能2个配置处理同一类型文件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
     oneOf<span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                workers<span class="token operator">:</span> <span class="token number">3</span> 
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              loader<span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
              options<span class="token operator">:</span> <span class="token punctuation">{</span>
                cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'cache-loader'</span><span class="token punctuation">,</span><span class="token string">'logger-loader'</span><span class="token punctuation">,</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span> 
     <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_5-external"><a href="#_5-external" class="header-anchor">#</a> 🍅 5. external</h4> <p>如果某个库我们不想让它被webpack打包，想让它用cdn的方法是引入，并且不影响我们在程序中以CMD、AMD方式进行使用</p> <p>下载插件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> html-webpack-externals-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在html文件中引入cdn的文件</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.abc.com/vue/2.5.11/vue.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>webpack中的配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> externals: <span class="token punctuation">{</span>
  vue: <span class="token string">'vue'</span>,
<span class="token punctuation">}</span>,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_6-resolveloader"><a href="#_6-resolveloader" class="header-anchor">#</a> 🍅 6. resolveLoader</h4> <p>就是指定loader的resolve，只作用于loader；resolve配置用来影响webpack模块解析规则。解析规则也可以称之为检索，索引规则。配置索引规则能够缩短webpack的解析时间，提升打包速度。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span>、<span class="token string">&quot;.jsx&quot;</span>、<span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolveLoader<span class="token operator">:</span><span class="token punctuation">{</span>
     modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;loaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>   
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_7-noparse"><a href="#_7-noparse" class="header-anchor">#</a> 🍅 7. noParse</h4> <ul><li>用于配置哪些模块的文件内容不需要进行解析</li> <li>不需要解析依赖就是没有依赖的第三方大型类库，可以配置这个字段，以提高整体的构建速度</li> <li>使用noparse进行忽略的模块文件中不能使用import、require等语法</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
module<span class="token operator">:</span> <span class="token punctuation">{</span>
    noParse<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">test.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则表达式</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_8-thread-loader-多进程"><a href="#_8-thread-loader-多进程" class="header-anchor">#</a> 🍅 8. thread-loader(多进程)</h4> <ul><li>把thread-loader放置在其他 loader 之前</li> <li>include 表示哪些目录中的 .js 文件需要进行 babel-loader</li> <li>exclude 表示哪些目录中的 .js 文件不要进行 babel-loader</li> <li>exclude 的优先级高于 include ,尽量避免 exclude ，更倾向于使用 include</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
     oneOf<span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  workers<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// 自己电脑的核心数减1</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              loader<span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
              options<span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token comment">// babel在转移js非常耗时间，可以将结果缓存起来，下次直接读缓存；默认存放位置是 node_modules/.cache/babel-loader</span>
                cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span> 
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'cache-loader'</span><span class="token punctuation">,</span><span class="token string">'logger-loader'</span><span class="token punctuation">,</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span> 
     <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_8-cache-loader"><a href="#_8-cache-loader" class="header-anchor">#</a> 🍅 8. cache-loader</h4> <ul><li>在一些性能开销较大的loader之前添加cache-loader，可以将结果缓存到磁盘中</li> <li>默认保存在 node_modules/.cache/cache-loader 目录下</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
     oneOf<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'cache-loader'</span><span class="token punctuation">,</span><span class="token string">'logger-loader'</span><span class="token punctuation">,</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span> 
     <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_9-hard-source-webpack-plugin"><a href="#_9-hard-source-webpack-plugin" class="header-anchor">#</a> 🍅 9. hard-source-webpack-plugin</h4> <ul><li>HardSourceWebpackPlugin 为模块提供了中间缓存,缓存默认的存放路径是
node_modules/.cache/hard-source</li> <li>配置 hard-source-webpack-plugin 后，首次构建时间并不会有太大的变化，但是从第二次开始， 构建时间大约可以减少80% 左右</li> <li>webpack5中已经内置了模块缓存,不需要再使用此插件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> hard-source-webpack-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_5-9-3-编译体积优化"><a href="#_5-9-3-编译体积优化" class="header-anchor">#</a> 5.9.3 编译体积优化</h3> <h4 id="_1-压缩js、css、html和图片"><a href="#_1-压缩js、css、html和图片" class="header-anchor">#</a> 🍅 1. 压缩js、css、HTML和图片</h4> <ul><li>optimize-css-assets-webpack-plugin是一个优化和压缩CSS资源的插件</li> <li>terser-webpack-plugin是一个优化和压缩JS资源的插件</li> <li>image-webpack-loader可以帮助我们对图片进行压缩和优化</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> terser-webpack-plugin optimize-css-assets-webpack-plugin image-webpack-
loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
     minimize<span class="token operator">:</span> <span class="token boolean">true</span>
     minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
   module<span class="token operator">:</span><span class="token punctuation">{</span>
     rules<span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|svg|jpg|gif|jpeg|ico)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
                       progressive<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                       quality<span class="token operator">:</span> <span class="token number">65</span> 
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
                        enabled<span class="token operator">:</span> <span class="token boolean">false</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
                        quality<span class="token operator">:</span> <span class="token string">'65-90'</span><span class="token punctuation">,</span>
                        speed<span class="token operator">:</span> <span class="token number">4</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
                        interlaced<span class="token operator">:</span> <span class="token boolean">false</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    webp<span class="token operator">:</span> <span class="token punctuation">{</span>
                         quality<span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">]</span>
     <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
          minify<span class="token operator">:</span> <span class="token punctuation">{</span>
              collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              removeComments<span class="token operator">:</span> <span class="token boolean">true</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span> 
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h4 id="_2-清除无用的css"><a href="#_2-清除无用的css" class="header-anchor">#</a> 🍅 2. 清除无用的css</h4> <p>purgecss-webpack-plugin单独提取CSS并清除用不到的CSS</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;purgecss-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    src<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
     minimize<span class="token operator">:</span> <span class="token boolean">true</span>
     minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
   module<span class="token operator">:</span><span class="token punctuation">{</span>
     rules<span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              loader<span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
         <span class="token punctuation">}</span><span class="token punctuation">]</span>
     <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         filename<span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span> 
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="_3-tree-shaking"><a href="#_3-tree-shaking" class="header-anchor">#</a> 🍅 3. Tree shaking</h4> <ul><li>webpack默认支持,可在 production mode下默认开启</li> <li>在package.json 中配置:
<ul><li>&quot;sideEffects&quot;: false 所有的代码都没有副作用(都可以进行 tree shaking)</li> <li>可能会把 css和@babel/polyfill 文件干掉可以设置 &quot;sideEffects&quot;:[&quot;*.css&quot;]</li></ul></li></ul> <p>会把以下情况的代码 Tree shaking</p> <ol><li>没有导入和使用</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'func1'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'func2'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
  func1<span class="token punctuation">,</span>
  func2
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./functions'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>代码不会被执行，不可到达</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'false'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>代码执行的结果不会被用到</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./functions'</span><span class="token punctuation">;</span>
<span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>代码中只写不读的变量</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">1</span>
a<span class="token operator">=</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_3-scope-hoisting"><a href="#_3-scope-hoisting" class="header-anchor">#</a> 🍅 3. Scope Hoisting</h4> <ul><li>Scope Hoisting 可以让 Webpack 打包出来的代码文件更小、运行的更快，它又译作 &quot;作用域提升&quot;，是在 Webpack3 中新推出的功能。</li> <li>scope hoisting的原理是将所有的模块按照引用顺序放在一个函数作用域里，然后适当地重命名一 些变量以防止命名冲突</li> <li>这个功能在mode为 下默认开启,开发环境要用 webpack.optimizeModuleConcatenationPlugin 插件</li></ul> <p>doc.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>app.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> str <span class="token keyword">from</span> <span class="token string">'./doc.js'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>作用域提升</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-9-4-运行速度优化"><a href="#_5-9-4-运行速度优化" class="header-anchor">#</a> 5.9.4 运行速度优化</h3> <ul><li>对于大的Web应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些 代码块是在某些特殊的时候才会被用到。</li> <li>webpack有一个功能就是将你的代码库分割成chunks语块，当代码运行到需要它们的时候再进行 加载</li></ul> <h4 id="_1-入口点分割"><a href="#_1-入口点分割" class="header-anchor">#</a> 🍅 1. 入口点分割</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        index<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
        login<span class="token operator">:</span> <span class="token string">&quot;./src/login.js&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>这种方法的问题
<ul><li>如果入口chunks之间包含重复的模块(lodash)，那些重复模块都会被引入到各个bundle中</li> <li>不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码</li></ul></li></ul> <h4 id="_2-懒加载"><a href="#_2-懒加载" class="header-anchor">#</a> 🍅 2. 懒加载</h4> <p>可以用<code>import()</code>方式去引入模块，当需要的时候在加载某个功能对应代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;login&quot; */</span><span class="token string">'@/components/Login/Login'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3-prefetch"><a href="#_3-prefetch" class="header-anchor">#</a> 🍅 3. prefetch</h4> <ul><li>使用预先拉取，你表示该模块可能以后会用到。浏览器会在空闲时间下载该模块</li> <li>prefetch的作用是告诉浏览器未来可能会使用到的某个资源，浏览器就会在闲时去加载对应的资
源，若能预测到用户的行为，比如懒加载，点击到其它页面等则相当于提前预加载了需要的资源</li> <li><code>&lt;link rel=&quot;prefetch&quot; as=&quot;script&quot; href=&quot;test.js&quot;&gt;</code>此方法添加头部，浏览器会在空闲时间预先拉取该文件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'login', webpackPrefetch: true
*/</span><span class="token string">'./login'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-提取公共代码"><a href="#_4-提取公共代码" class="header-anchor">#</a> 🍅 4. 提取公共代码</h4> <p><a href="https://webpack.js.org/plugins/split-chunks-plugin/#root" target="_blank" rel="noopener noreferrer">splitChunks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
output<span class="token operator">:</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
      chunkFilename<span class="token operator">:</span><span class="token string">'[name].js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        index<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
        login<span class="token operator">:</span> <span class="token string">&quot;./src/login.js&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
    chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>  <span class="token comment">// 分割同步异步的代码</span>
    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token comment">// 最小体积</span>
    minRemainingSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 代码分割后的最小保留体积，默认等于minSize</span>
    maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 最大体积</span>
    minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 最小代码快</span>
    maxAsyncRequests<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 最大异步请求数</span>
    maxInitialRequests<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 最小异步请求数</span>
    automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 名称分离符</span>
    enforceSizeThreshold<span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token comment">//执行拆分的大小阈值，忽略其他限制</span>
    <span class="token comment">// (minRemainingSize、maxAsyncRequests、maxInitialRequests) </span>
    cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
    defaultVendors<span class="token operator">:</span> <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//控制此缓存组选择哪些模块</span>
        priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">//一个模块属于多个缓存组,默认缓存组的优先级是负数，自定义缓存组的优先级更高，默认值为0 //如果当前代码块包含已经主代码块中分离出来的模块，那么它将被重用，而不是生成新的模块。这可能会影响块的结果文件名。</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">'page1.html'</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">'page2.html'</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="_4-cdn"><a href="#_4-cdn" class="header-anchor">#</a> 🍅 4. CDN</h4> <ul><li>最影响用户体验的是网页首次打开时的加载等待。 导致这个问题的根本是网络传输过程耗时大， CDN的作用就是加速网络传输。</li> <li>CDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近 的服务器获取资源，从而加速资源的获取速度</li> <li>用户使用浏览器第一次访问我们的站点时，该页面引入了各式各样的静态资源，如果我们能做到持 久化缓存的话，可以在 http 响应头加上 Cache-control Expires字段来设置缓存，浏览器可以 将这些资源一一缓存到本地</li> <li>用户在后续访问的时候，如果需要再次请求同样的静态资源，且静态资源没有过期，那么浏览器可以直接走本地缓存而不用再通过网络请求资源</li> <li>缓存配置
<ul><li>HTML文件不缓存，放在自己的服务器上，关闭自己服务器的缓存，静态资源的URL变成指向 CDN服务器的地址</li> <li>静态的JavaScript、CSS、图片等文件开启CDN和缓存，并且文件名带上HASH值</li> <li>为了并行加载不阻塞，把不同的静态资源分配到不同的CDN服务器上</li></ul></li> <li>域名限制
<ul><li>同一时刻针对同一个域名的资源并行请求是有限制 可以把这些静态资源分散到不同的 CDN 服务上去 多个域名后会增加域名解析时间</li> <li>可以通过在 HTML HEAD 标签中 加入去预解析域名，以降低域名解析带来的延迟</li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/13/2025, 7:45:34 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/engineering/design.html" class="prev">工程设计</a></span> <span class="next"><a href="/engineering/auto-deploy.html">持续集成与部署</a>
      →
    </span></p></div> </main> <footer class="footer" data-v-266a5a28><div class="container" data-v-266a5a28><p class="text-center" data-v-266a5a28>© 2024 web全栈体系. All Rights Reserved.（所有文章未经授权禁止转载、摘编、复制或建立镜像，如有违反，追究法律责任。）</p> <p class="text-center" data-v-266a5a28><a href="https://beian.miit.gov.cn" target="_blank" data-v-266a5a28>豫ICP备19041317号-1</a></p></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0f616eb6.js" defer></script><script src="/assets/js/3.9750fba5.js" defer></script><script src="/assets/js/2.6aa46093.js" defer></script><script src="/assets/js/15.3e7fea41.js" defer></script>
  </body>
</html>
