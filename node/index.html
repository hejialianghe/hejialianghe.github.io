<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.1 Nodejs 简介 | web全栈体系</title>
    <meta name="description" content="你好，朋友">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.5718d53e.css" as="style"><link rel="preload" href="/assets/js/app.0f616eb6.js" as="script"><link rel="preload" href="/assets/js/3.9750fba5.js" as="script"><link rel="preload" href="/assets/js/2.6aa46093.js" as="script"><link rel="preload" href="/assets/js/6.45a79ebc.js" as="script"><link rel="prefetch" href="/assets/js/10.3b417cc7.js"><link rel="prefetch" href="/assets/js/100.450b51bc.js"><link rel="prefetch" href="/assets/js/101.02365136.js"><link rel="prefetch" href="/assets/js/102.23f6118f.js"><link rel="prefetch" href="/assets/js/103.4decf838.js"><link rel="prefetch" href="/assets/js/104.d39cfd73.js"><link rel="prefetch" href="/assets/js/105.88534338.js"><link rel="prefetch" href="/assets/js/106.366d0b59.js"><link rel="prefetch" href="/assets/js/107.cf3cfcba.js"><link rel="prefetch" href="/assets/js/108.21694919.js"><link rel="prefetch" href="/assets/js/109.4e4fd62e.js"><link rel="prefetch" href="/assets/js/11.9d20f01b.js"><link rel="prefetch" href="/assets/js/110.aeb394e4.js"><link rel="prefetch" href="/assets/js/111.d6595775.js"><link rel="prefetch" href="/assets/js/12.ac6dcc46.js"><link rel="prefetch" href="/assets/js/13.3990b71a.js"><link rel="prefetch" href="/assets/js/14.42418305.js"><link rel="prefetch" href="/assets/js/15.3e7fea41.js"><link rel="prefetch" href="/assets/js/16.e9242241.js"><link rel="prefetch" href="/assets/js/17.5cb2a82b.js"><link rel="prefetch" href="/assets/js/18.09a2ee08.js"><link rel="prefetch" href="/assets/js/19.5e018236.js"><link rel="prefetch" href="/assets/js/20.2f6aad81.js"><link rel="prefetch" href="/assets/js/21.56a0a87d.js"><link rel="prefetch" href="/assets/js/22.37a8fef4.js"><link rel="prefetch" href="/assets/js/23.75c65558.js"><link rel="prefetch" href="/assets/js/24.19255d9b.js"><link rel="prefetch" href="/assets/js/25.b96e970c.js"><link rel="prefetch" href="/assets/js/26.8043101d.js"><link rel="prefetch" href="/assets/js/27.c05d3044.js"><link rel="prefetch" href="/assets/js/28.c0aa90a2.js"><link rel="prefetch" href="/assets/js/29.06c0191d.js"><link rel="prefetch" href="/assets/js/30.975fb305.js"><link rel="prefetch" href="/assets/js/31.0cba5310.js"><link rel="prefetch" href="/assets/js/32.d8bc188f.js"><link rel="prefetch" href="/assets/js/33.384f6578.js"><link rel="prefetch" href="/assets/js/34.6baca6a7.js"><link rel="prefetch" href="/assets/js/35.96ec3f3e.js"><link rel="prefetch" href="/assets/js/36.bd945c36.js"><link rel="prefetch" href="/assets/js/37.be27655b.js"><link rel="prefetch" href="/assets/js/38.e8e93b37.js"><link rel="prefetch" href="/assets/js/39.ef88fac1.js"><link rel="prefetch" href="/assets/js/4.aa28cc69.js"><link rel="prefetch" href="/assets/js/40.b6dad60d.js"><link rel="prefetch" href="/assets/js/41.c762ef5a.js"><link rel="prefetch" href="/assets/js/42.151d8a58.js"><link rel="prefetch" href="/assets/js/43.632c642f.js"><link rel="prefetch" href="/assets/js/44.2e34b5d9.js"><link rel="prefetch" href="/assets/js/45.94f8db29.js"><link rel="prefetch" href="/assets/js/46.57527f8f.js"><link rel="prefetch" href="/assets/js/47.44a84132.js"><link rel="prefetch" href="/assets/js/48.66958018.js"><link rel="prefetch" href="/assets/js/49.21739b30.js"><link rel="prefetch" href="/assets/js/5.e06ff02e.js"><link rel="prefetch" href="/assets/js/50.000c5d7c.js"><link rel="prefetch" href="/assets/js/51.b59a6470.js"><link rel="prefetch" href="/assets/js/52.3a475ad4.js"><link rel="prefetch" href="/assets/js/53.9801890b.js"><link rel="prefetch" href="/assets/js/54.269a45cd.js"><link rel="prefetch" href="/assets/js/55.91e89997.js"><link rel="prefetch" href="/assets/js/56.493b7ae8.js"><link rel="prefetch" href="/assets/js/57.ec46c27c.js"><link rel="prefetch" href="/assets/js/58.56202f8d.js"><link rel="prefetch" href="/assets/js/59.4dac8d8a.js"><link rel="prefetch" href="/assets/js/60.77f7cd1f.js"><link rel="prefetch" href="/assets/js/61.a48bae63.js"><link rel="prefetch" href="/assets/js/62.626e88b6.js"><link rel="prefetch" href="/assets/js/63.9d36ed5d.js"><link rel="prefetch" href="/assets/js/64.a6a4e5c6.js"><link rel="prefetch" href="/assets/js/65.e32c3a18.js"><link rel="prefetch" href="/assets/js/66.0de20cc0.js"><link rel="prefetch" href="/assets/js/67.b24d4adf.js"><link rel="prefetch" href="/assets/js/68.7269173e.js"><link rel="prefetch" href="/assets/js/69.9999d01e.js"><link rel="prefetch" href="/assets/js/7.1a1f32a2.js"><link rel="prefetch" href="/assets/js/70.a45e1785.js"><link rel="prefetch" href="/assets/js/71.d443735d.js"><link rel="prefetch" href="/assets/js/72.56bd9ca0.js"><link rel="prefetch" href="/assets/js/73.4a484020.js"><link rel="prefetch" href="/assets/js/74.d0f77ba8.js"><link rel="prefetch" href="/assets/js/75.8595de75.js"><link rel="prefetch" href="/assets/js/76.b89309e6.js"><link rel="prefetch" href="/assets/js/77.1a28c952.js"><link rel="prefetch" href="/assets/js/78.156340fe.js"><link rel="prefetch" href="/assets/js/79.bc68f887.js"><link rel="prefetch" href="/assets/js/8.ffcc6d32.js"><link rel="prefetch" href="/assets/js/80.00742412.js"><link rel="prefetch" href="/assets/js/81.d07bf30f.js"><link rel="prefetch" href="/assets/js/82.dd648b4e.js"><link rel="prefetch" href="/assets/js/83.50310bd1.js"><link rel="prefetch" href="/assets/js/84.8b446b87.js"><link rel="prefetch" href="/assets/js/85.1bbf1222.js"><link rel="prefetch" href="/assets/js/86.b1112682.js"><link rel="prefetch" href="/assets/js/87.5353ad37.js"><link rel="prefetch" href="/assets/js/88.3bc7938a.js"><link rel="prefetch" href="/assets/js/89.c9d6877e.js"><link rel="prefetch" href="/assets/js/9.bfaf9c10.js"><link rel="prefetch" href="/assets/js/90.f7c20556.js"><link rel="prefetch" href="/assets/js/91.72437dd2.js"><link rel="prefetch" href="/assets/js/92.2a17869e.js"><link rel="prefetch" href="/assets/js/93.cc33ea11.js"><link rel="prefetch" href="/assets/js/94.49e5d122.js"><link rel="prefetch" href="/assets/js/95.9c954379.js"><link rel="prefetch" href="/assets/js/96.638e1dee.js"><link rel="prefetch" href="/assets/js/97.c2372908.js"><link rel="prefetch" href="/assets/js/98.762254ac.js"><link rel="prefetch" href="/assets/js/99.29af3121.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5718d53e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-266a5a28><header class="navbar" data-v-266a5a28><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="web全栈体系" class="logo"> <span class="site-name can-hide">web全栈体系</span></a> <div class="carousel" data-v-1a4d21d9></div> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a href="https://github.com/hejialianghe" class="repo-star"><img src="https://img.shields.io/github/stars/hejialianghe/Senior-FrontEnd.svg?style=flat-square" alt></a> <div class="nav-item"><a href="/algorithm/complexity.html" class="nav-link">算法小册</a></div><div class="nav-item"><a href="/guide/" class="nav-link">web体系</a></div><div class="nav-item"><a href="/fp/react/build-react.html" class="nav-link">框架原理</a></div><div class="nav-item"><a href="https://github.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en-US/node/" class="nav-link">English</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-266a5a28></div> <aside class="sidebar" data-v-266a5a28><nav class="nav-links"><a href="https://github.com/hejialianghe" class="repo-star"><img src="https://img.shields.io/github/stars/hejialianghe/Senior-FrontEnd.svg?style=flat-square" alt></a> <div class="nav-item"><a href="/algorithm/complexity.html" class="nav-link">算法小册</a></div><div class="nav-item"><a href="/guide/" class="nav-link">web体系</a></div><div class="nav-item"><a href="/fp/react/build-react.html" class="nav-link">框架原理</a></div><div class="nav-item"><a href="https://github.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/hejialianghe/Senior-FrontEnd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en-US/node/" class="nav-link">English</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jsadvanced/" class="sidebar-link">前言</a></li><li><a href="/jsadvanced/function.html" class="sidebar-link">函数</a></li><li><a href="/jsadvanced/asyncpro.html" class="sidebar-link">异步编程</a></li><li><a href="/jsadvanced/designpattern.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>计算机网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/computerNetwork/protocal.html" class="sidebar-link">网络协议</a></li><li><a href="/computerNetwork/network-actual.html" class="sidebar-link">网络请求实战</a></li><li><a href="/computerNetwork/security.html" class="sidebar-link">网络安全与攻防</a></li><li><a href="/computerNetwork/browser-status.html" class="sidebar-link">浏览器状态同步和路由</a></li><li><a href="/computerNetwork/tools.html" class="sidebar-link">工具链和其他</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/" class="sidebar-link">前言</a></li><li><a href="/vue/vueBase.html" class="sidebar-link">vue基础</a></li><li><a href="/vue/vueComponents.html" class="sidebar-link">探索vue的组件世界</a></li><li><a href="/vue/sourceCode.html" class="sidebar-link">部分源码解析</a></li><li><a href="/vue/serverSideRender.html" class="sidebar-link">服务端渲染</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>react</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/" class="sidebar-link">入门介绍</a></li><li><a href="/react/react-base.html" class="sidebar-link">步入react</a></li><li><a href="/react/react-positive.html" class="sidebar-link">react正篇</a></li><li><a href="/react/react-ecology.html" class="sidebar-link">react生态</a></li><li><a href="/react/react-principle.html" class="sidebar-link">react原理</a></li><li><a href="/react/react-state-mana.html" class="sidebar-link">react状态管理</a></li><li><a href="/react/react-actualCombat.html" class="sidebar-link">react高级实战</a></li><li><a href="/react/react-hooks.html" class="sidebar-link">react-hooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node.js进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/" aria-current="page" class="active sidebar-link">Node.js基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-1-nodejs-简介" class="sidebar-link">1.1 Nodejs 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-1-1-安装node" class="sidebar-link">1.1.1 安装node</a></li><li class="sidebar-sub-header"><a href="/node/#_1-1-2-node版本选择" class="sidebar-link">1.1.2 node版本选择</a></li><li class="sidebar-sub-header"><a href="/node/#_1-1-3-nodejs模块机制及包管理器" class="sidebar-link">1.1.3 Nodejs模块机制及包管理器</a></li><li class="sidebar-sub-header"><a href="/node/#_1-1-4-nodejs的能力" class="sidebar-link">1.1.4 Nodejs的能力</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/#_1-2-nodejs提供的原生api能力-上" class="sidebar-link">1.2 Nodejs提供的原生API能力（上）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-2-1-了解nodejs提供的数据类型" class="sidebar-link">1.2.1 了解Nodejs提供的数据类型</a></li><li class="sidebar-sub-header"><a href="/node/#_1-2-2-nodejs-工具库" class="sidebar-link">1.2.2 Nodejs 工具库</a></li><li class="sidebar-sub-header"><a href="/node/#_1-2-3-nodejs的文件操作能力" class="sidebar-link">1.2.3 Nodejs的文件操作能力</a></li><li class="sidebar-sub-header"><a href="/node/#_1-2-4-nodejs的文件操作能力" class="sidebar-link">1.2.4 Nodejs的文件操作能力</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/#_1-3-nodejs提供的原生api能力-下" class="sidebar-link">1.3 Nodejs提供的原生API能力（下）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-3-1-nodejs的模块机制及原理" class="sidebar-link">1.3.1 Nodejs的模块机制及原理</a></li><li class="sidebar-sub-header"><a href="/node/#_1-3-2-nodejs的网络编程能力" class="sidebar-link">1.3.2 Nodejs的网络编程能力</a></li><li class="sidebar-sub-header"><a href="/node/#_1-3-3-的进程管理" class="sidebar-link">1.3.3 的进程管理</a></li><li class="sidebar-sub-header"><a href="/node/#_1-3-4-扩展资料" class="sidebar-link">1.3.4 扩展资料</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/#_1-4-nodejs原生web-server实战" class="sidebar-link">1.4 Nodejs原生Web Server实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-4-1-web-server的构成" class="sidebar-link">1.4.1 Web Server的构成</a></li><li class="sidebar-sub-header"><a href="/node/#_1-4-2-web-server的优势" class="sidebar-link">1.4.2 Web Server的优势</a></li><li class="sidebar-sub-header"><a href="/node/#_1-4-3-web-server的最小系统" class="sidebar-link">1.4.3 Web Server的最小系统</a></li><li class="sidebar-sub-header"><a href="/node/#_1-4-3-扩展" class="sidebar-link">1.4.3 扩展</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/#_1-5-使用express搭建web-server" class="sidebar-link">1.5 使用Express搭建Web server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-5-1-express-框架概览" class="sidebar-link">1.5.1 Express 框架概览</a></li><li class="sidebar-sub-header"><a href="/node/#_1-5-2-express的能力" class="sidebar-link">1.5.2 Express的能力</a></li><li class="sidebar-sub-header"><a href="/node/#_1-5-3-express-web-server实战" class="sidebar-link">1.5.3 Express Web Server实战</a></li><li class="sidebar-sub-header"><a href="/node/#_1-5-4扩展学习" class="sidebar-link">1.5.4扩展学习</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/#_1-6-使用nodejs编写-restful-api" class="sidebar-link">1.6 使用Nodejs编写 RESTful API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/#_1-6-1-restful-api" class="sidebar-link">1.6.1 RESTful API</a></li><li class="sidebar-sub-header"><a href="/node/#_1-6-2-rest-工程实践" class="sidebar-link">1.6.2 REST 工程实践</a></li><li class="sidebar-sub-header"><a href="/node/#rest-接口设计-路由" class="sidebar-link">REST 接口设计-路由</a></li><li class="sidebar-sub-header"><a href="/node/#数据表设计-封装数据服务" class="sidebar-link">数据表设计-封装数据服务</a></li><li class="sidebar-sub-header"><a href="/node/#_1-6-3-rest-最佳实践" class="sidebar-link">1.6.3 REST 最佳实践</a></li></ul></li></ul></li><li><a href="/node/koa.html" class="sidebar-link">koa</a></li><li><a href="/node/egg.html" class="sidebar-link">企业级框架egg</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/script.html" class="sidebar-link">脚本世界</a></li><li><a href="/engineering/coding-standards.html" class="sidebar-link">规范先行</a></li><li><a href="/engineering/quality-code.html" class="sidebar-link">质量代码</a></li><li><a href="/engineering/design.html" class="sidebar-link">工程设计</a></li><li><a href="/engineering/ctg-art.html" class="sidebar-link">构建艺术</a></li><li><a href="/engineering/auto-deploy.html" class="sidebar-link">持续集成与部署</a></li><li><a href="/engineering/git.html" class="sidebar-link">Git操作</a></li><li><a href="/engineering/tool.html" class="sidebar-link">效率工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/applets/performance.html" class="sidebar-link">小程序进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/projectPractice/isomorphism.html" class="sidebar-link">认识同构及原理</a></li><li><a href="/projectPractice/demo.html" class="sidebar-link">实现一个同构的demo</a></li><li><a href="/projectPractice/nextjs.html" class="sidebar-link">Nextjs</a></li></ul></section></li></ul> </aside> <main class="page" data-v-266a5a28> <div class="ads" data-v-a4c8d602><div class="item" data-v-a4c8d602><h6 class="title" style="display:;" data-v-a4c8d602>联系作者</h6> <div class="thumb" data-v-a4c8d602><a href="/weixin.jpeg" target="_blank" data-v-a4c8d602><img src="/weixin.jpeg" alt="联系作者" data-v-a4c8d602></a></div></div></div> <div class="theme-default-content content__default"><h2 id="_1-1-nodejs-简介"><a href="#_1-1-nodejs-简介" class="header-anchor">#</a> 1.1 Nodejs 简介</h2> <h3 id="_1-1-1-安装node"><a href="#_1-1-1-安装node" class="header-anchor">#</a> 1.1.1 安装node</h3> <h4 id="mac"><a href="#mac" class="header-anchor">#</a> Mac</h4> <ol><li>MacOS-installer.pkg 官方提供的安装包</li> <li>HomeBrew 命令安装到全局</li> <li>nvm 管理版本，方便切换（推荐）</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 安装nvm</span>
<span class="token function">sudo</span> <span class="token function">curl</span> https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.1/install.sh <span class="token operator">|</span> <span class="token function">bash</span>
<span class="token comment"># nvm安装node</span>
nvm <span class="token function">install</span> --lts
<span class="token comment"># 如果显示没有发现这个命令，就编辑.bash_profile</span>
 <span class="token function">vim</span> .bash_profile
<span class="token comment"># 把以下复制进去，wq保存退出，如果不了解vim编辑，可以谷歌</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NVM_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$HOME</span>/.nvm&quot;</span>
<span class="token punctuation">[</span> -s <span class="token string">&quot;<span class="token variable">$NVM_DIR</span>/nvm.sh&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>. <span class="token string">&quot;<span class="token variable">$NVM_DIR</span>/nvm.sh&quot;</span>  <span class="token comment"># This loads nvm</span>
<span class="token punctuation">[</span> -s <span class="token string">&quot;<span class="token variable">$NVM_DIR</span>/bash_completion&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>. <span class="token string">&quot;<span class="token variable">$NVM_DIR</span>/bash_completion&quot;</span>  <span class="token comment"># This loads nvm bash_completion</span>
<span class="token comment"># 然后 source 一下 .bash_profile</span>
<span class="token builtin class-name">source</span> .bash_profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="winndow"><a href="#winndow" class="header-anchor">#</a> winndow</h4> <ol><li>Windows-installer.msi 官方安装包，快速开始，推荐使用</li> <li>nvm-windows windows版本的nvm，社区维护不稳定</li> <li>Cmder 集成命令行工具 （推荐）</li> <li>WSL Window提供的内置Linux运行环境，配合VSCode （推荐）</li> <li>Windows Terminal</li></ol> <h3 id="_1-1-2-node版本选择"><a href="#_1-1-2-node版本选择" class="header-anchor">#</a> 1.1.2 node版本选择</h3> <p>LTS是稳定版本，Current最新版本</p> <h3 id="_1-1-3-nodejs模块机制及包管理器"><a href="#_1-1-3-nodejs模块机制及包管理器" class="header-anchor">#</a> 1.1.3 Nodejs模块机制及包管理器</h3> <h4 id="nodejs-模块机制"><a href="#nodejs-模块机制" class="header-anchor">#</a> nodejs 模块机制</h4> <ul><li>Node应用由模块组成，采用CJS/ESM模块规范来组织</li> <li>每个文件就是模块，有自己的作用域</li> <li>每个文件里面定义的变量、函数、类都是私有的，对其他文件不可见</li> <li>在Node中，模块的加载是运行时同步加载的</li> <li>模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了</li></ul> <h4 id="模块加载机制-require-export"><a href="#模块加载机制-require-export" class="header-anchor">#</a> 模块加载机制 require/export</h4> <p><img src="/assets/img/require.63088a5b.png" alt=""></p> <p>在一个文件<code>require</code>一个包的时候（const xx =require('xx')），node会看require里的路径类型，</p> <ol><li>如果是一个内置模块，就直接返回这个内置模块，例如：path、fs等。</li> <li>如果是相对路径或者绝对路径，node会先把相对路径转换成绝对路径，会在当前路径下查找是否有xx文件，如果存在就返回，如果没找到会把xx当作目录，在这个目录下查找index文件，找到就返回，没找到就Can't find。</li> <li>如果没有路径就是我们的第三方模块，根据所在的父模块确定安装目录，在目录中查找入口文件，这个入口文件就是index.js或main.js,bin下的文件，这个文件由package.json来指定。</li></ol> <p>在node处理模块加载的时候，还有缓存的概念，就是说缓存中存在了，就直接返回；内置模块直接加载；根据找到文件创建新的模块并缓存。</p> <h4 id="nodejs包管理器"><a href="#nodejs包管理器" class="header-anchor">#</a> nodejs包管理器</h4> <ul><li>npm 代指Node的模块生态，又代指模块安装CLI工具</li> <li>通过package.json来描述项目的基本配置信息和依赖，组成树状结构</li> <li>使用nvm管理node版本，使用nrm管理npm源，使用npx执行命令</li> <li>使用scripts组织工程化脚本入口</li></ul> <h3 id="_1-1-4-nodejs的能力"><a href="#_1-1-4-nodejs的能力" class="header-anchor">#</a> 1.1.4 Nodejs的能力</h3> <p><img src="/assets/img/nodeability.1343d4a4.png" alt=""></p> <h2 id="_1-2-nodejs提供的原生api能力-上"><a href="#_1-2-nodejs提供的原生api能力-上" class="header-anchor">#</a> 1.2 Nodejs提供的原生API能力（上）</h2> <h4 id="node架构"><a href="#node架构" class="header-anchor">#</a> node架构</h4> <p><img src="/assets/img/node-framework.ab79f1b5.png" alt=""></p> <h3 id="_1-2-1-了解nodejs提供的数据类型"><a href="#_1-2-1-了解nodejs提供的数据类型" class="header-anchor">#</a> 1.2.1 了解Nodejs提供的数据类型</h3> <h4 id="_1-nodejs数据类型-buffer"><a href="#_1-nodejs数据类型-buffer" class="header-anchor">#</a> 1. Nodejs数据类型-Buffer</h4> <ul><li>流式数据（非一次性加载完成的数据）由于产生和使用不一定同速，所以需要缓存</li> <li>存储需要临时占用大量内存的数据，内存中开辟的一片区域，用于存放二进制数据</li> <li>流的生产者与消费者之间的速度通常是不一致的，因此需要buffer来暂存一些数据</li> <li>buffer大小通过highWaterMark参数指定，默认情况下是16kb</li></ul> <p><img src="/assets/img/buffer.63dacdd4.png" alt=""></p> <p>🍅 创建buffer</p> <ul><li><p>Buffer.from(buffer | array | string) 使用堆外内存新增Buffer</p></li> <li><p>Buffer.from(arrayBuffer) 浅拷贝arrayBuffer，共享内存</p></li> <li><p>Buffer.alloc(size) 分配一个指定大小的Buffer,默认值0，使用UTF-8编码</p></li> <li><p>Buffer.allocUnsafe(size) 分配一个初始化的Buffer</p></li> <li><p>流式数据会自动创建Buffer，手动创建Buffer需谨慎</p></li></ul> <p>🍅 创建Buffer-坑</p> <ul><li><p>预分配一个内部的大小为Buffer.poolSize(8k)的Buffer实例，作为快速分配的内存池</p></li> <li><p>如果allocUnsafe/from(array)的size小于4k，则从预分配的池子中分配</p></li> <li><p>绕开V8回收机制，使用专用回收机制，提高性能和内存使用效率</p></li> <li><p>但这种玩法会导致未初始化的数据块投入使用，造成数据泄露风险</p></li></ul> <p>🍅  使用Buffer</p> <ul><li><p>转换格式</p> <ul><li>字符串：编码Buffer.from(string),解码buf.toString()</li> <li>JSON:buf.JSON()</li></ul></li> <li><p>剪裁和拼接</p> <ul><li>剪裁：Buffer.slice()表现与Array.slice()不同，返回Buffer与原buf共享内存</li> <li>拼接：buf.copy/buf.concat 返回新的Buffer</li></ul></li> <li><p>比较和遍历索引</p> <ul><li>判断相等：buf1.equals(buf2) 比较的是二进制的值</li> <li>索引：使用buf[index]形式进行索引，for...of/indexOf/includes等Array方法也可以使用</li></ul></li></ul> <h4 id="_2-nodejs数据类型-stream"><a href="#_2-nodejs数据类型-stream" class="header-anchor">#</a> 2. Nodejs数据类型-Stream</h4> <ul><li>Stream 模块提供的是抽象接口，有很多模块实现了这个接口</li> <li>Stream 就是解决生产者和消费者问题的一种方式，解决异步IO问题</li> <li>Stream 模块对于流的使用者而言无需关心 readableSrc.pipe(writableDest)</li></ul> <p><img src="/assets/img/buffer.63dacdd4.png" alt=""></p> <h4 id="_3-nodejs数据类型-event-eventemitter"><a href="#_3-nodejs数据类型-event-eventemitter" class="header-anchor">#</a> 3. Nodejs数据类型-event/EventEmitter</h4> <p><img src="/assets/img/eventEmitter.4d0be828.png" alt=""></p> <p>event只提供了EventEmitter一个对象，相当于事件触发，会触发很多事件，触发事件会进入EventLoop，一旦触发会被Event handlers捕获。
EventEmitter的核心就是事件触发的Emitter，事件监听的on功能进行封装，一个简单的EventEmitter绑定一个监听器，然后去监听事件。</p> <h4 id="_4-nodejs数据类型-error"><a href="#_4-nodejs数据类型-error" class="header-anchor">#</a> 4. Nodejs数据类型-Error</h4> <p>🍅 错误类型</p> <ul><li>标准的javascript错误，比如：SyntaxError/ReferenceError</li> <li>底层操作触发的系统错误，比如：文件读写</li> <li>用户自定义错误</li> <li>异常逻辑触发的AssertionError，通常来自assert模块</li></ul> <p>🍅 错误冒泡和捕获</p> <ul><li>所有通过Node.j或javaScript运行时抛出的异常都是Error实例</li> <li>大多数的异步方法接受一个callback函数，该函数会接受一个Error对象传入作为第一个参数</li></ul> <h4 id="_5-nodejs数据类型-url"><a href="#_5-nodejs数据类型-url" class="header-anchor">#</a> 5. Nodejs数据类型-URL</h4> <ul><li>弃用urlObjects，该用WHATWG URL</li> <li>使用URLSearchParams操作参数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">//  案例：截取params1和params2=2  https://hejialianghe.github.io?params1=1&amp;params2=2</span>
 <span class="token comment">// 1.截取url上的参数（老方法）</span>
  <span class="token keyword">const</span> _query<span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>query
  <span class="token comment">// _query 拿到的是params1=1&amp;params2=2，url.parse(req.url).pathname，可以拿到https://hejialianghe.github.io?</span>
  Querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>_query<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'params1'</span><span class="token punctuation">]</span>
  <span class="token comment">// 2.使用URLSearchParams操作参数</span>
  Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>_query<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// {params1:1,params2:2} </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_6-nodejs数据类型-global"><a href="#_6-nodejs数据类型-global" class="header-anchor">#</a> 6. Nodejs数据类型-global</h4> <ul><li>看上去像是全局变量的存在，实际上仅存在于模块的作用域中</li></ul> <p><code>__dirname、__filename、exports、module、require()</code></p> <ul><li>从javaScript继承而来的全局变量</li></ul> <p><code>console、timer全家桶、global（容器）</code></p> <ul><li>Nodejs特有的全局变量</li></ul> <p><code>Buffer、process、URL、WepASSembly</code></p> <p>这些可以不用太深入，至少有这个概念，node架构最底层的数据类型，其实有这些数据类型，在上层去实现复杂的业务逻辑的时候；就可以调用这些数据类型，这是node帮我们封装好的；不用在再去造轮子。</p> <h3 id="_1-2-2-nodejs-工具库"><a href="#_1-2-2-nodejs-工具库" class="header-anchor">#</a> 1.2.2 Nodejs 工具库</h3> <h4 id="nodejs工具库-util"><a href="#nodejs工具库-util" class="header-anchor">#</a> Nodejs工具库-util</h4> <p>本是内置模块开发时的公共工具集，现在开放给开发者使用</p> <p>🍅 风格转换</p> <ul><li>promisify&lt;=&gt;callbackify、TextEncoder&lt;=&gt;TextDecoder</li></ul> <p>🍅 调试工具</p> <ul><li>debuglog、inspect、format、getSystemErrorName</li></ul> <p>🍅 类型判断</p> <ul><li>types.isDate(value)</li></ul> <h4 id="nodejs断言等价-assert"><a href="#nodejs断言等价-assert" class="header-anchor">#</a> Nodejs断言等价-assert</h4> <p>内置断言库，需要配合测试框架使用，主动抛出AssertionError错误</p> <p>🍅 断言真假</p> <ul><li>assert(value,msg),match(string,reg)</li></ul> <p>🍅 断言等价</p> <ul><li>strictEqual/deepStrictEqual以及相反操作equal/deepEqual弃用</li></ul> <p>🍅 断言成功失败</p> <ul><li>fail/throws doesNotThrow/ifError/rejects</li></ul> <h4 id="nodejs工具库-querystring"><a href="#nodejs工具库-querystring" class="header-anchor">#</a> Nodejs工具库-querystring</h4> <p>官方提供的解析和格式化URL查询字符串的实用工具</p> <ul><li><p>查询字符串转键值对 querystring.parse(str[,sep[eq[,options]]])</p></li> <li><p>键值对转查询字符串 querystring.stringify(obj)</p></li></ul> <h3 id="_1-2-3-nodejs的文件操作能力"><a href="#_1-2-3-nodejs的文件操作能力" class="header-anchor">#</a> 1.2.3 Nodejs的文件操作能力</h3> <h4 id="nodejs的文件操作能力-os"><a href="#nodejs的文件操作能力-os" class="header-anchor">#</a> Nodejs的文件操作能力-os</h4> <ul><li><p>os模块提供了与操作系统相关的实用方法和属性</p></li> <li><p>通过兼容的方式调用不同平台的底层命令，形成系统快照</p> <p><code>cpus、platform、type、uptime、userInfo</code></p></li> <li><p>定义操作系统级别的枚举常量</p></li></ul> <p><code>信号常量SIG*、错误常量E*、windows特有WSA*、优先级PRIORITY_*</code></p> <h4 id="nodejs的文件操作能力-fs"><a href="#nodejs的文件操作能力-fs" class="header-anchor">#</a> Nodejs的文件操作能力-fs</h4> <ul><li>fs模块模拟Linux环境，提供了用于与文件系统进行交互的API</li> <li>所有的文件系统操作都具有同步和异步的形式</li> <li>URI作为特殊的文件也可以被fs模块实用</li> <li>操作文件夹
<ul><li>mkdir/rmdir</li></ul></li> <li>操作文件
<ul><li>chmod/open/read/write</li></ul></li></ul> <h3 id="_1-2-4-nodejs的文件操作能力"><a href="#_1-2-4-nodejs的文件操作能力" class="header-anchor">#</a> 1.2.4 Nodejs的文件操作能力</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/learn/Server-side/Express_Nodejs" target="_blank" rel="noopener noreferrer">MDN 中提供的 Nodejs 课程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://nodejs.cn/" target="_blank" rel="noopener noreferrer">Nodejs中文文档站点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/5d4fb52c518825219c281bd1" target="_blank" rel="noopener noreferrer">Nodejs安装详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/sindresorhus/awesome-nodejs" target="_blank" rel="noopener noreferrer">Nodejs优秀项目集合<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_1-3-nodejs提供的原生api能力-下"><a href="#_1-3-nodejs提供的原生api能力-下" class="header-anchor">#</a> 1.3 Nodejs提供的原生API能力（下）</h2> <h3 id="_1-3-1-nodejs的模块机制及原理"><a href="#_1-3-1-nodejs的模块机制及原理" class="header-anchor">#</a> 1.3.1 Nodejs的模块机制及原理</h3> <h4 id="nodejs的模块机制-commonjs"><a href="#nodejs的模块机制-commonjs" class="header-anchor">#</a> Nodejs的模块机制-CommonJS</h4> <ul><li>模块引用</li></ul> <p>通过require（module）来引入module</p> <ul><li>模块定义</li></ul> <p>通过挂载在module.exports对象上实现定义</p> <ul><li>模块标识</li></ul> <p>通过路径标识引入的是哪个模块</p> <p>在node引入一个模块会经历下面这4个阶段</p> <p><img src="/assets/img/moduleme.6e0827b0.png" alt=""></p> <h4 id="路径分析"><a href="#路径分析" class="header-anchor">#</a> 路径分析</h4> <ul><li><p>内置模块</p></li> <li><p>在Node进程开始的时候就预加载了</p></li> <li><p>加载的是二进制文件，需要定位和编译</p></li> <li><p>文件模块</p></li> <li><p>通过NPM安装的第三方模块</p></li> <li><p>本地模块</p></li> <li><p>模块内容</p></li> <li><p>函数、对象或者属性，如函数、数组甚至任意类型的JS对象</p></li></ul> <h4 id="模块加载优先级"><a href="#模块加载优先级" class="header-anchor">#</a> 模块加载优先级</h4> <p><img src="/assets/img/modulepriority.603de0d7.png" alt=""></p> <h4 id="模块文件定位"><a href="#模块文件定位" class="header-anchor">#</a> 模块文件定位</h4> <p><img src="/assets/img/moduleLocation.9c7a1713.png" alt=""></p> <h4 id="编译模块执行"><a href="#编译模块执行" class="header-anchor">#</a> 编译模块执行</h4> <ul><li><p>.js 文件：</p> <ul><li>通过fs模块同步读取后编译执行，未识别类型也会当作js处理</li></ul></li> <li><p>.json 文件：</p> <ul><li>通过fs模块同步读取后，用JSON.parse()解析并返回结果</li></ul></li> <li><p>.node 文件：</p> <ul><li>这是用C/C++写的扩展文件，通过process.dlopen()方法加载最后编译生成的</li></ul></li></ul> <h4 id="模块js文件的编译"><a href="#模块js文件的编译" class="header-anchor">#</a> 模块js文件的编译</h4> <ul><li>注入全局变量
<ul><li>以参数形式，注入module/exports/require方法</li> <li>同时注入路径解析时得到的__filename/__dirname</li></ul></li> <li>构造上下文执行环境
<ul><li>闭包产生作用域，通过runlnThisContext()执行</li> <li>将function对象挂载到exports对象上，并导出</li></ul></li></ul> <h4 id="加入缓存以及清除缓存"><a href="#加入缓存以及清除缓存" class="header-anchor">#</a> 加入缓存以及清除缓存</h4> <ul><li><p>核心模块</p> <ul><li>登记在NativeModeule._cache上</li></ul></li> <li><p>文件模块</p> <ul><li>封装后的方法以字符串形式存储，等待调用</li></ul></li> <li><p>清除缓存</p> <ul><li>通过delete require.catch[require.resolove(module)]</li></ul></li></ul> <h4 id="import-vs-require"><a href="#import-vs-require" class="header-anchor">#</a> import vs require</h4> <ul><li><p>import</p> <ul><li>ES6规范</li> <li>静态加载模块</li> <li>编译的时候执行代码</li> <li>缓存执行结果</li> <li>按需引入，节省内存</li></ul></li> <li><p>require</p> <ul><li>commonJS规范</li> <li>动态加载模块</li> <li>调用的时候加载源码</li> <li>加载全部代码</li></ul> <h3 id="_1-3-2-nodejs的网络编程能力"><a href="#_1-3-2-nodejs的网络编程能力" class="header-anchor">#</a> 1.3.2 Nodejs的网络编程能力</h3> <h4 id="网络模型-osi-tcp-ip"><a href="#网络模型-osi-tcp-ip" class="header-anchor">#</a> 网络模型 OSI &amp; TCP/IP</h4></li></ul> <p><img src="/assets/img/networkmodel.6dfd0c0e.png" alt=""></p> <h4 id="soket"><a href="#soket" class="header-anchor">#</a> Soket</h4> <ul><li>实现底层通信，几乎所有的应用层都是通过socket进行通信</li> <li>对TCP/IP协议进行封装，向应用层协议暴露接口调用</li> <li>TCP/IP协议中，传输层存在两种通用协议：TCP、UDP</li> <li>两种协议不同，因为不同参数的socket实现过程也不一样</li></ul> <h4 id="nodejs网络基础模块-net-dgram"><a href="#nodejs网络基础模块-net-dgram" class="header-anchor">#</a> Nodejs网络基础模块-net/dgram</h4> <ul><li>net 模块是TCP/IP的Node实现，提供一些用于底层的网络通信的小工具</li> <li>http.Server 继承自net.Server</li> <li>http 客户端与http服务端的通信均依赖与socket（net.Socket）
<ul><li>net.Server: TCP server,内部通过socket来实现与客户端的通信</li> <li>net.Socket: 本地socket与node版实现，它实现了全双工的stream接口</li></ul></li></ul> <h4 id="nodejs网络基础模块-net-socket"><a href="#nodejs网络基础模块-net-socket" class="header-anchor">#</a> Nodejs网络基础模块-net.Socket</h4> <ul><li><p>net.Socket 对象是TCP或UNIX Socket 的抽象</p></li> <li><p>net.Socket 实例实现了一个双工流接口</p></li> <li><p>API归纳</p> <ul><li>连接相关connect</li> <li>数据读写 write</li> <li>数据属性 bufferSize</li> <li>地址相关 address</li></ul></li></ul> <h4 id="nodejs网络基础模块-http-https-http2"><a href="#nodejs网络基础模块-http-https-http2" class="header-anchor">#</a> Nodejs网络基础模块-http/https/http2</h4> <ul><li>Http模块是Node的门脸，是编写Web Server最常见的模块</li> <li>Server部分继承自net.Server,并对请求和响应数据进行封装</li> <li>也提供了request/get的能力，允许向其他服务端发起HTTP请求</li> <li>Node封装了HTTPS/HTTP2的实现，可以轻松创建类HTTP服务</li></ul> <h3 id="_1-3-3-的进程管理"><a href="#_1-3-3-的进程管理" class="header-anchor">#</a> 1.3.3 的进程管理</h3> <h4 id="操作系统的进程和线层"><a href="#操作系统的进程和线层" class="header-anchor">#</a> 操作系统的进程和线层</h4> <ul><li>运行任务的程序叫做“进程”，一个进程只能执行一个任务</li> <li>进程并发：以多进程形式，允许多个任务同时运行</li> <li>线层并发：以多线程形式，允许单个任务分成不同的部分运行</li> <li>操作系统提供协调机制，防止冲突，共享资源</li> <li>javascript是单线层语言，所以多个任务只能排队运行</li></ul> <h4 id="多进程vs多线程"><a href="#多进程vs多线程" class="header-anchor">#</a> 多进程vs多线程</h4> <table><thead><tr><th style="text-align:center;">维度</th> <th style="text-align:center;">多进程</th> <th style="text-align:center;">多线程</th> <th style="text-align:center;">比较</th></tr></thead> <tbody><tr><td style="text-align:center;">数据共享</td> <td style="text-align:center;">数据共享复杂，需要用IPC；数据是分开的，同步简单</td> <td style="text-align:center;">因为共享进程数据，数据共享简单，同步复杂</td> <td style="text-align:center;">各有千秋</td></tr> <tr><td style="text-align:center;">资源利用</td> <td style="text-align:center;">占用内存，切换复杂，CPU利用率低</td> <td style="text-align:center;">占用内存少，切换简单，cpu利用高</td> <td style="text-align:center;">多线程更好</td></tr> <tr><td style="text-align:center;">性能开销</td> <td style="text-align:center;">创建销毁、切换复杂、速度慢</td> <td style="text-align:center;">创建销毁、切换简单、速度很快</td> <td style="text-align:center;">多线程更好</td></tr> <tr><td style="text-align:center;">编码实践</td> <td style="text-align:center;">编码简单、调试方便</td> <td style="text-align:center;">编码、调试复杂</td> <td style="text-align:center;">多进程更好</td></tr> <tr><td style="text-align:center;">可靠性</td> <td style="text-align:center;">进程独立运行，不会相互影响</td> <td style="text-align:center;">线程呼吸共命运</td> <td style="text-align:center;">多进程更好</td></tr> <tr><td style="text-align:center;">分布式支持</td> <td style="text-align:center;">可用于多机多核分布式，易于扩展</td> <td style="text-align:center;">只能用于多核分布式</td> <td style="text-align:center;">多进程更好</td></tr></tbody></table> <h4 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> Event Loop</h4> <ul><li>javascript通过EventLoop的形式解决单线程任务调度问题</li> <li>EventLoop是一个程序结构，用于等待和发送消息和事件</li> <li>浏览器的Event loop和Node的Event loop是两个概念</li></ul> <h4 id="浏览器的event-loop"><a href="#浏览器的event-loop" class="header-anchor">#</a> 浏览器的Event Loop</h4> <p><img src="/assets/img/browserEventloop.fddfb26d.png" alt=""></p> <h4 id="nodejs-event-loop"><a href="#nodejs-event-loop" class="header-anchor">#</a> Nodejs-Event Loop</h4> <p><img src="/assets/img/nodeventloop.e925202b.png" alt=""></p> <p>node采用v8作为js解析引擎，io处理方面用到了自己的LIBUV，LIBUV是跨平台的抽象层，封装了不同平台的底层特性，对外提供了统一的api；事件循环机制也是它里面实现的，所以v8引擎解析js脚本，解析后的代码调用nodeAPI；LIBUV库负责nodeAPI的执行，将不同的任务分配给不同的线程形成一个Eventloop，将不同的任务分配给不同的线程，以异步的形式将结果返回给v8，v8在将结果返回给用户；LIBUV引擎分为6个阶段，它会按照顺序反复执行，每当
进入某个阶段的时候，都会从对应的回调队列中抽取函数去执行，当队列为空或回调函数达到系统设置的值的时候，就会进入下一个阶段</p> <h4 id="nodejs进程-process"><a href="#nodejs进程-process" class="header-anchor">#</a> Nodejs进程-process</h4> <ul><li>Process是一个全局的对象，无需require直接使用，提供进程描述</li> <li>process对象是EventEmiter的实例，暴露了进程事件的钩子
<ul><li>exit 监听进程退出</li> <li>uncaughException 监听异常</li></ul></li> <li>提供标准的输出，对应的是进程的I/O操作
<ul><li>node版本的console底层是由stdio实现的</li> <li>数据流与其他双工数据流不同，同步写会阻塞进程导致性能开销</li></ul></li></ul> <h4 id="nodejs进程创建-child-process-子进程-cluster"><a href="#nodejs进程创建-child-process-子进程-cluster" class="header-anchor">#</a> Nodejs进程创建-child_process(子进程)/cluster</h4> <ul><li><p>child_process 是 Node.js的内置模块</p> <ul><li>spawn：适用于返回大量数据，例如图像处理，二进制数据处理</li> <li>exec：适用于小量数据，maxBuffer默认值为200*1024超出崩溃</li> <li>fork：衍生新的进程，进程之间是相互独立的，每个进程独立</li></ul></li> <li><p>cluster 是Node.js 的内置模块</p> <ul><li>Worker 对象包含了关于工作进程的所有公共的信息和方法</li> <li>fork：衍生新的进程，进程之间是相互独立的，每个进程独立</li> <li>使用主从模型轮询处理服务的负载任务，通过IPC通信</li></ul></li></ul> <h4 id="进程守护"><a href="#进程守护" class="header-anchor">#</a> 进程守护</h4> <p>pm2</p> <h3 id="_1-3-4-扩展资料"><a href="#_1-3-4-扩展资料" class="header-anchor">#</a> 1.3.4 扩展资料</h3> <p><a href="https://blog.fundebug.com/2019/01/15/diffrences-of-browser-and-node-in-event-loop/" target="_blank" rel="noopener noreferrer">浏览器与Node的事件循环(Event Loop)有何区别?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://itbilu.com/nodejs/core/N1tv0Pgd-.html" target="_blank" rel="noopener noreferrer">Nodejs原生模块整理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/entry/5b4b5081e51d451984696cb7" target="_blank" rel="noopener noreferrer">Nodejs中的模块机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/5d43017be51d4561f40adcf9" target="_blank" rel="noopener noreferrer">深入理解Nodejs中的进程与线程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://nodejs.cn/" target="_blank" rel="noopener noreferrer">Nodejs中文文档站点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_1-4-nodejs原生web-server实战"><a href="#_1-4-nodejs原生web-server实战" class="header-anchor">#</a> 1.4 Nodejs原生Web Server实战</h2> <h3 id="_1-4-1-web-server的构成"><a href="#_1-4-1-web-server的构成" class="header-anchor">#</a> 1.4.1 Web Server的构成</h3> <ul><li>处理HTTP：对HTTP的动词（GET/POST/PUT）进行响应</li> <li>路由管理：分别处理不同URL路径的请求，返回对应的网络资源</li> <li>静态文件托管：对网络请求的静态资源进行响应或使用模版动态响应请求</li> <li>文件数据存储：将请求携带的数据存储到文件或则数据库中</li></ul> <h4 id="web-server的基本架构"><a href="#web-server的基本架构" class="header-anchor">#</a> Web Server的基本架构</h4> <p><img src="/assets/img/baseFramework.9cbb930f.png" alt=""></p> <h3 id="_1-4-2-web-server的优势"><a href="#_1-4-2-web-server的优势" class="header-anchor">#</a> 1.4.2 Web Server的优势</h3> <ul><li><p>并发性能优势</p> <p>基于事件驱动的服务在响应请求的场景中有极高的并发性能表现</p></li> <li><p>javascript</p></li></ul> <p>减少学习成本，使用最流行的javascript或其他可编译/转换为javascript的语言均可实现</p> <ul><li>生态活跃完善</li></ul> <p>npm提供了数十万个可重用的工具包，它还提供了一流的依赖解决方案，可实现自动化工具链构建</p> <ul><li>代码可移植</li></ul> <p>兼容各种操作系统运行环境，一份代码可以运行在多种环境中</p> <ul><li>框架高度包容</li></ul> <p>Node及Node的Web框架都拥有天然的包容性，易于扩展和维护</p> <ul><li>友好的社区氛围</li></ul> <p>丰富的生态诞生了大量的开源社区，聚集了众多优秀的开发人员</p> <h3 id="_1-4-3-web-server的最小系统"><a href="#_1-4-3-web-server的最小系统" class="header-anchor">#</a> 1.4.3 Web Server的最小系统</h3> <h4 id="_1-一个简单的http服务"><a href="#_1-一个简单的http服务" class="header-anchor">#</a> 1. 一个简单的http服务</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">var</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li><p>执行 <code>node index.js</code>运行，浏览器访问<code>http://localhost:1000/</code>,</p></li> <li><p>也可以下载包<code>nodemon</code>运行，全局安装的话，运行方式<code>nodemon index.js</code>;局部安装的话用npx运行<code>npx nodemon index.js</code>;也可以在package.json里配置<code>script</code>运行，<code>&quot;dev&quot;: &quot;nodemon index.js&quot;</code></p></li></ol> <h4 id="_2-实现路由处理和静态资源托管"><a href="#_2-实现路由处理和静态资源托管" class="header-anchor">#</a> 2. 实现路由处理和静态资源托管</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// 404处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">noFound</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'404.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token string">'no found'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// res.writeHead(200,{'Content-type':&quot;text/html;charset='utf-8'&quot;})</span>
            res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token operator">:</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 1.路由处理</span>
    <span class="token comment">// 2.静态资源托管</span>

    <span class="token comment">// url.parse解析后会返回一个url对象，pathname是什么？</span>
    <span class="token comment">// 例如：http://nodejs.cn/api/url.html#url_u，pathname是指/api/url.html#url_u</span>
    <span class="token keyword">var</span> pathName<span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname
    <span class="token keyword">if</span><span class="token punctuation">(</span>pathName <span class="token operator">===</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        pathName<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// extname返回扩展名，就是.后面的,如果没有.就返回空字符串</span>
    <span class="token keyword">const</span> extName<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>pathName<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>extName <span class="token operator">===</span> <span class="token string">'.html'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pathName<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">noFound</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token operator">:</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="_3-实现http-verb-和-store"><a href="#_3-实现http-verb-和-store" class="header-anchor">#</a> 3. 实现http verb 和 store</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 源文档：examples/node/1.4/mini_node</span>
<span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> qs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'qs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">writeDb</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">thunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'db'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>thunk<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据已被追加到文件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 3.HTTP verb</span>
    <span class="token comment">// 4. store</span>
    <span class="token comment">// url.parse解析后会返回一个url对象，pathname是什么？</span>
    <span class="token comment">// 例如：http://nodejs.cn/api/url.html#url_u，pathname是指/api/url.html#url_u</span>
    <span class="token keyword">var</span> pathName<span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname

    <span class="token keyword">if</span><span class="token punctuation">(</span>pathName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> method<span class="token operator">=</span>req<span class="token punctuation">.</span>method
        <span class="token keyword">if</span><span class="token punctuation">(</span>method<span class="token operator">===</span><span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> query<span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>query<span class="token punctuation">)</span>
            <span class="token keyword">const</span> resData <span class="token operator">=</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span>query<span class="token punctuation">,</span>
                msg<span class="token operator">:</span><span class="token string">'sucess'</span>
            <span class="token punctuation">}</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>resData<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>method<span class="token operator">===</span><span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> contentType<span class="token operator">=</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span>
            
            <span class="token keyword">if</span><span class="token punctuation">(</span>contentType<span class="token operator">===</span>  <span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> postData<span class="token operator">=</span><span class="token string">''</span>
                req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">thunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    postData<span class="token operator">+=</span>thunk
                    <span class="token function">writeDb</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">thunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        code<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
                        data<span class="token operator">:</span>postData<span class="token punctuation">,</span>
                        msg<span class="token operator">:</span><span class="token string">'sucess'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="_1-4-3-扩展"><a href="#_1-4-3-扩展" class="header-anchor">#</a> 1.4.3 扩展</h3> <p><a href="http://nodejs.cn/api/http.html" target="_blank" rel="noopener noreferrer">Nodejs官网 http模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/5d5277a7f265da03cd0a74a7" target="_blank" rel="noopener noreferrer">Node.js超详细零基础教程(1)—处理GET、POST请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/5b75739ee51d45554762288e" target="_blank" rel="noopener noreferrer">尝试手写一个 nodejs http-server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_1-5-使用express搭建web-server"><a href="#_1-5-使用express搭建web-server" class="header-anchor">#</a> 1.5 使用Express搭建Web server</h2> <h3 id="_1-5-1-express-框架概览"><a href="#_1-5-1-express-框架概览" class="header-anchor">#</a> 1.5.1 Express 框架概览</h3> <ul><li>高度包容，快速而简单的Node.js Web框架</li> <li>拥有稳定可靠丰富的社区和中间件生态</li> <li>易于学习，可定制程度高，开箱即用</li> <li>精巧的Express为Web和移动应用程序提供了一组强大的功能</li></ul> <h3 id="_1-5-2-express的能力"><a href="#_1-5-2-express的能力" class="header-anchor">#</a> 1.5.2 Express的能力</h3> <ul><li>封装http模块，方便地创建Web应用</li> <li>通过中间件机制实现可扩展性</li> <li>提供路由机制，便于组织业务应用</li> <li>提供多种模版引擎，支持了静态文件的渲染和托管</li> <li>便于添加错误处理，方便对系统进行容错处理</li> <li>便于添加数据库连接，操作数据库数据</li></ul> <h4 id="express中间件"><a href="#express中间件" class="header-anchor">#</a> Express中间件</h4> <ul><li><p>路由和中间件是Express的基础，路由是特殊的中间件</p></li> <li><p>Express是一系列中间件函数调用的过程</p></li> <li><p>中间件是对处理过程的封装，输入请求对象/响应对象，通过next进入下一个中间件处理过程</p></li> <li><p>使用app.use()将中间件注册到应用实例上，路由中间件注册到路由实例上</p></li></ul> <p><img src="/assets/img/routerMiddle.c7fe5f02.png" alt=""></p> <h4 id="编写express中间件"><a href="#编写express中间件" class="header-anchor">#</a> 编写Express中间件</h4> <p><img src="/assets/img/writeMiddle.fb581c4f.png" alt=""></p> <h4 id="express-路由机制"><a href="#express-路由机制" class="header-anchor">#</a> Express 路由机制</h4> <ul><li><p>路由是一段Express代码，它将http动词、URL路径/模式和处理函数三者关联起来</p></li> <li><p>Express的应用程序设计要从路由设计入手，将服务的能力描述起来</p></li> <li><p>还可以使用Router中间件，实现路由逻辑模块化设计</p></li></ul> <p><img src="/assets/img/routingMe.536cb95f.png" alt=""></p> <h4 id="express-性能评估"><a href="#express-性能评估" class="header-anchor">#</a> Express 性能评估</h4> <p><img src="/assets/img/preform.0709148c.png" alt=""></p> <h4 id="express-最佳实践"><a href="#express-最佳实践" class="header-anchor">#</a> Express 最佳实践</h4> <ul><li><p>使用中间件压缩响应数据，在反向代理层做最佳</p></li> <li><p>避免在业务逻辑处理中使用同步阻塞操作</p></li> <li><p>引入完善的基建保障，记录日志，处理异常</p></li> <li><p>需要重启的时候立即重启，保证程序可以自动重启启动</p></li></ul> <h3 id="_1-5-3-express-web-server实战"><a href="#_1-5-3-express-web-server实战" class="header-anchor">#</a> 1.5.3 Express Web Server实战</h3> <ul><li>实现一个可以生成邮件的模版管理系统</li> <li>有配置界面，可以沉淀业务域中的邮件模版，可以新增模版</li> <li>可以预览最终的邮件样式</li></ul> <p><img src="/assets/img/requirement.3042761f.png" alt=""></p> <h4 id="邮件模版系统-功能设计"><a href="#邮件模版系统-功能设计" class="header-anchor">#</a> 邮件模版系统-功能设计</h4> <p><img src="/assets/img/fundesign.f9767f3b.png" alt=""></p> <h3 id="_1-5-4扩展学习"><a href="#_1-5-4扩展学习" class="header-anchor">#</a> 1.5.4扩展学习</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/learn/Server-side/Express_Nodejs/Introduction" target="_blank" rel="noopener noreferrer">MDN 中提供的 Express 课程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://cythilya.github.io/2014/11/23/nodejs-express-microblog/" target="_blank" rel="noopener noreferrer">使用 Node.js + Express 搭建一个简单的微博网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://zhuanlan.zhihu.com/p/56947560" target="_blank" rel="noopener noreferrer">NodeJS express框架核心原理全揭秘<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_1-6-使用nodejs编写-restful-api"><a href="#_1-6-使用nodejs编写-restful-api" class="header-anchor">#</a> 1.6 使用Nodejs编写 RESTful API</h2> <h3 id="_1-6-1-restful-api"><a href="#_1-6-1-restful-api" class="header-anchor">#</a> 1.6.1 RESTful API</h3> <p>rest是暴露服务端资源的一种约定方式，同时提供获取这种资源的动词，基于rest架构的web server api，我们就称为RESTful API。</p> <h4 id="rest概念"><a href="#rest概念" class="header-anchor">#</a> REST概念</h4> <ul><li>URI资源定位</li></ul> <p>REST是面向资源，而资源通过URI进行暴露</p> <ul><li>链接资源状态</li></ul> <p>服务器生成包含状态转移的表征数据，用来响应客户端对一个资源的请求，客户端可据此了解状态转移的方式</p> <ul><li>使用HTTP已有特性</li></ul> <p>REST很用利用了HTTP本身的一些特性，如HTTTP动词、HTTP状态码、HTTP头部信息</p> <ul><li>统一资源规范</li></ul> <p>包含一组受限的预定义的操作，资源都通过使用项目接口进行资源的访问</p> <h4 id="充分利用http描述uri资源"><a href="#充分利用http描述uri资源" class="header-anchor">#</a> 充分利用HTTP描述URI资源</h4> <p><img src="/assets/img/httpres.b613a7c1.png" alt=""></p> <h3 id="_1-6-2-rest-工程实践"><a href="#_1-6-2-rest-工程实践" class="header-anchor">#</a> 1.6.2 REST 工程实践</h3> <h3 id="rest-接口设计-路由"><a href="#rest-接口设计-路由" class="header-anchor">#</a> REST 接口设计-路由</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token comment">//接口要遵循http动词</span>
  <span class="token constant">GET</span> <span class="token operator">/</span>xhr<span class="token operator">/</span>v1<span class="token operator">/</span>templateList <span class="token comment">// 获取模版列表</span>
  <span class="token constant">GET</span> <span class="token operator">/</span>xhr<span class="token operator">/</span>v1<span class="token operator">/</span>templateDetail<span class="token operator">?</span>id<span class="token operator">=</span>xx   <span class="token comment">// 模版单个模版详情</span>
  <span class="token constant">POST</span> <span class="token operator">/</span>xhr<span class="token operator">/</span>v1<span class="token operator">/</span>templateCreate <span class="token comment">// 创建模版</span>
  <span class="token constant">PUT</span>  <span class="token operator">/</span>xhr<span class="token operator">/</span>v1<span class="token operator">/</span>templateChange<span class="token operator">/</span><span class="token number">1</span> <span class="token comment">// 修改模版,</span>
  <span class="token constant">DELETE</span> <span class="token operator">/</span>xhr<span class="token operator">/</span>v1<span class="token operator">/</span>templateDelate<span class="token operator">/</span><span class="token number">1</span> <span class="token comment">// 删除模版</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="数据表设计-封装数据服务"><a href="#数据表设计-封装数据服务" class="header-anchor">#</a> 数据表设计-封装数据服务</h3> <ul><li><p>选用MongoDB存储数据</p></li> <li><p>引用mongoose构建数据模型</p></li> <li><p>邮件模版Schema</p> <ul><li>id String 唯一识别邮件模版的id</li> <li>template text 可支持HTML</li> <li>data  邮件模版中填充的数据</li></ul> <h3 id="_1-6-3-rest-最佳实践"><a href="#_1-6-3-rest-最佳实践" class="header-anchor">#</a> 1.6.3 REST 最佳实践</h3></li> <li><p>充分理解并使用HTTP请求</p></li> <li><p>使用API测试工具而非浏览器测试你的API接口</p></li> <li><p>选择合适的文档生成工具，删除API文档</p></li> <li><p>REST只是规范并不强制，最合适团队的才是最好的</p></li> <li><p>找个实践REST较好的框架胜过自己造轮子</p></li></ul> <p>🍅 开始实战</p> <ol><li>项目结构</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> ├── server    
 │   ├──  middleware <span class="token comment"># 自己写的中间件；可以用于处理一些业务逻辑</span>
 │   ├──  model      <span class="token comment"># 数据模型，接口的数据模型</span>
 │   ├──  routes     <span class="token comment"># 接口的业务代码</span>
 │   ├── index.js    <span class="token comment"># 入口文件</span>
 └─ package.json     <span class="token comment"># 管理项目运行的依赖、及描述信息                                  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>下载所需要的依赖</li></ol> <p><code>yarn add express mongoose nodemon body-parser</code></p> <p>mongoose ：简化操作mongodb的库</p> <p>body-parser：处理post请求时返回thunk，它会自动帮我们加入res.body中</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>用nodemon启动项目，当我们保存时，nodemon会帮助我们启动项目
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon server/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>编写入口文件index.js</li></ol> <p>编写入口文件，需要连接数据库，这里我们使用mogodb，mongodb的安装教程在本文的最下面，当然会mysql，也可以用mysql。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bodyParser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mongoose<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> templateRouter<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/template'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 连接mongodb，temp是我们数据库的名称</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://127.0.0.1:27017/temp'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> db<span class="token operator">=</span>mongoose<span class="token punctuation">.</span>connection
db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 监听mogodb是否连接成功</span>
db<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 我们编写的中间件，提供$sucess和#error来处理返回的数据</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./middleware/index'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token comment">// 用bodyParser处理post请求，处理返回chunk</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    extended<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 我们的路由前缀/xhr/v1/，如果匹配在url中匹配到了/xhr/v1/，就会进入子路由templateRouter</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/xhr/v1/'</span><span class="token punctuation">,</span>templateRouter<span class="token punctuation">)</span>
<span class="token comment">// 前面都没有匹配到调用next()就会进入下一个中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Not Found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is running on http://localhost:2000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><ol start="4"><li>在model中编写数据模型</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 数据模型</span>
<span class="token keyword">const</span> mongoose<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> templateSchema<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span>String<span class="token punctuation">,</span>
    template<span class="token operator">:</span>String<span class="token punctuation">,</span>
    data<span class="token operator">:</span>String
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//第一个参数 当前模型名称，第二个参数 schema</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">,</span>templateSchema<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="5"><li>编写处理返回数据的中间件</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 处理错误的中间件</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function-variable function">$success</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>code<span class="token operator">=</span><span class="token number">200</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> _data <span class="token operator">=</span> <span class="token punctuation">{</span>
            code
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token operator">===</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            _data<span class="token punctuation">.</span>msg<span class="token operator">=</span><span class="token string">'sucess'</span>
            _data<span class="token punctuation">.</span>data<span class="token operator">=</span>data
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            _data<span class="token punctuation">.</span>msg<span class="token operator">=</span>data
        <span class="token punctuation">}</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>_data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function-variable function">$error</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>code<span class="token operator">=</span><span class="token number">500</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> _data <span class="token operator">=</span> <span class="token punctuation">{</span>
            code
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token operator">===</span><span class="token string">'objcet'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            _data<span class="token punctuation">.</span>msg<span class="token operator">=</span><span class="token string">'error'</span>
            _data<span class="token punctuation">.</span>data<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            _data<span class="token punctuation">.</span>msg<span class="token operator">=</span>err
        <span class="token punctuation">}</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>_data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="6"><li>在routes编写业务接口</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 路由模块，业务模块</span>
<span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router<span class="token operator">=</span>express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Template<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../model/template'</span><span class="token punctuation">)</span>

<span class="token comment">// 查询模版列表</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/templateList'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> temps<span class="token operator">=</span><span class="token keyword">await</span> Template<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>update_at<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span>temps<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建模版</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/templateCreate'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> temps <span class="token operator">=</span><span class="token keyword">await</span> Template<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span>temps<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询模版详情</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/templateDetail'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token operator">=</span>req<span class="token punctuation">.</span>query
    <span class="token keyword">const</span> temps <span class="token operator">=</span> <span class="token keyword">await</span> Template<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span>temps<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 更新模版</span>
router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/templateChange/:id'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token operator">=</span>req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> temps <span class="token operator">=</span> <span class="token keyword">await</span> Template<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span>temps<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 删除模版</span>
router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/templateDelate/:id'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token operator">=</span>req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> temps <span class="token operator">=</span> <span class="token keyword">await</span> Template<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span>temps<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><ol start="7"><li>其它</li></ol> <p>测试接口可以用postman</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>请求创建模版接口示例：http<span class="token operator">:</span><span class="token comment">//localhost:2000/xhr/v1/templateCreate</span>
在headers要加入Content-Type<span class="token operator">:</span>application/json
请求的参数：
<span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;template&quot;</span><span class="token operator">:</span><span class="token string">&quot;&lt;h1&gt;express&lt;h1&gt;&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token string">&quot;{name:'test1'}&quot;</span>
	
<span class="token punctuation">}</span>
返回的数据，其中_id是mongodb为我们创建的
<span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sucess&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5f2c19c81a53ff25e7d94953&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;h1&gt;express&lt;h1&gt;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{name:'test1'}&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;__v&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 源码地址</span>
 https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>hejialianghe<span class="token operator">/</span>Senior<span class="token operator">-</span>FrontEnd<span class="token operator">/</span>tree<span class="token operator">/</span>master<span class="token operator">/</span>examples<span class="token operator">/</span>node<span class="token operator">/</span><span class="token number">1.6</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>🍅 安装mongodb</p> <p><font color="red"><strong>window下安装mongodb</strong></font></p> <p><font color="blue"> 1. 下载安装</font></p> <p>传送门：https://www.mongodb.com/download-center/community</p> <p><font color="blue"> 2. 配置数据库数据存放目录和日志存放目录</font></p> <p>例如在D盘下创建数据目录</p> <p>mkdir D:\data\db</p> <p>创建日志目录</p> <p>mkdir D:\data\log</p> <p>数据和日志放哪都可以，不一定是D盘</p> <p><font color="blue"> 3. 配置mongod.cfg</font></p> <p>进入C盘C:\mongodb目录下创建mongod.cfg文件，并把以下内容复制进去</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>storage:
  dbPath:  D:<span class="token punctuation">\</span>data<span class="token punctuation">\</span>db
  journal:
    enabled: <span class="token boolean">true</span>
systemLog:
  destination: <span class="token function">file</span>
  logAppend: <span class="token boolean">true</span>
  path:  D:<span class="token punctuation">\</span>data<span class="token punctuation">\</span>log<span class="token punctuation">\</span>mongod.log
net:
  port: <span class="token number">27017</span>
  bindIp: <span class="token number">127.0</span>.0.1
<span class="token comment"># 权限验证,是否用密码连接数据库，开始不要设置密码，如果设置权限验证，就把#去掉</span>
<span class="token comment">#security:</span>
    <span class="token comment">#authorization: enabled</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><font color="blue"> 4. 安装mongodb服务</font></p> <p>在C:\mongodb\bin目录下打开shell，并执行以下命令</p> <p>mongod.exe --config &quot;C:\mongodb\mongod.cfg&quot; --install</p> <p>启动mongodb服务</p> <p>net start MongoDB</p> <p>如果执行成功，会输出以下信息</p> <p>2015-09-25T15:54:09.212+0800 I CONTROL  Hotfix KB2731284 or later update is notinstalled, will zero-out data files2015-09-25T15:54:09.229+0800 I JOURNAL  [initandlisten] journal dir=c:\data\db\j
ournal2015-09-25T15:54:09.237+0800 I JOURNAL  [initandlisten] recover : no journal fil
es present, no recovery needed2015-09-25T15:54:09.290+0800 I JOURNAL  [durability] Durability thread started2015-09-25T15:54:09.294+0800 I CONTROL  [initandlisten] MongoDB starting : pid=2488 port=27017 dbpath=c:\data\db 64-bit host=WIN-1VONBJOCE882015-09-25T15:54:09.296+0800 I CONTROL  [initandlisten] targetMinOS: Windows 7/W
indows Server 2008 R22015-09-25T15:54:09.298+0800 I CONTROL  [initandlisten] db version v3.0.6</p> <p><font color="blue"> 5. 其它指令</font></p> <p>net stop MongoDB //关闭MongoDB服务</p> <p>mongod.exe --remove  //移除 MongoDB 服务，要在C:\mongodb\bin目录下打开shel执行该命令或点击mongo.exe</p> <p>mongo.exe //进入mongodb管理后台，要在C:\mongodb\bin目录下打开shell执行该命令或点击mongo.exe</p> <p><font color="blue"> 6. window版数据库管理工具navicatmongodb</font></p> <p>链接: https://pan.baidu.com/s/14NYuD-rkG7p4YsX3UZgBOA 提取码: xeah</p> <p><font color="red"><strong>mac下安装mongodb（linux上同理）</strong></font></p> <p><font color="blue"> 1. mac下安装mongodb</font></p> <p>手动安装</p> <p>传送门：https://www.mongodb.com/download-center/community</p> <p>1.打开finder按shift+command+g 输入/usr/local 进入这个目录下</p> <p>2.在/usr/local下创建mongodb文件夹</p> <p>3.把下载好的包拖入/usr/local/mongodb目录下</p> <p>4打开命令行输入cd /usr/local/mongodb</p> <p>5.解压</p> <p>sudo tar zxvf mongodb-linux-x86_64-rhel70-4.2.0.tgz //解压，手动点击也可以</p> <p>6.修改文件名</p> <p>sudo mv mongodb-linux-x86_64-rhel70-4.2.0 mongodbserver  //修改文件名，手动修改也可以</p> <p><font color="blue"> 2. 创建data和log</font></p> <p>sudo mkdir data  //创建data文件</p> <p>sudo mkdir log  //创建log文件</p> <p><font color="blue"> 3. 在/usr/local/mongodb/目录下创建配置文件mongod.conf</font></p> <p>1.vim  /usr/local/mongodb/mongod.conf //编辑文件，命令行中执行</p> <p>2.输入i 进入输入模式</p> <p>3.把以下内容复制到mongod.conf文件里</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token assign-left variable">dbpath</span><span class="token operator">=</span>/usr/local/mongodb/data/  <span class="token comment">#数据存放路径 </span>
  <span class="token assign-left variable">logpath</span><span class="token operator">=</span>/usr/local/mongodb/log/mongodb.log <span class="token comment">#日志存放路径</span>
  <span class="token assign-left variable">fork</span><span class="token operator">=</span>true <span class="token comment">#后台运行 bind_ip=0.0.0.0 #允许任何IP进行连接 </span>
  <span class="token assign-left variable">auth</span><span class="token operator">=</span>false <span class="token comment">#true是要进行密码验证连接数据库，false不需要</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>4.按esc 进入编辑</p> <p>5.按 ：进入末尾</p> <p>6.按 wq 进行保存并退出</p> <p><font color="blue"> 4. 配置全局环境变量</font></p> <p>1.vim /etc/profile //进入编辑profile模式，命令行中执行</p> <p>2.把以下内容复制到profile中</p> <p>export PATH=$PATH:/usr/local/mongodb/mongodbserver/bin</p> <p>3.按esc 进入编辑,.按 ：进入末尾,按 wq 进行保存并退出</p> <p>4.source /etc/profile //重新加载,命令行中执行</p> <p><font color="blue"> 5. 启动mongodb</font></p> <p>mongod --config /usr/local/mongodb/mongod.conf //命令行中运行</p> <p>显示：child process started sucessfully，parent exiting 说明运行成功</p> <p>查看mongodb是否启动成功</p> <p>ps -ef | grep mongodb</p> <p>ps -axu |grep mongo  获取进程号</p> <p><font color="blue"> 6. 创建数据库</font></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mongo <span class="token comment"># 连接数据库</span>
use temp <span class="token comment">#temp就是我们创建的数据库，用show dbs 查看数据库是不显示的，因为里面没有数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><font color="blue"> 7. 其他指令</font></p> <p>mongorestore -h 127.0.0.1:27017 -d testdata --drop /home/data/  // 导入数据，testdata是数据库的名称，/home/data/是老数据存放地址</p> <p>mongod --shutdown --dbpath  /usr/local/mongodb/data/ //关掉服务</p> <p>数据库用户及权限管理</p> <p>提示：如果想进行账号密码连接数据库，请看1，2，3，4，,5设置密码后请修改</p> <p>mongodb.conf 里的配置项auth=true</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1.</span>mongo <span class="token comment">//命令行输入</span>

<span class="token number">2.</span>use admin <span class="token comment">//进入admin</span>

<span class="token number">3.</span>db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>user<span class="token operator">:</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>pwd<span class="token operator">:</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>roles<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span><span class="token string">&quot;userAdminAnyDatabase&quot;</span><span class="token punctuation">,</span>db<span class="token operator">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建超级管理员</span>

<span class="token number">4.</span>use testdata <span class="token comment">//进入testdata数据库</span>

<span class="token number">5.</span>db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>user<span class="token operator">:</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>pwd<span class="token operator">:</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>roles<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span><span class="token string">&quot;readWrite&quot;</span><span class="token punctuation">,</span>db<span class="token operator">:</span><span class="token string">&quot;testdata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//建立testdata数据库管理员</span>

db<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span> <span class="token comment">//创建完成后可以进行管理员验证，看是否设置成功</span>

db<span class="token punctuation">.</span><span class="token function">changeUserPassword</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//修改用户密码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>show users //查看已有用户</p> <p>show dbs  //查询数据库列表</p> <p><font color="blue"> 8. mac下数据库管理工具Robo</font></p> <p>传送门：https://robomongo.org/download</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/13/2025, 7:45:34 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/react-hooks.html" class="prev">react-hooks</a></span> <span class="next"><a href="/node/koa.html">koa</a>
      →
    </span></p></div> </main> <footer class="footer" data-v-266a5a28><div class="container" data-v-266a5a28><p class="text-center" data-v-266a5a28>© 2024 web全栈体系. All Rights Reserved.（所有文章未经授权禁止转载、摘编、复制或建立镜像，如有违反，追究法律责任。）</p> <p class="text-center" data-v-266a5a28><a href="https://beian.miit.gov.cn" target="_blank" data-v-266a5a28>豫ICP备19041317号-1</a></p></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0f616eb6.js" defer></script><script src="/assets/js/3.9750fba5.js" defer></script><script src="/assets/js/2.6aa46093.js" defer></script><script src="/assets/js/6.45a79ebc.js" defer></script>
  </body>
</html>
